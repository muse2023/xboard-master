import{r as m,j as e,t as Sl,c as kl,I as Ka,a as Ls,S as _a,u as Ss,b as wa,R as fn,d as gn,e as Tl,F as Dl,C as Pl,L as jn,T as vn,f as bn,g as El,h as Rl,i as Il,k as $,z as h,l as F,m as fe,n as ye,o as ie,p as Je,q as Ce,s as lt,v as Vl,O as Ca,w as Fl,x as Ol,y as Ml,A as zl,B as Ll,D as Al,Q as $l,E as ql,G as Ul,H as Hl,P as Kl,J as Bl,K as Gl,M as Wl,N as Yl,U as yn,V as Nn,W as $t,X as qt,Y as Sa,Z as Ze,_ as Ut,$ as Ht,a0 as _n,a1 as wn,a2 as Cn,a3 as ka,a4 as Sn,a5 as Ql,a6 as kn,a7 as Tn,a8 as Dn,a9 as Pn,aa as As,ab as En,ac as Jl,ad as Rn,ae as In,af as Zl,ag as Xl,ah as ei,ai as si,aj as ti,ak as ai,al as ni,am as ri,an as li,ao as ii,ap as oi,aq as Vn,ar as ci,as as di,at as $s,au as Fn,av as ui,aw as mi,ax as On,ay as Ta,az as xi,aA as hi,aB as Ba,aC as pi,aD as Mn,aE as fi,aF as zn,aG as gi,aH as ji,aI as vi,aJ as bi,aK as yi,aL as Ni,aM as Ln,aN as _i,aO as wi,aP as Ci,aQ as Oe,aR as Si,aS as An,aT as $n,aU as ki,aV as Ti,aW as qn,aX as Di,aY as Pi,aZ as Qe,a_ as Ei,a$ as Ri,b0 as Un,b1 as Hn,b2 as Kn,b3 as Ii,b4 as Vi,b5 as Fi,b6 as Bn,b7 as Oi,b8 as Da,b9 as Gn,ba as Mi,bb as Wn,bc as zi,bd as Yn,be as Li,bf as Qn,bg as Jn,bh as Ai,bi as $i,bj as Zn,bk as qi,bl as Ui,bm as Xn,bn as Hi,bo as er,bp as Ki,bq as Bi,br as ns,bs as jt,bt as Gi,bu as Wi,bv as Yi,bw as Qi,bx as Ji,by as Zi,bz as Ga,bA as Wa,bB as Xi,bC as eo,bD as so,bE as to,bF as ao,bG as pa,bH as ht,bI as no,bJ as ro,bK as lo,bL as Ya,bM as fa,bN as ga,bO as io,bP as oo,bQ as sr,bR as co,bS as Pa,bT as uo,bU as mo,bV as xo,bW as tr,bX as ar,bY as ho,bZ as po,b_ as fo,b$ as go,c0 as jo,c1 as nr,c2 as vo,c3 as bo,c4 as yo,c5 as No,c6 as Vt,c7 as Re,c8 as Qa,c9 as _o,ca as rr,cb as lr,cc as ir,cd as or,ce as cr,cf as dr,cg as wo,ch as Co,ci as So,cj as Kt,ck as qs,cl as ls,cm as ss,cn as ts,co as is,cp as os,cq as cs,cr as ko,cs as To,ct as Do,cu as Po,cv as Eo,cw as Ro,cx as Io,cy as Vo,cz as Fo,cA as ja,cB as Ea,cC as Ra,cD as Oo,cE as ks,cF as Ts,cG as vt,cH as Mo,cI as Ft,cJ as zo,cK as Ja,cL as ur,cM as Za,cN as Ot,cO as Lo,cP as Ao,cQ as $o,cR as qo,cS as mr,cT as Uo,cU as Ho,cV as xr,cW as va,cX as hr,cY as Ko,cZ as pr,c_ as fr,c$ as Bo,d0 as Go,d1 as Wo,d2 as Yo,d3 as Qo}from"./vendor.js";import"./index.js";var op=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cp(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Jo(s){if(s.__esModule)return s;var n=s.default;if(typeof n=="function"){var a=function l(){return this instanceof l?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(s).forEach(function(l){var r=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(a,l,r.get?r:{enumerable:!0,get:function(){return s[l]}})}),a}const Zo={theme:"system",setTheme:()=>null},gr=m.createContext(Zo);function Xo({children:s,defaultTheme:n="system",storageKey:a="vite-ui-theme",...l}){const[r,c]=m.useState(()=>localStorage.getItem(a)||n);m.useEffect(()=>{const u=window.document.documentElement;if(u.classList.remove("light","dark"),r==="system"){const x=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";u.classList.add(x);return}u.classList.add(r)},[r]);const o={theme:r,setTheme:u=>{localStorage.setItem(a,u),c(u)}};return e.jsx(gr.Provider,{...l,value:o,children:s})}const ec=()=>{const s=m.useContext(gr);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},sc=function(){const n=typeof document<"u"&&document.createElement("link").relList;return n&&n.supports&&n.supports("modulepreload")?"modulepreload":"preload"}(),tc=function(s,n){return new URL(s,n).href},Xa={},ue=function(n,a,l){let r=Promise.resolve();if(a&&a.length>0){const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),x=u?.nonce||u?.getAttribute("nonce");r=Promise.allSettled(a.map(i=>{if(i=tc(i,l),i in Xa)return;Xa[i]=!0;const d=i.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(!!l)for(let f=o.length-1;f>=0;f--){const j=o[f];if(j.href===i&&(!d||j.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${p}`))return;const P=document.createElement("link");if(P.rel=d?"stylesheet":sc,d||(P.as="script"),P.crossOrigin="",P.href=i,x&&P.setAttribute("nonce",x),document.head.appendChild(P),d)return new Promise((f,j)=>{P.addEventListener("load",f),P.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${i}`)))})}))}function c(o){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o}return r.then(o=>{for(const u of o||[])u.status==="rejected"&&c(u.reason);return n().catch(c)})};function N(...s){return Sl(kl(s))}const st=Ls("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),T=m.forwardRef(({className:s,variant:n,size:a,asChild:l=!1,children:r,disabled:c,loading:o=!1,leftSection:u,rightSection:x,...i},d)=>{const p=l?_a:"button";return e.jsxs(p,{className:N(st({variant:n,size:a,className:s})),disabled:o||c,ref:d,...i,children:[(u&&o||!u&&!x&&o)&&e.jsx(Ka,{className:"mr-2 h-4 w-4 animate-spin"}),!o&&u&&e.jsx("div",{className:"mr-2",children:u}),r,!o&&x&&e.jsx("div",{className:"ml-2",children:x}),x&&o&&e.jsx(Ka,{className:"ml-2 h-4 w-4 animate-spin"})]})});T.displayName="Button";function Gs({className:s,minimal:n=!1}){const a=Ss();return e.jsx("div",{className:N("h-svh w-full",s),children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[!n&&e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"500"}),e.jsxs("span",{className:"font-medium",children:["Oops! Something went wrong ",":')"]}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["We apologize for the inconvenience. ",e.jsx("br",{})," Please try again later."]}),!n&&e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(T,{variant:"outline",onClick:()=>a(-1),children:"Go Back"}),e.jsx(T,{onClick:()=>a("/"),children:"Back to Home"})]})]})})}function en(){const s=Ss();return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"404"}),e.jsx("span",{className:"font-medium",children:"Oops! Page Not Found!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["It seems like the page you're looking for ",e.jsx("br",{}),"does not exist or might have been removed."]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx(T,{variant:"outline",onClick:()=>s(-1),children:"Go Back"}),e.jsx(T,{onClick:()=>s("/"),children:"Back to Home"})]})]})})}function ac(){return e.jsx("div",{className:"h-svh",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-[7rem] font-bold leading-tight",children:"503"}),e.jsx("span",{className:"font-medium",children:"Website is under maintenance!"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["The site is not available at the moment. ",e.jsx("br",{}),"We'll be back online shortly."]}),e.jsx("div",{className:"mt-6 flex gap-4",children:e.jsx(T,{variant:"outline",children:"Learn more"})})]})})}function nc(s){return typeof s>"u"}function rc(s){return s===null}function lc(s){return rc(s)||nc(s)}class ic{storage;prefixKey;constructor(n){this.storage=n.storage,this.prefixKey=n.prefixKey}getKey(n){return`${this.prefixKey}${n}`.toUpperCase()}set(n,a,l=null){const r=JSON.stringify({value:a,time:Date.now(),expire:l!==null?new Date().getTime()+l*1e3:null});this.storage.setItem(this.getKey(n),r)}get(n,a=null){const l=this.storage.getItem(this.getKey(n));if(!l)return{value:a,time:0};try{const r=JSON.parse(l),{value:c,time:o,expire:u}=r;return lc(u)||u>new Date().getTime()?{value:c,time:o}:(this.remove(n),{value:a,time:0})}catch{return this.remove(n),{value:a,time:0}}}remove(n){this.storage.removeItem(this.getKey(n))}clear(){this.storage.clear()}}function jr({prefixKey:s="",storage:n=sessionStorage}){return new ic({prefixKey:s,storage:n})}const vr="Xboard_",oc=function(s={}){return jr({prefixKey:s.prefixKey||"",storage:localStorage})},cc=function(s={}){return jr({prefixKey:s.prefixKey||"",storage:sessionStorage})},Bt=oc({prefixKey:vr});cc({prefixKey:vr});const br="access_token";function pt(){return Bt.get(br)}function yr(){Bt.remove(br)}const sn=["/sign-in","/sign-in-2","/sign-up","/forgot-password","/otp"];function dc({children:s}){const n=Ss(),a=wa(),l=pt();return m.useEffect(()=>{if(!l.value&&!sn.includes(a.pathname)){const r=encodeURIComponent(a.pathname+a.search);n(`/sign-in?redirect=${r}`)}},[l.value,a.pathname,a.search,n]),sn.includes(a.pathname)||l.value?e.jsx(e.Fragment,{children:s}):null}const Se=m.forwardRef(({className:s,orientation:n="horizontal",decorative:a=!0,...l},r)=>e.jsx(fn,{ref:r,decorative:a,orientation:n,className:N("shrink-0 bg-border",n==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...l}));Se.displayName=fn.displayName;const uc=Ls("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Mt=m.forwardRef(({className:s,...n},a)=>e.jsx(gn,{ref:a,className:N(uc(),s),...n}));Mt.displayName=gn.displayName;const Ne=Dl,Nr=m.createContext({}),b=({...s})=>e.jsx(Nr.Provider,{value:{name:s.name},children:e.jsx(Pl,{...s})}),Gt=()=>{const s=m.useContext(Nr),n=m.useContext(_r),{getFieldState:a,formState:l}=Tl(),r=a(s.name,l);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:c}=n;return{id:c,name:s.name,formItemId:`${c}-form-item`,formDescriptionId:`${c}-form-item-description`,formMessageId:`${c}-form-item-message`,...r}},_r=m.createContext({}),v=m.forwardRef(({className:s,...n},a)=>{const l=m.useId();return e.jsx(_r.Provider,{value:{id:l},children:e.jsx("div",{ref:a,className:N("space-y-2",s),...n})})});v.displayName="FormItem";const y=m.forwardRef(({className:s,...n},a)=>{const{error:l,formItemId:r}=Gt();return e.jsx(Mt,{ref:a,className:N(l&&"text-destructive",s),htmlFor:r,...n})});y.displayName="FormLabel";const _=m.forwardRef(({...s},n)=>{const{error:a,formItemId:l,formDescriptionId:r,formMessageId:c}=Gt();return e.jsx(_a,{ref:n,id:l,"aria-describedby":a?`${r} ${c}`:`${r}`,"aria-invalid":!!a,...s})});_.displayName="FormControl";const z=m.forwardRef(({className:s,...n},a)=>{const{formDescriptionId:l}=Gt();return e.jsx("p",{ref:a,id:l,className:N("text-[0.8rem] text-muted-foreground",s),...n})});z.displayName="FormDescription";const k=m.forwardRef(({className:s,children:n,...a},l)=>{const{error:r,formMessageId:c}=Gt(),o=r?String(r?.message):n;return o?e.jsx("p",{ref:l,id:c,className:N("text-[0.8rem] font-medium text-destructive",s),...a,children:o}):null});k.displayName="FormMessage";const Wt=El,bt=m.forwardRef(({className:s,...n},a)=>e.jsx(jn,{ref:a,className:N("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...n}));bt.displayName=jn.displayName;const He=m.forwardRef(({className:s,...n},a)=>e.jsx(vn,{ref:a,className:N("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...n}));He.displayName=vn.displayName;const ys=m.forwardRef(({className:s,...n},a)=>e.jsx(bn,{ref:a,className:N("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n}));ys.displayName=bn.displayName;function _e(s=void 0,n="YYYY-MM-DD HH:mm:ss"){return s==null?"":(Math.floor(s).toString().length===10&&(s=s*1e3),Rl(s).format(n))}function mc(s=void 0,n="YYYY-MM-DD"){return _e(s,n)}function Qs(s){const n=typeof s=="string"?parseFloat(s):s;return isNaN(n)?"0.00":n.toFixed(2)}function Os(s,n=!0){if(s==null)return n?"¥0.00":"0.00";const a=typeof s=="string"?parseFloat(s):s;if(isNaN(a))return n?"¥0.00":"0.00";const r=(a/100).toFixed(2).replace(/\.?0+$/,c=>c.includes(".")?".00":c);return n?`¥${r}`:r}function zt(s){return new Promise(n=>{(async()=>{try{if(navigator.clipboard)await navigator.clipboard.writeText(s);else{const l=document.createElement("textarea");l.value=s,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.select();const r=document.execCommand("copy");if(document.body.removeChild(l),!r)throw new Error("execCommand failed")}n(!0)}catch(l){console.error(l),n(!1)}})()})}function ms(s){const n=s/1024,a=n/1024,l=a/1024,r=l/1024;return r>=1?Qs(r)+" TB":l>=1?Qs(l)+" GB":a>=1?Qs(a)+" MB":Qs(n)+" KB"}const xc="locale";function hc(){return Bt.get(xc)}function wr(){yr();const s=window.location.pathname,n=s&&!["/404","/sign-in"].includes(s),a=new URL(window.location.href),r=`${a.pathname.split("/")[1]?`/${a.pathname.split("/")[1]}`:""}#/sign-in`;window.location.href=r+(n?`?redirect=${s}`:"")}const pc=["/passport/auth/login","/passport/auth/token2Login","/passport/auth/register","/guest/comm/config","/passport/comm/sendEmailVerify","/passport/auth/forget"];function fc(){const s=window.settings?.base_url||"/";return s.endsWith("/")?s+"api/v2":s+"/api/v2"}const I=Il.create({baseURL:fc(),timeout:12e3,headers:{"Content-Type":"application/json"}});I.interceptors.request.use(s=>{s.method?.toLowerCase()==="get"&&(s.params={...s.params,t:Date.now()});const n=pt();if(!pc.includes(s.url?.split("?")[0]||"")){if(!n.value)return wr(),Promise.reject({code:-1,message:"未登录"});s.headers.Authorization=n.value}return s.headers["Content-Language"]=hc().value||"zh-CN",s},s=>Promise.reject(s));I.interceptors.response.use(s=>s?.data||{code:-1,message:"未知错误"},s=>{const n=s.response?.status,a=s.response?.data?.message;return(n===401||n===403)&&wr(),$.error(a||{401:"登录已过期",403:"没有权限",404:"资源或接口不存在"}[n]||"未知异常"),Promise.reject(s.response?.data||{data:null,code:-1,message:"未知错误"})});const gc="access_token";function jc(s){Bt.set(gc,s)}const H=window?.settings?.secure_path,vc=s=>I.get(H+"/stat/getOrder",{params:s}),bc=()=>I.get(H+"/stat/getStats"),tn=s=>I.get(H+"/stat/getTrafficRank",{params:s}),yc=()=>I.get(H+"/theme/getThemes"),Nc=s=>I.post(H+"/theme/getThemeConfig",{name:s}),_c=(s,n)=>I.post(H+"/theme/saveThemeConfig",{name:s,config:n}),wc=s=>{const n=new FormData;return n.append("file",s),I.post(H+"/theme/upload",n,{headers:{"Content-Type":"multipart/form-data"}})},Cc=s=>I.post(H+"/theme/delete",{name:s}),Sc=s=>I.post(H+"/config/save",s),Cr=()=>I.get(H+"/server/manage/getNodes"),kc=s=>I.post(H+"/server/manage/save",s),Tc=s=>I.post(H+"/server/manage/drop",s),Dc=s=>I.post(H+"/server/manage/copy",s),Pc=s=>I.post(H+"/server/manage/update",s),Ec=s=>I.post(H+"/server/manage/sort",s),yt=()=>I.get(H+"/server/group/fetch"),Rc=s=>I.post(H+"/server/group/save",s),Ic=s=>I.post(H+"/server/group/drop",s),Sr=()=>I.get(H+"/server/route/fetch"),Vc=s=>I.post(H+"/server/route/save",s),Fc=s=>I.post(H+"/server/route/drop",s),Oc=()=>I.get(H+"/payment/fetch"),Mc=()=>I.get(H+"/payment/getPaymentMethods"),zc=s=>I.post(H+"/payment/getPaymentForm",s),Lc=s=>I.post(H+"/payment/save",s),Ac=s=>I.post(H+"/payment/drop",s),$c=s=>I.post(H+"/payment/show",s),qc=s=>I.post(H+"/payment/sort",s),Uc=s=>I.post(H+"/notice/save",s),Hc=s=>I.post(H+"/notice/drop",s),Kc=s=>I.post(H+"/notice/show",s),Bc=()=>I.get(H+"/knowledge/fetch"),Gc=s=>I.get(H+"/knowledge/fetch?id="+s),Wc=s=>I.post(H+"/knowledge/save",s),Yc=s=>I.post(H+"/knowledge/drop",s),Qc=s=>I.post(H+"/knowledge/show",s),Jc=s=>I.post(H+"/knowledge/sort",s),Us=()=>I.get(H+"/plan/fetch"),Zc=s=>I.post(H+"/plan/save",s),na=s=>I.post(H+"/plan/update",s),Xc=s=>I.post(H+"/plan/drop",s),ed=s=>I.post(H+"/plan/sort",{ids:s}),sd=async s=>I.post(H+"/order/fetch",s),td=s=>I.post(H+"/order/detail",s),ad=s=>I.post(H+"/order/paid",s),nd=s=>I.post(H+"/order/cancel",s),an=s=>I.post(H+"/order/update",s),rd=s=>I.post(H+"/order/assign",s),ld=s=>I.post(H+"/coupon/fetch",s),id=s=>I.post(H+"/coupon/generate",s),od=s=>I.post(H+"/coupon/drop",s),cd=s=>I.post(H+"/coupon/update",s),dd=s=>I.post(H+"/user/fetch",s),ud=s=>I.post(H+"/user/update",s),md=s=>I.post(H+"/user/resetSecret",s),xd=s=>I.post(H+"/user/generate",s),hd=s=>I.post(H+"/stat/getStatUser",s),pd=s=>I.post(H+"/ticket/fetch",s),fd=s=>I.get(H+"/ticket/fetch?id= "+s),gd=s=>I.post(H+"/ticket/close",{id:s}),hs=(s="")=>I.get(H+"/config/fetch?key="+s),ps=s=>I.post(H+"/config/save",s),jd=()=>I.get(H+"/config/getEmailTemplate"),vd=()=>I.post(H+"/config/testSendMail"),bd=()=>I.post(H+"/config/setTelegramWebhook"),yd=h.object({subscribe_template_singbox:h.string().nullable(),subscribe_template_clash:h.string().nullable(),subscribe_template_clashmeta:h.string().nullable(),subscribe_template_stash:h.string().nullable(),subscribe_template_surge:h.string().nullable()}),Nd={subscribe_template_singbox:"",subscribe_template_clash:"",subscribe_template_clashmeta:"",subscribe_template_stash:"",subscribe_template_surge:""};function _d(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),[r,c]=m.useState("singbox"),o=fe({resolver:ye(yd),defaultValues:Nd,mode:"onBlur"}),{data:u}=ie({queryKey:["settings","client"],queryFn:()=>hs("subscribe_template")}),{mutateAsync:x}=Je({mutationFn:ps,onSuccess:p=>{p.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(u?.data.subscribe_template){const p=u.data.subscribe_template;Object.entries(p).forEach(([w,P])=>{o.setValue(w,P)}),l.current=p}},[u]),console.log(o.getValues());const i=m.useCallback(Ce.debounce(async p=>{if(!Ce.isEqual(p,l.current)){a(!0);try{await x(p),l.current=p}finally{a(!1)}}},1e3),[x]),d=m.useCallback(p=>{i(p)},[i]);return e.jsx(Ne,{...o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Wt,{value:r,onValueChange:c,children:[e.jsxs(bt,{children:[e.jsx(He,{value:"singbox",children:"Sing-box"}),e.jsx(He,{value:"clash",children:"Clash"}),e.jsx(He,{value:"clashmeta",children:"Clash Meta"}),e.jsx(He,{value:"stash",children:"Stash"}),e.jsx(He,{value:"surge",children:"Surge"})]}),e.jsx(ys,{value:"singbox",children:e.jsx(b,{control:o.control,name:"subscribe_template_singbox",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe_template.singbox.title")}),e.jsx(_,{children:e.jsx(lt,{height:"500px",defaultLanguage:"json",value:p.value||"",onChange:w=>{typeof w=="string"&&(p.onChange(w),d(o.getValues()))},options:{minimap:{enabled:!1},fontSize:14}})}),e.jsx(z,{children:s("subscribe_template.singbox.description")}),e.jsx(k,{})]})})}),e.jsx(ys,{value:"clash",children:e.jsx(b,{control:o.control,name:"subscribe_template_clash",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe_template.clash.title")}),e.jsx(_,{children:e.jsx(lt,{height:"500px",defaultLanguage:"yaml",value:p.value||"",onChange:w=>{typeof w=="string"&&(p.onChange(w),d(o.getValues()))},options:{minimap:{enabled:!1},fontSize:14}})}),e.jsx(z,{children:s("subscribe_template.clash.description")}),e.jsx(k,{})]})})}),e.jsx(ys,{value:"clashmeta",children:e.jsx(b,{control:o.control,name:"subscribe_template_clashmeta",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe_template.clashmeta.title")}),e.jsx(_,{children:e.jsx(lt,{height:"500px",defaultLanguage:"yaml",value:p.value||"",onChange:w=>{typeof w=="string"&&(p.onChange(w),d(o.getValues()))},options:{minimap:{enabled:!1},fontSize:14}})}),e.jsx(z,{children:s("subscribe_template.clashmeta.description")}),e.jsx(k,{})]})})}),e.jsx(ys,{value:"stash",children:e.jsx(b,{control:o.control,name:"subscribe_template_stash",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe_template.stash.title")}),e.jsx(_,{children:e.jsx(lt,{height:"500px",defaultLanguage:"yaml",value:p.value||"",onChange:w=>{typeof w=="string"&&(p.onChange(w),d(o.getValues()))},options:{minimap:{enabled:!1},fontSize:14}})}),e.jsx(z,{children:s("subscribe_template.stash.description")}),e.jsx(k,{})]})})}),e.jsx(ys,{value:"surge",children:e.jsx(b,{control:o.control,name:"subscribe_template_surge",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe_template.surge.title")}),e.jsx(_,{children:e.jsx(lt,{height:"500px",defaultLanguage:"ini",value:p.value||"",onChange:w=>{typeof w=="string"&&(p.onChange(w),d(o.getValues()))},options:{minimap:{enabled:!1},fontSize:14}})}),e.jsx(z,{children:s("subscribe_template.surge.description")}),e.jsx(k,{})]})})})]}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function wd(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("subscribe_template.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("subscribe_template.description")})]}),e.jsx(Se,{}),e.jsx(_d,{})]})}const Cd=()=>e.jsx(dc,{children:e.jsx(Ca,{})}),Sd=Vl([{path:"/sign-in",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Ud);return{default:s}},void 0,import.meta.url)).default})},{element:e.jsx(Cd,{}),children:[{path:"/",lazy:async()=>({Component:(await ue(()=>Promise.resolve().then(()=>Zd),void 0,import.meta.url)).default}),errorElement:e.jsx(Gs,{}),children:[{index:!0,lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Nu);return{default:s}},void 0,import.meta.url)).default})},{path:"config",errorElement:e.jsx(Gs,{}),children:[{path:"system",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Su);return{default:s}},void 0,import.meta.url)).default}),children:[{index:!0,lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Pu);return{default:s}},void 0,import.meta.url)).default})},{path:"safe",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Fu);return{default:s}},void 0,import.meta.url)).default})},{path:"subscribe",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Au);return{default:s}},void 0,import.meta.url)).default})},{path:"invite",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Ku);return{default:s}},void 0,import.meta.url)).default})},{path:"frontend",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Qu);return{default:s}},void 0,import.meta.url)).default})},{path:"server",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>sm);return{default:s}},void 0,import.meta.url)).default})},{path:"email",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>lm);return{default:s}},void 0,import.meta.url)).default})},{path:"telegram",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>um);return{default:s}},void 0,import.meta.url)).default})},{path:"APP",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>fm);return{default:s}},void 0,import.meta.url)).default})},{path:"subscribe-template",element:e.jsx(wd,{})}]},{path:"payment",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Sm);return{default:s}},void 0,import.meta.url)).default})},{path:"plugin",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Dm);return{default:s}},void 0,import.meta.url)).default})},{path:"theme",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Im);return{default:s}},void 0,import.meta.url)).default})},{path:"notice",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Am);return{default:s}},void 0,import.meta.url)).default})},{path:"knowledge",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Wm);return{default:s}},void 0,import.meta.url)).default})}]},{path:"server",errorElement:e.jsx(Gs,{}),children:[{path:"manage",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>vx);return{default:s}},void 0,import.meta.url)).default})},{path:"group",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>wx);return{default:s}},void 0,import.meta.url)).default})},{path:"route",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Px);return{default:s}},void 0,import.meta.url)).default})}]},{path:"finance",errorElement:e.jsx(Gs,{}),children:[{path:"plan",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Lx);return{default:s}},void 0,import.meta.url)).default})},{path:"order",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Xx);return{default:s}},void 0,import.meta.url)).default})},{path:"coupon",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>oh);return{default:s}},void 0,import.meta.url)).default})}]},{path:"user",errorElement:e.jsx(Gs,{}),children:[{path:"manage",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>Lh);return{default:s}},void 0,import.meta.url)).default})},{path:"ticket",lazy:async()=>({Component:(await ue(async()=>{const{default:s}=await Promise.resolve().then(()=>rp);return{default:s}},void 0,import.meta.url)).default})}]}]}]},{path:"/500",Component:Gs},{path:"/404",Component:en},{path:"/503",Component:ac},{path:"*",Component:en}]);function kd(){return I.get("/user/info")}const ra={token:pt()?.value||"",userInfo:null,isLoggedIn:!!pt()?.value,loading:!1,error:null},ut=Fl("user/fetchUserInfo",async()=>(await kd()).data,{condition:(s,{getState:n})=>{const{user:a}=n();return!!a.token&&!a.loading}}),kr=Ol({name:"user",initialState:ra,reducers:{setToken(s,n){s.token=n.payload,s.isLoggedIn=!!n.payload},resetUserState:()=>ra},extraReducers:s=>{s.addCase(ut.pending,n=>{n.loading=!0,n.error=null}).addCase(ut.fulfilled,(n,a)=>{n.loading=!1,n.userInfo=a.payload,n.error=null}).addCase(ut.rejected,(n,a)=>{if(n.loading=!1,n.error=a.error.message||"Failed to fetch user info",!n.token)return ra})}}),{setToken:Td,resetUserState:Dd}=kr.actions,Pd=s=>s.user.userInfo,Ed=kr.reducer,Tr=Ml({reducer:{user:Ed}});pt()?.value&&Tr.dispatch(ut());zl.use(Ll).use(Al).init({resources:{"en-US":window.XBOARD_TRANSLATIONS?.["en-US"]||{},"zh-CN":window.XBOARD_TRANSLATIONS?.["zh-CN"]||{},"ko-KR":window.XBOARD_TRANSLATIONS?.["ko-KR"]||{}},fallbackLng:"zh-CN",supportedLngs:["en-US","zh-CN","ko-KR"],detection:{order:["querystring","localStorage","navigator"],lookupQuerystring:"lang",lookupLocalStorage:"i18nextLng",caches:["localStorage"]},interpolation:{escapeValue:!1}});const Rd=new $l;ql.createRoot(document.getElementById("root")).render(e.jsx(Ul.StrictMode,{children:e.jsx(Hl,{client:Rd,children:e.jsx(Kl,{store:Tr,children:e.jsxs(Xo,{defaultTheme:"light",storageKey:"vite-ui-theme",children:[e.jsx(Bl,{router:Sd}),e.jsx(Gl,{richColors:!0,position:"top-right"})]})})})}));const Ke=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:N("rounded-xl border bg-card text-card-foreground shadow",s),...n}));Ke.displayName="Card";const Xe=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:N("flex flex-col space-y-1.5 p-6",s),...n}));Xe.displayName="CardHeader";const _s=m.forwardRef(({className:s,...n},a)=>e.jsx("h3",{ref:a,className:N("font-semibold leading-none tracking-tight",s),...n}));_s.displayName="CardTitle";const Zs=m.forwardRef(({className:s,...n},a)=>e.jsx("p",{ref:a,className:N("text-sm text-muted-foreground",s),...n}));Zs.displayName="CardDescription";const es=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:N("p-6 pt-0",s),...n}));es.displayName="CardContent";const Id=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:N("flex items-center p-6 pt-0",s),...n}));Id.displayName="CardFooter";const D=m.forwardRef(({className:s,type:n,...a},l)=>e.jsx("input",{type:n,className:N("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:l,...a}));D.displayName="Input";const Dr=m.forwardRef(({className:s,...n},a)=>{const[l,r]=m.useState(!1);return e.jsxs("div",{className:"relative rounded-md",children:[e.jsx("input",{type:l?"text":"password",className:N("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...n}),e.jsx(T,{type:"button",size:"icon",variant:"ghost",className:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2 rounded-md text-muted-foreground",onClick:()=>r(c=>!c),children:l?e.jsx(Wl,{size:18}):e.jsx(Yl,{size:18})})]})});Dr.displayName="PasswordInput";const Vd=s=>I({url:"/passport/auth/login",method:"post",data:s});function Fd({className:s,onForgotPassword:n,...a}){const l=Ss(),r=yn(),{t:c}=F("auth"),o=h.object({email:h.string().min(1,{message:c("signIn.validation.emailRequired")}),password:h.string().min(1,{message:c("signIn.validation.passwordRequired")}).min(7,{message:c("signIn.validation.passwordLength")})}),u=fe({resolver:ye(o),defaultValues:{email:"",password:""}});async function x(i){try{const{data:d}=await Vd(i);jc(d.auth_data),r(Td(d.auth_data)),await r(ut()).unwrap(),l("/")}catch(d){console.error("Login failed:",d),d.response?.data?.message&&u.setError("root",{message:d.response.data.message})}}return e.jsx("div",{className:N("grid gap-6",s),...a,children:e.jsx(Ne,{...u,children:e.jsx("form",{onSubmit:u.handleSubmit(x),className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[u.formState.errors.root&&e.jsx("div",{className:"text-sm text-destructive",children:u.formState.errors.root.message}),e.jsx(b,{control:u.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:c("signIn.email")}),e.jsx(_,{children:e.jsx(D,{placeholder:c("signIn.emailPlaceholder"),autoComplete:"email",...i})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"password",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:c("signIn.password")}),e.jsx(_,{children:e.jsx(Dr,{placeholder:c("signIn.passwordPlaceholder"),autoComplete:"current-password",...i})}),e.jsx(k,{})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(T,{variant:"link",type:"button",className:"px-0 text-sm font-normal text-muted-foreground hover:text-primary",onClick:n,children:c("signIn.forgotPassword")})}),e.jsx(T,{className:"w-full",size:"lg",loading:u.formState.isSubmitting,children:c("signIn.submit")})]})})})})}const ve=Nn,We=_n,Od=wn,Nt=Sa,Pr=m.forwardRef(({className:s,...n},a)=>e.jsx($t,{ref:a,className:N("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n}));Pr.displayName=$t.displayName;const pe=m.forwardRef(({className:s,children:n,...a},l)=>e.jsxs(Od,{children:[e.jsx(Pr,{}),e.jsxs(qt,{ref:l,className:N("max-h-[95%] overflow-auto fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[n,e.jsxs(Sa,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));pe.displayName=qt.displayName;const we=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col space-y-1.5 text-center sm:text-left",s),...n});we.displayName="DialogHeader";const Me=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...n});Me.displayName="DialogFooter";const be=m.forwardRef(({className:s,...n},a)=>e.jsx(Ut,{ref:a,className:N("text-lg font-semibold leading-none tracking-tight",s),...n}));be.displayName=Ut.displayName;const ke=m.forwardRef(({className:s,...n},a)=>e.jsx(Ht,{ref:a,className:N("text-sm text-muted-foreground",s),...n}));ke.displayName=Ht.displayName;const Xs=Ls("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),G=m.forwardRef(({className:s,variant:n,size:a,asChild:l=!1,...r},c)=>{const o=l?_a:"button";return e.jsx(o,{className:N(Xs({variant:n,size:a,className:s})),ref:c,...r})});G.displayName="Button";const ws=Zl,Cs=Xl,Md=ei,zd=m.forwardRef(({className:s,inset:n,children:a,...l},r)=>e.jsxs(Cn,{ref:r,className:N("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",s),...l,children:[a,e.jsx(ka,{className:"ml-auto h-4 w-4"})]}));zd.displayName=Cn.displayName;const Ld=m.forwardRef(({className:s,...n},a)=>e.jsx(Sn,{ref:a,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n}));Ld.displayName=Sn.displayName;const xs=m.forwardRef(({className:s,sideOffset:n=4,...a},l)=>e.jsx(Ql,{children:e.jsx(kn,{ref:l,sideOffset:n,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));xs.displayName=kn.displayName;const ge=m.forwardRef(({className:s,inset:n,...a},l)=>e.jsx(Tn,{ref:l,className:N("relative flex cursor-default cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",s),...a}));ge.displayName=Tn.displayName;const Ad=m.forwardRef(({className:s,children:n,checked:a,...l},r)=>e.jsxs(Dn,{ref:r,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...l,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pn,{children:e.jsx(As,{className:"h-4 w-4"})})}),n]}));Ad.displayName=Dn.displayName;const $d=m.forwardRef(({className:s,children:n,...a},l)=>e.jsxs(En,{ref:l,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Pn,{children:e.jsx(Jl,{className:"h-4 w-4 fill-current"})})}),n]}));$d.displayName=En.displayName;const Ia=m.forwardRef(({className:s,inset:n,...a},l)=>e.jsx(Rn,{ref:l,className:N("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...a}));Ia.displayName=Rn.displayName;const et=m.forwardRef(({className:s,...n},a)=>e.jsx(In,{ref:a,className:N("-mx-1 my-1 h-px bg-muted",s),...n}));et.displayName=In.displayName;const ba=({className:s,...n})=>e.jsx("span",{className:N("ml-auto text-xs tracking-widest opacity-60",s),...n});ba.displayName="DropdownMenuShortcut";const la=[{code:"en-US",name:"English",flag:si,shortName:"EN"},{code:"zh-CN",name:"中文",flag:ti,shortName:"CN"},{code:"ko-KR",name:"한국어",flag:ai,shortName:"KR"}];function Er(){const{i18n:s}=F(),n=r=>{s.changeLanguage(r)},a=la.find(r=>r.code===s.language)||la[1],l=a.flag;return e.jsxs(ws,{children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(G,{variant:"ghost",size:"sm",className:"h-8 px-2 gap-1",children:[e.jsx(l,{className:"h-4 w-5 rounded-sm shadow-sm"}),e.jsx("span",{className:"text-sm font-medium",children:a.shortName})]})}),e.jsx(xs,{align:"end",className:"w-[120px]",children:la.map(r=>{const c=r.flag,o=r.code===s.language;return e.jsxs(ge,{onClick:()=>n(r.code),className:N("flex items-center gap-2 px-2 py-1.5 cursor-pointer",o&&"bg-accent"),children:[e.jsx(c,{className:"h-4 w-5 rounded-sm shadow-sm"}),e.jsx("span",{className:N("text-sm",o&&"font-medium"),children:r.name})]},r.code)})})]})}function qd(){const[s,n]=m.useState(!1),{t:a}=F("auth"),l=a("signIn.resetPassword.command");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container relative grid h-svh flex-col items-center justify-center bg-primary-foreground lg:max-w-none lg:px-0",children:[e.jsx("div",{className:"absolute right-4 top-4 md:right-8 md:top-8",children:e.jsx(Er,{})}),e.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[480px] lg:p-8",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:window?.settings?.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:window?.settings?.description})]}),e.jsxs(Ke,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-left",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:a("signIn.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("signIn.description")})]}),e.jsx(Fd,{onForgotPassword:()=>n(!0)})]})]})]}),e.jsx(ve,{open:s,onOpenChange:n,children:e.jsx(pe,{children:e.jsxs(we,{children:[e.jsx(be,{children:a("signIn.resetPassword.title")}),e.jsx(ke,{children:a("signIn.resetPassword.description")}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"rounded-md bg-secondary p-4 pr-12 text-sm",children:l}),e.jsx(G,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 h-8 w-8 hover:bg-secondary-foreground/10",onClick:()=>zt(l).then(()=>{$.success(a("common:copy.success"))}),children:e.jsx(ni,{className:"h-4 w-4"})})]})})]})})})]})}const Ud=Object.freeze(Object.defineProperty({__proto__:null,default:qd},Symbol.toStringTag,{value:"Module"})),Pe=m.forwardRef(({className:s,fadedBelow:n=!1,fixedHeight:a=!1,...l},r)=>e.jsx("div",{ref:r,className:N("relative flex h-full w-full flex-col",n&&"after:pointer-events-none after:absolute after:bottom-0 after:left-0 after:hidden after:h-32 after:w-full after:bg-[linear-gradient(180deg,_transparent_10%,_hsl(var(--background))_70%)] after:md:block",a&&"md:h-svh",s),...l}));Pe.displayName="Layout";const Ee=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{ref:a,className:N("flex h-[var(--header-height)] flex-none items-center gap-4 bg-background p-4 md:px-8",s),...n}));Ee.displayName="LayoutHeader";const Ve=m.forwardRef(({className:s,fixedHeight:n,...a},l)=>e.jsx("div",{ref:l,className:N("flex-1 overflow-hidden px-4 py-6 md:px-8",n&&"h-[calc(100%-var(--header-height))]",s),...a}));Ve.displayName="LayoutBody";const Rr=ri,Ir=li,Vr=ii,je=oi,xe=ci,he=di,ce=m.forwardRef(({className:s,sideOffset:n=4,...a},l)=>e.jsx(Vn,{ref:l,sideOffset:n,className:N("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));ce.displayName=Vn.displayName;function Yt(){const{pathname:s}=wa();return{checkActiveNav:a=>{if(a==="/"&&s==="/")return!0;const l=a.replace(/^\//,""),r=s.replace(/^\//,"");return l?r.startsWith(l):!1}}}function Fr({key:s,defaultValue:n}){const[a,l]=m.useState(()=>{const r=localStorage.getItem(s);return r!==null?JSON.parse(r):n});return m.useEffect(()=>{localStorage.setItem(s,JSON.stringify(a))},[a,s]),[a,l]}function Hd(){const[s,n]=Fr({key:"collapsed-sidebar-items",defaultValue:[]}),a=r=>!s.includes(r);return{isExpanded:a,toggleItem:r=>{a(r)?n([...s,r]):n(s.filter(c=>c!==r))}}}function Kd({links:s,isCollapsed:n,className:a,closeNav:l}){const{t:r}=F(),c=({sub:o,...u})=>{const x=`${r(u.title)}-${u.href}`;return n&&o?m.createElement(Wd,{...u,sub:o,key:x,closeNav:l}):n?m.createElement(Gd,{...u,key:x,closeNav:l}):o?m.createElement(Bd,{...u,sub:o,key:x,closeNav:l}):m.createElement(Or,{...u,key:x,closeNav:l})};return e.jsx("div",{"data-collapsed":n,className:N("group border-b bg-background py-2 transition-[max-height,padding] duration-500 data-[collapsed=true]:py-2 md:border-none",a),children:e.jsx(je,{delayDuration:0,children:e.jsx("nav",{className:"grid gap-1 group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:s.map(c)})})})}function Or({title:s,icon:n,label:a,href:l,closeNav:r,subLink:c=!1}){const{checkActiveNav:o}=Yt(),{t:u}=F();return e.jsxs($s,{to:l,onClick:r,className:N(st({variant:o(l)?"secondary":"ghost",size:"sm"}),"h-12 justify-start text-wrap rounded-none px-6",c&&"h-10 w-full border-l border-l-slate-500 px-2"),"aria-current":o(l)?"page":void 0,children:[e.jsx("div",{className:"mr-2",children:n}),u(s),a&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:u(a)})]})}function Bd({title:s,icon:n,label:a,sub:l,closeNav:r}){const{checkActiveNav:c}=Yt(),{isExpanded:o,toggleItem:u}=Hd(),{t:x}=F(),i=!!l?.find(w=>c(w.href)),d=x(s),p=o(d)||i;return e.jsxs(Rr,{open:p,onOpenChange:()=>u(d),children:[e.jsxs(Ir,{className:N(st({variant:i?"secondary":"ghost",size:"sm"}),"group h-12 w-full justify-start rounded-none px-6"),children:[e.jsx("div",{className:"mr-2",children:n}),x(s),a&&e.jsx("div",{className:"ml-2 rounded-lg bg-primary px-1 text-[0.625rem] text-primary-foreground",children:x(a)}),e.jsx("span",{className:N('ml-auto transition-all group-data-[state="open"]:-rotate-180'),children:e.jsx(Fn,{stroke:1})})]}),e.jsx(Vr,{className:"collapsibleDropdown",asChild:!0,children:e.jsx("ul",{children:l.map(w=>e.jsx("li",{className:"my-1 ml-8",children:e.jsx(Or,{...w,subLink:!0,closeNav:r})},x(w.title)))})})]})}function Gd({title:s,icon:n,label:a,href:l,closeNav:r}){const{checkActiveNav:c}=Yt(),{t:o}=F();return e.jsxs(xe,{delayDuration:0,children:[e.jsx(he,{asChild:!0,children:e.jsxs($s,{to:l,onClick:r,className:N(st({variant:c(l)?"secondary":"ghost",size:"icon"}),"h-12 w-12"),children:[n,e.jsx("span",{className:"sr-only",children:o(s)})]})}),e.jsxs(ce,{side:"right",className:"flex items-center gap-4",children:[o(s),a&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:o(a)})]})]})}function Wd({title:s,icon:n,label:a,sub:l,closeNav:r}){const{checkActiveNav:c}=Yt(),{t:o}=F(),u=!!l?.find(x=>c(x.href));return e.jsxs(ws,{children:[e.jsxs(xe,{delayDuration:0,children:[e.jsx(he,{asChild:!0,children:e.jsx(Cs,{asChild:!0,children:e.jsx(T,{variant:u?"secondary":"ghost",size:"icon",className:"h-12 w-12",children:n})})}),e.jsxs(ce,{side:"right",className:"flex items-center gap-4",children:[o(s)," ",a&&e.jsx("span",{className:"ml-auto text-muted-foreground",children:o(a)}),e.jsx(Fn,{size:18,className:"-rotate-90 text-muted-foreground"})]})]}),e.jsxs(xs,{side:"right",align:"start",sideOffset:4,children:[e.jsxs(Ia,{children:[o(s)," ",a?`(${o(a)})`:""]}),e.jsx(et,{}),l.map(({title:x,icon:i,label:d,href:p})=>e.jsx(ge,{asChild:!0,children:e.jsxs($s,{to:p,onClick:r,className:`${c(p)?"bg-secondary":""}`,children:[i," ",e.jsx("span",{className:"ml-2 max-w-52 text-wrap",children:o(x)}),d&&e.jsx("span",{className:"ml-auto text-xs",children:o(d)})]})},`${o(x)}-${p}`))]})]})}const Mr=[{title:"nav:dashboard",label:"",href:"/",icon:e.jsx(ui,{size:18})},{title:"nav:systemManagement",label:"",href:"",icon:e.jsx(mi,{size:18}),sub:[{title:"nav:systemConfig",label:"",href:"/config/system",icon:e.jsx(On,{size:18})},{title:"nav:pluginManagement",label:"",href:"/config/plugin",icon:e.jsx(Ta,{size:18})},{title:"nav:themeConfig",label:"",href:"/config/theme",icon:e.jsx(xi,{size:18})},{title:"nav:noticeManagement",label:"",href:"/config/notice",icon:e.jsx(hi,{size:18})},{title:"nav:paymentConfig",label:"",href:"/config/payment",icon:e.jsx(Ba,{size:18})},{title:"nav:knowledgeManagement",label:"",href:"/config/knowledge",icon:e.jsx(pi,{size:18})}]},{title:"nav:nodeManagement",label:"",href:"",icon:e.jsx(Mn,{size:18}),sub:[{title:"nav:nodeManagement",label:"",href:"/server/manage",icon:e.jsx(fi,{size:18})},{title:"nav:permissionGroupManagement",label:"",href:"/server/group",icon:e.jsx(zn,{size:18})},{title:"nav:routeManagement",label:"",href:"/server/route",icon:e.jsx(gi,{size:18})}]},{title:"nav:subscriptionManagement",label:"",href:"",icon:e.jsx(ji,{size:18}),sub:[{title:"nav:planManagement",label:"",href:"/finance/plan",icon:e.jsx(vi,{size:18})},{title:"nav:orderManagement",label:"",href:"/finance/order",icon:e.jsx(Ba,{size:18})},{title:"nav:couponManagement",label:"",href:"/finance/coupon",icon:e.jsx(bi,{size:18})}]},{title:"nav:userManagement",label:"",href:"",icon:e.jsx(yi,{size:18}),sub:[{title:"nav:userManagement",label:"",href:"/user/manage",icon:e.jsx(Ni,{size:18})},{title:"nav:ticketManagement",label:"",href:"/user/ticket",icon:e.jsx(Ln,{size:18})}]}];function Yd({className:s,isCollapsed:n,setIsCollapsed:a}){const[l,r]=m.useState(!1),{t:c}=F();return m.useEffect(()=>{l?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")},[l]),e.jsxs("aside",{className:N(`fixed left-0 right-0 top-0 z-50 flex h-auto flex-col border-r-2 border-r-muted transition-[width] md:bottom-0 md:right-auto md:h-svh ${n?"md:w-14":"md:w-64"}`,s),children:[e.jsx("div",{onClick:()=>r(!1),className:`absolute inset-0 transition-[opacity] delay-100 duration-700 ${l?"h-svh opacity-50":"h-0 opacity-0"} w-full bg-black md:hidden`}),e.jsxs(Pe,{className:"flex h-full flex-col",children:[e.jsxs(Ee,{className:"sticky top-0 justify-between px-4 py-3 shadow md:px-4",children:[e.jsxs("div",{className:`flex items-center ${n?"":"gap-2"}`,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",className:`transition-all ${n?"h-6 w-6":"h-8 w-8"}`,children:[e.jsx("rect",{width:"256",height:"256",fill:"none"}),e.jsx("line",{x1:"208",y1:"128",x2:"128",y2:"208",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("line",{x1:"192",y1:"40",x2:"40",y2:"192",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),e.jsx("span",{className:"sr-only",children:"Website Name"})]}),e.jsx("div",{className:`flex flex-col justify-end truncate ${n?"invisible w-0":"visible w-auto"}`,children:e.jsx("span",{className:"font-medium",children:window?.settings?.title})})]}),e.jsx(T,{variant:"ghost",size:"icon",className:"md:hidden","aria-label":c("common:toggleNavigation"),"aria-controls":"sidebar-menu","aria-expanded":l,onClick:()=>r(o=>!o),children:l?e.jsx(_i,{}):e.jsx(wi,{})})]}),e.jsx(Kd,{id:"sidebar-menu",className:N("flex-1 overflow-auto",l?"block":"hidden md:block","md:py-2"),closeNav:()=>r(!1),isCollapsed:n,links:Mr}),e.jsx("div",{className:N("border-t border-border/50 bg-background","px-4 py-2.5 text-xs text-muted-foreground",l?"block":"hidden md:block",n?"text-center":"text-left"),children:e.jsxs("div",{className:N("flex items-center gap-1.5",n?"justify-center":"justify-start"),children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsxs("span",{className:N("tracking-wide whitespace-nowrap","transition-opacity duration-200",n&&"md:opacity-0"),children:["v",window?.settings?.version]})]})}),e.jsx(T,{onClick:()=>a(o=>!o),size:"icon",variant:"outline",className:"absolute -right-5 top-1/2 hidden rounded-full md:inline-flex","aria-label":c("common:toggleSidebar"),children:e.jsx(Ci,{stroke:1.5,className:`h-5 w-5 ${n?"rotate-180":""}`})})]})]})}function Qd(){const[s,n]=Fr({key:"collapsed-sidebar",defaultValue:!1});return m.useEffect(()=>{const a=()=>{n(window.innerWidth<768?!1:s)};return a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[s,n]),[s,n]}function Jd(){const[s,n]=Qd();return e.jsxs("div",{className:"relative h-full overflow-hidden bg-background",children:[e.jsx(Yd,{isCollapsed:s,setIsCollapsed:n}),e.jsx("main",{id:"content",className:`overflow-x-hidden pt-16 transition-[margin] md:overflow-y-hidden md:pt-0 ${s?"md:ml-14":"md:ml-64"} h-full`,children:e.jsx(Ca,{})})]})}const Zd=Object.freeze(Object.defineProperty({__proto__:null,default:Jd},Symbol.toStringTag,{value:"Module"})),Vs=m.forwardRef(({className:s,...n},a)=>e.jsx(Oe,{ref:a,className:N("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...n}));Vs.displayName=Oe.displayName;const Xd=({children:s,...n})=>e.jsx(ve,{...n,children:e.jsx(pe,{className:"overflow-hidden p-0",children:e.jsx(Vs,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:s})})}),Hs=m.forwardRef(({className:s,...n},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Si,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Oe.Input,{ref:a,className:N("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...n})]}));Hs.displayName=Oe.Input.displayName;const Fs=m.forwardRef(({className:s,...n},a)=>e.jsx(Oe.List,{ref:a,className:N("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...n}));Fs.displayName=Oe.List.displayName;const Ks=m.forwardRef((s,n)=>e.jsx(Oe.Empty,{ref:n,className:"py-6 text-center text-sm",...s}));Ks.displayName=Oe.Empty.displayName;const Be=m.forwardRef(({className:s,...n},a)=>e.jsx(Oe.Group,{ref:a,className:N("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...n}));Be.displayName=Oe.Group.displayName;const tt=m.forwardRef(({className:s,...n},a)=>e.jsx(Oe.Separator,{ref:a,className:N("-mx-1 h-px bg-border",s),...n}));tt.displayName=Oe.Separator.displayName;const Ie=m.forwardRef(({className:s,...n},a)=>e.jsx(Oe.Item,{ref:a,className:N("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n}));Ie.displayName=Oe.Item.displayName;function eu(){const s=[];for(const n of Mr)if(n.href&&s.push(n),n.sub)for(const a of n.sub)s.push({...a,parent:n.title});return s}function $e(){const[s,n]=m.useState(!1),a=Ss(),l=eu(),{t:r}=F("search"),{t:c}=F("nav");m.useEffect(()=>{const u=x=>{x.key==="k"&&(x.metaKey||x.ctrlKey)&&(x.preventDefault(),n(i=>!i))};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[]);const o=m.useCallback(u=>{n(!1),a(u)},[a]);return e.jsxs(e.Fragment,{children:[e.jsxs(G,{variant:"outline",className:"relative h-9 w-9 p-0 xl:h-10 xl:w-60 xl:justify-start xl:px-3 xl:py-2",onClick:()=>n(!0),children:[e.jsx(An,{className:"h-4 w-4 xl:mr-2"}),e.jsx("span",{className:"hidden xl:inline-flex",children:r("placeholder")}),e.jsx("span",{className:"sr-only",children:r("shortcut.label")}),e.jsx("kbd",{className:"pointer-events-none absolute right-1.5 top-2 hidden h-6 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 xl:flex",children:r("shortcut.key")})]}),e.jsxs(Xd,{open:s,onOpenChange:n,children:[e.jsx(Hs,{placeholder:r("placeholder")}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:r("noResults")}),e.jsx(Be,{heading:r("title"),children:l.map(u=>e.jsxs(Ie,{value:`${u.parent?u.parent+" ":""}${u.title}`,onSelect:()=>o(u.href),children:[e.jsx("div",{className:"mr-2",children:u.icon}),e.jsx("span",{children:c(u.title)}),u.parent&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:c(u.parent)})]},u.href))})]})]})]})}const le=window?.settings?.secure_path,zr=5*60*1e3,ya=new Map,su=s=>{const n=ya.get(s);return n?Date.now()-n.timestamp>zr?(ya.delete(s),null):n.data:null},tu=(s,n)=>{ya.set(s,{data:n,timestamp:Date.now()})},au=async(s,n=zr)=>{const a=su(s);if(a)return a;const l=await I.get(s);return tu(s,l),l},Lt={getList:s=>I.post(`${le}/user/fetch`,s),update:s=>I.post(`${le}/user/update`,s),resetSecret:s=>I.post(`${le}/user/resetSecret`,{id:s}),generate:s=>I.post(`${le}/user/generate`,s),getStats:s=>I.post(`${le}/stat/getStatUser`,s),destroy:s=>I.post(`${le}/user/destroy`,{id:s}),sendMail:s=>I.post(`${le}/user/sendMail`,s),dumpCSV:s=>I.post(`${le}/user/dumpCSV`,s,{responseType:"blob"}),batchBan:s=>I.post(`${le}/user/ban`,s)},nn={getList:()=>au(`${le}/notice/fetch`),save:s=>I.post(`${le}/notice/save`,s),drop:s=>I.post(`${le}/notice/drop`,{id:s}),updateStatus:s=>I.post(`${le}/notice/show`,{id:s}),sort:s=>I.post(`${le}/notice/sort`,{ids:s})},ia={getList:s=>I.post(`${le}/ticket/fetch`,s),getInfo:s=>I.get(`${le}/ticket/fetch?id=${s}`),reply:s=>I.post(`${le}/ticket/reply`,s),close:s=>I.post(`${le}/ticket/close`,{id:s})},rn={getSystemStatus:()=>I.get(`${le}/system/getSystemStatus`),getQueueStats:()=>I.get(`${le}/system/getQueueStats`),getQueueWorkload:()=>I.get(`${le}/system/getQueueWorkload`),getQueueMasters:()=>I.get(`${le}/system/getQueueMasters`),getSystemLog:s=>I.get(`${le}/system/getSystemLog`,{params:s})},bs={getPluginList:()=>I.get(`${le}/plugin/getPlugins`),uploadPlugin:s=>{const n=new FormData;return n.append("file",s),I.post(`${le}/plugin/upload`,n,{headers:{"Content-Type":"multipart/form-data"}})},deletePlugin:s=>I.post(`${le}/plugin/delete`,{code:s}),installPlugin:s=>I.post(`${le}/plugin/install`,{code:s}),uninstallPlugin:s=>I.post(`${le}/plugin/uninstall`,{code:s}),enablePlugin:s=>I.post(`${le}/plugin/enable`,{code:s}),disablePlugin:s=>I.post(`${le}/plugin/disable`,{code:s}),getPluginConfig:s=>I.get(`${le}/plugin/config`,{params:{code:s}}),updatePluginConfig:(s,n)=>I.post(`${le}/plugin/config`,{code:s,config:n})},nu=()=>I.get(`${le}/update/check`),ru=()=>I.post(`${le}/update/execute`),lu=Ls("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/10",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function K({className:s,variant:n,...a}){return e.jsx("div",{className:N(lu({variant:n}),s),...a})}const zs=m.forwardRef(({className:s,children:n,...a},l)=>e.jsxs($n,{ref:l,className:N("relative overflow-hidden",s),...a,children:[e.jsx(ki,{className:"h-full w-full rounded-[inherit]",children:n}),e.jsx(At,{}),e.jsx(Ti,{})]}));zs.displayName=$n.displayName;const At=m.forwardRef(({className:s,orientation:n="vertical",...a},l)=>e.jsx(qn,{ref:l,orientation:n,className:N("flex touch-none select-none transition-colors",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(Di,{className:"relative flex-1 rounded-full bg-border"})}));At.displayName=qn.displayName;function iu(){const{t:s}=F("common"),[n,a]=m.useState(!1),{data:l}=ie({queryKey:["checkUpdate"],queryFn:async()=>await nu(),refetchInterval:1e3*60*60}),r=l?.data,c=Je({mutationFn:ru,onSuccess:o=>{const u=o.data;u.success?($.success(s("update.updateSuccess")),a(!1)):$.error(u.message)},onError:()=>{$.error(s("update.updateFailed"))}});return r?.has_update?e.jsxs(e.Fragment,{children:[e.jsxs(T,{size:"icon",variant:"ghost",className:"rounded-full relative",onClick:()=>a(!0),children:[e.jsx(Pi,{size:20,className:"text-red-500"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx(ve,{open:n,onOpenChange:a,children:e.jsxs(pe,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:s("update.title")}),e.jsxs(ke,{children:[s("update.newVersion")," ",r?.latest_version]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[s("update.currentVersion"),"：",r?.current_version]}),e.jsxs(K,{variant:"outline",children:[s("update.latestVersion"),"：",r?.latest_version]})]}),e.jsx(zs,{className:"h-[200px] rounded-md border p-4",children:e.jsx("div",{className:"space-y-4",children:r?.update_logs.map(o=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(K,{variant:"secondary",children:o.version}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Qe(new Date(o.date),"yyyy-MM-dd HH:mm")})]}),e.jsx("p",{className:"text-sm",children:o.message})]},o.version))})})]}),e.jsxs(Me,{children:[e.jsx(T,{variant:"outline",onClick:()=>a(!1),children:s("update.updateLater")}),e.jsx(T,{onClick:()=>c.mutate(),disabled:c.isPending,children:c.isPending?s("update.updating"):s("update.updateNow")})]})]})})]}):null}function ze(){const{theme:s,setTheme:n}=ec();return m.useEffect(()=>{const a=s==="dark"?"#020817":"#fff",l=document.querySelector("meta[name='theme-color']");l&&l.setAttribute("content",a)},[s]),e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"icon",variant:"ghost",className:"rounded-full",onClick:()=>n(s==="light"?"dark":"light"),children:s==="light"?e.jsx(Ei,{size:20}):e.jsx(Ri,{size:20})}),e.jsx(Er,{}),e.jsx(iu,{})]})}const Lr=m.forwardRef(({className:s,...n},a)=>e.jsx(Un,{ref:a,className:N("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...n}));Lr.displayName=Un.displayName;const Ar=m.forwardRef(({className:s,...n},a)=>e.jsx(Hn,{ref:a,className:N("aspect-square h-full w-full",s),...n}));Ar.displayName=Hn.displayName;const $r=m.forwardRef(({className:s,...n},a)=>e.jsx(Kn,{ref:a,className:N("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...n}));$r.displayName=Kn.displayName;function Le(){const s=Ss(),n=yn(),a=Ii(Pd),{t:l}=F(["common"]),r=()=>{yr(),n(Dd()),s("/sign-in")},c=a?.email?.split("@")[0]||l("common:user"),o=c.substring(0,2).toUpperCase();return e.jsxs(ws,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:e.jsxs(Lr,{className:"h-8 w-8",children:[e.jsx(Ar,{src:a?.avatar_url,alt:c}),e.jsx($r,{children:o})]})})}),e.jsxs(xs,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(Ia,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:c}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:a?.email||l("common:defaultEmail")})]})}),e.jsx(et,{}),e.jsx(ge,{asChild:!0,children:e.jsxs($s,{to:"/config/system",children:[l("common:settings"),e.jsx(ba,{children:"⌘S"})]})}),e.jsx(et,{}),e.jsxs(ge,{onClick:r,children:[l("common:logout"),e.jsx(ba,{children:"⇧⌘Q"})]})]})]})}const X=Vi,Ds=qi,ee=Fi,Q=m.forwardRef(({className:s,children:n,...a},l)=>e.jsxs(Bn,{ref:l,className:N("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[n,e.jsx(Oi,{asChild:!0,children:e.jsx(Da,{className:"h-4 w-4 opacity-50"})})]}));Q.displayName=Bn.displayName;const qr=m.forwardRef(({className:s,...n},a)=>e.jsx(Gn,{ref:a,className:N("flex cursor-default items-center justify-center py-1",s),...n,children:e.jsx(Mi,{className:"h-4 w-4"})}));qr.displayName=Gn.displayName;const Ur=m.forwardRef(({className:s,...n},a)=>e.jsx(Wn,{ref:a,className:N("flex cursor-default items-center justify-center py-1",s),...n,children:e.jsx(Da,{className:"h-4 w-4"})}));Ur.displayName=Wn.displayName;const J=m.forwardRef(({className:s,children:n,position:a="popper",...l},r)=>e.jsx(zi,{children:e.jsxs(Yn,{ref:r,className:N("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[e.jsx(qr,{}),e.jsx(Li,{className:N("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx(Ur,{})]})}));J.displayName=Yn.displayName;const ou=m.forwardRef(({className:s,...n},a)=>e.jsx(Qn,{ref:a,className:N("px-2 py-1.5 text-sm font-semibold",s),...n}));ou.displayName=Qn.displayName;const U=m.forwardRef(({className:s,children:n,...a},l)=>e.jsxs(Jn,{ref:l,className:N("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ai,{children:e.jsx(As,{className:"h-4 w-4"})})}),e.jsx($i,{children:n})]}));U.displayName=Jn.displayName;const cu=m.forwardRef(({className:s,...n},a)=>e.jsx(Zn,{ref:a,className:N("-mx-1 my-1 h-px bg-muted",s),...n}));cu.displayName=Zn.displayName;function Bs({className:s,classNames:n,showOutsideDays:a=!0,...l}){return e.jsx(Ui,{showOutsideDays:a,className:N("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:N(Xs({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:N("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",l.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:N(Xs({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...n},components:{IconLeft:({className:r,...c})=>e.jsx(Xn,{className:N("h-4 w-4",r),...c}),IconRight:({className:r,...c})=>e.jsx(ka,{className:N("h-4 w-4",r),...c})},...l})}Bs.displayName="Calendar";const fs=Ki,gs=Bi,ds=m.forwardRef(({className:s,align:n="center",sideOffset:a=4,...l},r)=>e.jsx(Hi,{children:e.jsx(er,{ref:r,align:n,sideOffset:a,className:N("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})}));ds.displayName=er.displayName;const Ps={income:{main:"hsl(var(--primary))",gradient:{start:"hsl(var(--primary))",end:"transparent"}},commission:{main:"hsl(var(--secondary))",gradient:{start:"hsl(var(--secondary))",end:"transparent"}}},ct=s=>(s/100).toFixed(2),du=({active:s,payload:n,label:a})=>{const{t:l}=F();return s&&n&&n.length?e.jsxs("div",{className:"rounded-lg border bg-background p-3 shadow-sm",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:a}),n.map((r,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:r.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[l(r.name),":"]}),e.jsx("span",{className:"font-medium",children:r.name.includes(l("dashboard:overview.amount"))?`¥${ct(r.value)}`:l("dashboard:overview.transactions",{count:r.value})})]},c))]}):null},uu=[{value:"7d",label:"dashboard:overview.last7Days"},{value:"30d",label:"dashboard:overview.last30Days"},{value:"90d",label:"dashboard:overview.last90Days"},{value:"180d",label:"dashboard:overview.last180Days"},{value:"365d",label:"dashboard:overview.lastYear"},{value:"custom",label:"dashboard:overview.customRange"}],mu=(s,n)=>{const a=new Date;if(s==="custom"&&n)return{startDate:n.from,endDate:n.to};let l;switch(s){case"7d":l=ns(a,7);break;case"30d":l=ns(a,30);break;case"90d":l=ns(a,90);break;case"180d":l=ns(a,180);break;case"365d":l=ns(a,365);break;default:l=ns(a,30)}return{startDate:l,endDate:a}};function xu(){const[s,n]=m.useState("amount"),[a,l]=m.useState("30d"),[r,c]=m.useState({from:ns(new Date,7),to:new Date}),{t:o}=F(),{startDate:u,endDate:x}=mu(a,r),{data:i}=ie({queryKey:["orderStat",{start_date:Qe(u,"yyyy-MM-dd"),end_date:Qe(x,"yyyy-MM-dd")}],queryFn:async()=>{const{data:d}=await vc({start_date:Qe(u,"yyyy-MM-dd"),end_date:Qe(x,"yyyy-MM-dd")});return d},refetchInterval:3e4});return e.jsxs(Ke,{children:[e.jsx(Xe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_s,{children:o("dashboard:overview.title")}),e.jsxs(Zs,{children:[i?.summary.start_date," ",o("dashboard:overview.to")," ",i?.summary.end_date]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsxs(X,{value:a,onValueChange:d=>l(d),children:[e.jsx(Q,{className:"w-[120px]",children:e.jsx(ee,{placeholder:o("dashboard:overview.selectTimeRange")})}),e.jsx(J,{children:uu.map(d=>e.jsx(U,{value:d.value,children:o(d.label)},d.value))})]}),a==="custom"&&e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:N("min-w-0 justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(jt,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r?.from?r.to?e.jsxs(e.Fragment,{children:[Qe(r.from,"yyyy-MM-dd")," -"," ",Qe(r.to,"yyyy-MM-dd")]}):Qe(r.from,"yyyy-MM-dd"):o("dashboard:overview.selectDate")})]})}),e.jsx(ds,{className:"w-auto p-0",align:"end",children:e.jsx(Bs,{mode:"range",defaultMonth:r?.from,selected:{from:r?.from,to:r?.to},onSelect:d=>{d?.from&&d?.to&&c({from:d.from,to:d.to})},numberOfMonths:2})})]})]}),e.jsx(Wt,{value:s,onValueChange:d=>n(d),children:e.jsxs(bt,{children:[e.jsx(He,{value:"amount",children:o("dashboard:overview.amount")}),e.jsx(He,{value:"count",children:o("dashboard:overview.count")})]})})]})]})}),e.jsxs(es,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o("dashboard:overview.totalIncome")}),e.jsxs("div",{className:"text-2xl font-bold",children:["¥",ct(i?.summary?.paid_total||0)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o("dashboard:overview.totalTransactions",{count:i?.summary?.paid_count||0})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[o("dashboard:overview.avgOrderAmount")," ¥",ct(i?.summary?.avg_paid_amount||0)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o("dashboard:overview.totalCommission")}),e.jsxs("div",{className:"text-2xl font-bold",children:["¥",ct(i?.summary?.commission_total||0)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o("dashboard:overview.totalTransactions",{count:i?.summary?.commission_count||0})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[o("dashboard:overview.commissionRate")," ",i?.summary?.commission_rate.toFixed(2)||0,"%"]})]})]}),e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(Gi,{width:"100%",height:"100%",children:e.jsxs(Wi,{data:i?.list||[],margin:{top:20,right:20,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"incomeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:Ps.income.gradient.start,stopOpacity:.2}),e.jsx("stop",{offset:"100%",stopColor:Ps.income.gradient.end,stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"commissionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:Ps.commission.gradient.start,stopOpacity:.2}),e.jsx("stop",{offset:"100%",stopColor:Ps.commission.gradient.end,stopOpacity:.1})]})]}),e.jsx(Yi,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:d=>Qe(new Date(d),"MM-dd",{locale:Xi})}),e.jsx(Qi,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:d=>s==="amount"?`¥${ct(d)}`:o("dashboard:overview.transactions",{count:d})}),e.jsx(Ji,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))",opacity:.3}),e.jsx(Zi,{content:e.jsx(du,{})}),s==="amount"?e.jsxs(e.Fragment,{children:[e.jsx(Ga,{type:"monotone",dataKey:"paid_total",name:o("dashboard:overview.orderAmount"),stroke:Ps.income.main,fill:"url(#incomeGradient)",strokeWidth:2}),e.jsx(Ga,{type:"monotone",dataKey:"commission_total",name:o("dashboard:overview.commissionAmount"),stroke:Ps.commission.main,fill:"url(#commissionGradient)",strokeWidth:2})]}):e.jsxs(e.Fragment,{children:[e.jsx(Wa,{dataKey:"paid_count",name:o("dashboard:overview.orderCount"),fill:Ps.income.main,radius:[4,4,0,0],maxBarSize:40}),e.jsx(Wa,{dataKey:"commission_count",name:o("dashboard:overview.commissionCount"),fill:Ps.commission.main,radius:[4,4,0,0],maxBarSize:40})]})]})})})]})]})}function oe({className:s,...n}){return e.jsx("div",{className:N("animate-pulse rounded-md bg-primary/10",s),...n})}function hu(){return e.jsxs(Ke,{children:[e.jsxs(Xe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(oe,{className:"h-4 w-[120px]"}),e.jsx(oe,{className:"h-4 w-4"})]}),e.jsxs(es,{children:[e.jsx(oe,{className:"h-8 w-[140px] mb-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(oe,{className:"h-4 w-[100px]"})]})]})]})}function pu(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8}).map((s,n)=>e.jsx(hu,{},n))})}var re=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.CANCELLED=2]="CANCELLED",s[s.COMPLETED=3]="COMPLETED",s[s.DISCOUNTED=4]="DISCOUNTED",s))(re||{});const it={0:"待支付",1:"开通中",2:"已取消",3:"已完成",4:"已折抵"},ot={0:"yellow-500",1:"blue-500",2:"red-500",3:"green-500",4:"green-500"};var rs=(s=>(s[s.NEW=1]="NEW",s[s.RENEWAL=2]="RENEWAL",s[s.UPGRADE=3]="UPGRADE",s[s.RESET_FLOW=4]="RESET_FLOW",s))(rs||{}),me=(s=>(s[s.PENDING=0]="PENDING",s[s.PROCESSING=1]="PROCESSING",s[s.VALID=2]="VALID",s[s.INVALID=3]="INVALID",s))(me||{});const wt={0:"待确认",1:"发放中",2:"有效",3:"无效"},Ct={0:"yellow-500",1:"blue-500",2:"green-500",3:"red-500"};var De=(s=>(s.MONTH_PRICE="month_price",s.QUARTER_PRICE="quarter_price",s.HALF_YEAR_PRICE="half_year_price",s.YEAR_PRICE="year_price",s.TWO_YEAR_PRICE="two_year_price",s.THREE_YEAR_PRICE="three_year_price",s.ONETIME_PRICE="onetime_price",s.RESET_PRICE="reset_price",s))(De||{});const fu={month_price:"月付",quarter_price:"季付",half_year_price:"半年付",year_price:"年付",two_year_price:"两年付",three_year_price:"三年付",onetime_price:"一次性",reset_price:"流量重置包"};var Te=(s=>(s.Shadowsocks="shadowsocks",s.Vmess="vmess",s.Trojan="trojan",s.Hysteria="hysteria",s.Vless="vless",s))(Te||{});const Ms=[{type:"shadowsocks",label:"Shadowsocks"},{type:"vmess",label:"VMess"},{type:"trojan",label:"Trojan"},{type:"hysteria",label:"Hysteria"},{type:"vless",label:"VLess"}],Ns={shadowsocks:"#489851",vmess:"#CB3180",trojan:"#EBB749",hysteria:"#5684e6",vless:"#1a1a1a"};var Ue=(s=>(s[s.AMOUNT=1]="AMOUNT",s[s.PERCENTAGE=2]="PERCENTAGE",s))(Ue||{});const gu={1:"按金额优惠",2:"按比例优惠"};var Is=(s=>(s[s.OPENING=0]="OPENING",s[s.CLOSED=1]="CLOSED",s))(Is||{}),Fe=(s=>(s[s.LOW=0]="LOW",s[s.MIDDLE=1]="MIDDLE",s[s.HIGH=2]="HIGH",s))(Fe||{}),mt=(s=>(s.MONTH="monthly",s.QUARTER="quarterly",s.HALF_YEAR="half_yearly",s.YEAR="yearly",s.TWO_YEAR="two_yearly",s.THREE_YEAR="three_yearly",s.ONETIME="onetime",s.RESET="reset_traffic",s))(mt||{});function Es({title:s,value:n,icon:a,trend:l,description:r,onClick:c,highlight:o,className:u}){return e.jsxs(Ke,{className:N("transition-colors",c&&"cursor-pointer hover:bg-muted/50",o&&"border-primary/50",u),onClick:c,children:[e.jsxs(Xe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_s,{className:"text-sm font-medium",children:s}),a]}),e.jsxs(es,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n}),l?e.jsxs("div",{className:"flex items-center pt-1",children:[e.jsx(ro,{className:N("h-4 w-4",l.isPositive?"text-emerald-500":"text-red-500")}),e.jsxs("span",{className:N("ml-1 text-xs",l.isPositive?"text-emerald-500":"text-red-500"),children:[l.isPositive?"+":"-",Math.abs(l.value),"%"]}),e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:l.label})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:r})]})]})}function ju({className:s}){const n=Ss(),{t:a}=F(),{data:l,isLoading:r}=ie({queryKey:["dashboardStats"],queryFn:async()=>(await bc()).data,refetchInterval:1e3*60*5});if(r||!l)return e.jsx(pu,{});const c=()=>{const o=new URLSearchParams;o.set("commission_status",me.PENDING.toString()),o.set("status",re.COMPLETED.toString()),o.set("commission_balance","gt:0"),n(`/finance/order?${o.toString()}`)};return e.jsxs("div",{className:N("grid gap-4 md:grid-cols-2 lg:grid-cols-4",s),children:[e.jsx(Es,{title:a("dashboard:stats.todayIncome"),value:Os(l.todayIncome),icon:e.jsx(eo,{className:"h-4 w-4 text-emerald-500"}),trend:{value:l.dayIncomeGrowth,label:a("dashboard:stats.vsYesterday"),isPositive:l.dayIncomeGrowth>0}}),e.jsx(Es,{title:a("dashboard:stats.monthlyIncome"),value:Os(l.currentMonthIncome),icon:e.jsx(so,{className:"h-4 w-4 text-blue-500"}),trend:{value:l.monthIncomeGrowth,label:a("dashboard:stats.vsLastMonth"),isPositive:l.monthIncomeGrowth>0}}),e.jsx(Es,{title:a("dashboard:stats.pendingTickets"),value:l.ticketPendingTotal,icon:e.jsx(to,{className:N("h-4 w-4",l.ticketPendingTotal>0?"text-orange-500":"text-muted-foreground")}),description:l.ticketPendingTotal>0?a("dashboard:stats.hasPendingTickets"):a("dashboard:stats.noPendingTickets"),onClick:()=>n("/user/ticket"),highlight:l.ticketPendingTotal>0}),e.jsx(Es,{title:a("dashboard:stats.pendingCommission"),value:l.commissionPendingTotal,icon:e.jsx(ao,{className:N("h-4 w-4",l.commissionPendingTotal>0?"text-blue-500":"text-muted-foreground")}),description:l.commissionPendingTotal>0?a("dashboard:stats.hasPendingCommission"):a("dashboard:stats.noPendingCommission"),onClick:c,highlight:l.commissionPendingTotal>0}),e.jsx(Es,{title:a("dashboard:stats.monthlyNewUsers"),value:l.currentMonthNewUsers,icon:e.jsx(pa,{className:"h-4 w-4 text-blue-500"}),trend:{value:l.userGrowth,label:a("dashboard:stats.vsLastMonth"),isPositive:l.userGrowth>0}}),e.jsx(Es,{title:a("dashboard:stats.totalUsers"),value:l.totalUsers,icon:e.jsx(pa,{className:"h-4 w-4 text-muted-foreground"}),description:a("dashboard:stats.activeUsers",{count:l.activeUsers})}),e.jsx(Es,{title:a("dashboard:stats.monthlyUpload"),value:ms(l.monthTraffic.upload),icon:e.jsx(ht,{className:"h-4 w-4 text-emerald-500"}),description:a("dashboard:stats.todayTraffic",{value:ms(l.todayTraffic.upload)})}),e.jsx(Es,{title:a("dashboard:stats.monthlyDownload"),value:ms(l.monthTraffic.download),icon:e.jsx(no,{className:"h-4 w-4 text-blue-500"}),description:a("dashboard:stats.todayTraffic",{value:ms(l.todayTraffic.download)})})]})}const Na={today:{getValue:()=>{const s=io();return{start:s,end:oo(s,1)}}},last7days:{getValue:()=>{const s=new Date;return{start:ns(s,7),end:s}}},last30days:{getValue:()=>{const s=new Date;return{start:ns(s,30),end:s}}},custom:{getValue:()=>null}};function ln({selectedRange:s,customDateRange:n,onRangeChange:a,onCustomRangeChange:l}){const{t:r}=F(),c={today:r("dashboard:trafficRank.today"),last7days:r("dashboard:trafficRank.last7days"),last30days:r("dashboard:trafficRank.last30days"),custom:r("dashboard:trafficRank.customRange")};return e.jsxs("div",{className:"flex min-w-0 flex-wrap items-center gap-1",children:[e.jsxs(X,{value:s,onValueChange:a,children:[e.jsx(Q,{className:"w-[120px]",children:e.jsx(ee,{placeholder:r("dashboard:trafficRank.selectTimeRange")})}),e.jsx(J,{position:"popper",className:"z-50",children:Object.entries(Na).map(([o])=>e.jsx(U,{value:o,children:c[o]},o))})]}),s==="custom"&&e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:N("min-w-0 justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[e.jsx(jt,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n?.from?n.to?e.jsxs(e.Fragment,{children:[Qe(n.from,"yyyy-MM-dd")," -"," ",Qe(n.to,"yyyy-MM-dd")]}):Qe(n.from,"yyyy-MM-dd"):e.jsx("span",{children:r("dashboard:trafficRank.selectDateRange")})})]})}),e.jsx(ds,{className:"w-auto p-0",align:"end",children:e.jsx(Bs,{mode:"range",defaultMonth:n?.from,selected:{from:n?.from,to:n?.to},onSelect:o=>{o?.from&&o?.to&&l({from:o.from,to:o.to})},numberOfMonths:2})})]})]})}const Ws=s=>`${(s/1024/1024/1024).toFixed(2)} GB`;function vu({className:s}){const{t:n}=F(),[a,l]=m.useState("today"),[r,c]=m.useState({from:ns(new Date,7),to:new Date}),[o,u]=m.useState("today"),[x,i]=m.useState({from:ns(new Date,7),to:new Date}),d=m.useMemo(()=>a==="custom"?{start:r.from,end:r.to}:Na[a].getValue(),[a,r]),p=m.useMemo(()=>o==="custom"?{start:x.from,end:x.to}:Na[o].getValue(),[o,x]),{data:w}=ie({queryKey:["nodeTrafficRank",d.start,d.end],queryFn:()=>tn({type:"node",start_time:Ce.round(d.start.getTime()/1e3),end_time:Ce.round(d.end.getTime()/1e3)}),refetchInterval:3e4}),{data:P}=ie({queryKey:["userTrafficRank",p.start,p.end],queryFn:()=>tn({type:"user",start_time:Ce.round(p.start.getTime()/1e3),end_time:Ce.round(p.end.getTime()/1e3)}),refetchInterval:3e4});return e.jsxs("div",{className:N("grid gap-4 md:grid-cols-2",s),children:[e.jsxs(Ke,{children:[e.jsx(Xe,{className:"flex-none pb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(_s,{className:"flex items-center text-base font-medium",children:[e.jsx(lo,{className:"mr-2 h-4 w-4"}),n("dashboard:trafficRank.nodeTrafficRank")]}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx(ln,{selectedRange:a,customDateRange:r,onRangeChange:l,onCustomRangeChange:c}),e.jsx(Ya,{className:"h-4 w-4 flex-shrink-0 text-muted-foreground"})]})]})}),e.jsx(es,{className:"flex-1",children:w?.data?e.jsxs(zs,{className:"h-[400px] pr-4",children:[e.jsx("div",{className:"space-y-3",children:w.data.map(f=>e.jsx(je,{delayDuration:200,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx("div",{className:"flex cursor-pointer items-center justify-between space-x-2 rounded-lg bg-muted/50 p-2 transition-colors hover:bg-muted/70",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate text-sm font-medium",children:f.name}),e.jsxs("span",{className:N("ml-2 flex items-center text-xs font-medium",f.change>=0?"text-green-600":"text-red-600"),children:[f.change>=0?e.jsx(fa,{className:"mr-1 h-3 w-3"}):e.jsx(ga,{className:"mr-1 h-3 w-3"}),Math.abs(f.change),"%"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 flex-1 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${f.value/w.data[0].value*100}%`}})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ws(f.value)})]})]})})}),e.jsx(ce,{side:"right",className:"space-y-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.currentTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:Ws(f.value)}),e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.previousTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:Ws(f.previousValue)}),e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.changeRate"),"："]}),e.jsxs("span",{className:N("font-medium",f.change>=0?"text-green-600":"text-red-600"),children:[f.change>=0?"+":"",f.change,"%"]})]})})]})},f.id))}),e.jsx(At,{orientation:"vertical"})]}):e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:n("common:loading")})})})]}),e.jsxs(Ke,{children:[e.jsx(Xe,{className:"flex-none pb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs(_s,{className:"flex items-center text-base font-medium",children:[e.jsx(pa,{className:"mr-2 h-4 w-4"}),n("dashboard:trafficRank.userTrafficRank")]}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx(ln,{selectedRange:o,customDateRange:x,onRangeChange:u,onCustomRangeChange:i}),e.jsx(Ya,{className:"h-4 w-4 flex-shrink-0 text-muted-foreground"})]})]})}),e.jsx(es,{className:"flex-1",children:P?.data?e.jsxs(zs,{className:"h-[400px] pr-4",children:[e.jsx("div",{className:"space-y-3",children:P.data.map(f=>e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx("div",{className:"flex cursor-pointer items-center justify-between space-x-2 rounded-lg bg-muted/50 p-2 transition-colors hover:bg-muted/70",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate text-sm font-medium",children:f.name}),e.jsxs("span",{className:N("ml-2 flex items-center text-xs font-medium",f.change>=0?"text-green-600":"text-red-600"),children:[f.change>=0?e.jsx(fa,{className:"mr-1 h-3 w-3"}):e.jsx(ga,{className:"mr-1 h-3 w-3"}),Math.abs(f.change),"%"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 flex-1 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${f.value/P.data[0].value*100}%`}})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ws(f.value)})]})]})})}),e.jsx(ce,{side:"right",className:"space-y-2 p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.currentTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:Ws(f.value)}),e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.previousTraffic"),"："]}),e.jsx("span",{className:"font-medium",children:Ws(f.previousValue)}),e.jsxs("span",{className:"text-muted-foreground",children:[n("dashboard:trafficRank.changeRate"),"："]}),e.jsxs("span",{className:N("font-medium",f.change>=0?"text-green-600":"text-red-600"),children:[f.change>=0?"+":"",f.change,"%"]})]})})]})},f.id))}),e.jsx(At,{orientation:"vertical"})]}):e.jsx("div",{className:"flex h-[400px] items-center justify-center",children:e.jsx("div",{className:"animate-pulse",children:n("common:loading")})})})]})]})}const Et=m.forwardRef(({className:s,value:n,...a},l)=>e.jsx(sr,{ref:l,className:N("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...a,children:e.jsx(co,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})}));Et.displayName=sr.displayName;function bu(){const{t:s}=F(),[n,a]=m.useState(null),[l,r]=m.useState(null),[c,o]=m.useState(!0),[u,x]=m.useState(!1),i=async()=>{try{x(!0);const[w,P]=await Promise.all([rn.getSystemStatus(),rn.getQueueStats()]);a(w.data),r(P.data)}catch(w){console.error("Error fetching system data:",w)}finally{o(!1),x(!1)}};m.useEffect(()=>{i();const w=setInterval(i,3e4);return()=>clearInterval(w)},[]);const d=()=>{i()};if(c)return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(Pa,{className:"h-6 w-6 animate-spin"})});const p=w=>w?e.jsx(tr,{className:"h-5 w-5 text-green-500"}):e.jsx(ar,{className:"h-5 w-5 text-red-500"});return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ke,{children:[e.jsxs(Xe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(_s,{className:"flex items-center gap-2",children:[e.jsx(uo,{className:"h-5 w-5"}),s("dashboard:queue.title")]}),e.jsx(Zs,{children:s("dashboard:queue.status.description")})]}),e.jsx(G,{variant:"outline",size:"icon",onClick:d,disabled:u,children:e.jsx(mo,{className:N("h-4 w-4",u&&"animate-spin")})})]}),e.jsx(es,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p(l?.status||!1),e.jsx("span",{className:"font-medium",children:s("dashboard:queue.status.running")})]}),e.jsx(K,{variant:l?.status?"secondary":"destructive",children:l?.status?s("dashboard:queue.status.normal"):s("dashboard:queue.status.abnormal")})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.status.waitTime",{seconds:l?.wait?.default||0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.recentJobs")}),e.jsx("p",{className:"text-2xl font-bold",children:l?.recentJobs||0}),e.jsx(Et,{value:(l?.recentJobs||0)/(l?.periods?.recentJobs||1)*100,className:"h-1"})]})}),e.jsx(ce,{children:e.jsx("p",{children:s("dashboard:queue.details.statisticsPeriod",{hours:l?.periods?.recentJobs||0})})})]})}),e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.jobsPerMinute")}),e.jsx("p",{className:"text-2xl font-bold",children:l?.jobsPerMinute||0}),e.jsx(Et,{value:(l?.jobsPerMinute||0)/(l?.queueWithMaxThroughput?.throughput||1)*100,className:"h-1"})]})}),e.jsx(ce,{children:e.jsx("p",{children:s("dashboard:queue.details.maxThroughput",{value:l?.queueWithMaxThroughput?.throughput||0})})})]})})]})]})})]}),e.jsxs(Ke,{children:[e.jsxs(Xe,{children:[e.jsxs(_s,{className:"flex items-center gap-2",children:[e.jsx(xo,{className:"h-5 w-5"}),s("dashboard:queue.jobDetails")]}),e.jsx(Zs,{children:s("dashboard:queue.details.description")})]}),e.jsx(es,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.failedJobs7Days")}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:l?.failedJobs||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("dashboard:queue.details.retentionPeriod",{hours:l?.periods?.failedJobs||0})})]}),e.jsxs("div",{className:"space-y-2 rounded-lg bg-muted/50 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.longestRunningQueue")}),e.jsxs("p",{className:"text-2xl font-bold",children:[l?.queueWithMaxRuntime?.runtime||0,"s"]}),e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:l?.queueWithMaxRuntime?.name||"N/A"})]})]}),e.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s("dashboard:queue.details.activeProcesses")}),e.jsxs("span",{className:"font-medium",children:[l?.processes||0," /"," ",(l?.processes||0)+(l?.pausedMasters||0)]})]}),e.jsx(Et,{value:(l?.processes||0)/((l?.processes||0)+(l?.pausedMasters||0))*100,className:"mt-2 h-1"})]})]})})]})]})}function yu(){const{t:s}=F();return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:s("dashboard:title")})}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx($e,{}),e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsx(Ve,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(ju,{}),e.jsx(xu,{}),e.jsx(vu,{}),e.jsx(bu,{})]})})})]})}const Nu=Object.freeze(Object.defineProperty({__proto__:null,default:yu},Symbol.toStringTag,{value:"Module"}));function _u({className:s,items:n,...a}){const{pathname:l}=wa(),r=Ss(),[c,o]=m.useState(l??"/settings"),u=i=>{o(i),r(i)},{t:x}=F("settings");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-1 md:hidden",children:e.jsxs(X,{value:c,onValueChange:u,children:[e.jsx(Q,{className:"h-12 sm:w-48",children:e.jsx(ee,{placeholder:"Theme"})}),e.jsx(J,{children:n.map(i=>e.jsx(U,{value:i.href,children:e.jsxs("div",{className:"flex gap-x-4 px-2 py-1",children:[e.jsx("span",{className:"scale-125",children:i.icon}),e.jsx("span",{className:"text-md",children:x(i.title)})]})},i.href))})]})}),e.jsx("div",{className:"hidden w-full overflow-x-auto bg-background px-1 py-2 md:block",children:e.jsx("nav",{className:N("flex space-x-2 lg:flex-col lg:space-x-0 lg:space-y-1",s),...a,children:n.map(i=>e.jsxs($s,{to:i.href,className:N(st({variant:"ghost"}),l===i.href?"bg-muted hover:bg-muted":"hover:bg-transparent hover:underline","justify-start"),children:[e.jsx("span",{className:"mr-2",children:i.icon}),x(i.title)]},i.href))})})]})}const wu=[{title:"site.title",key:"site",icon:e.jsx(ho,{size:18}),href:"/config/system",description:"site.description"},{title:"safe.title",key:"safe",icon:e.jsx(zn,{size:18}),href:"/config/system/safe",description:"safe.description"},{title:"subscribe.title",key:"subscribe",icon:e.jsx(Ln,{size:18}),href:"/config/system/subscribe",description:"subscribe.description"},{title:"invite.title",key:"invite",icon:e.jsx(po,{size:18}),href:"/config/system/invite",description:"invite.description"},{title:"server.title",key:"server",icon:e.jsx(Mn,{size:18}),href:"/config/system/server",description:"server.description"},{title:"email.title",key:"email",icon:e.jsx(fo,{size:18}),href:"/config/system/email",description:"email.description"},{title:"telegram.title",key:"telegram",icon:e.jsx(go,{size:18}),href:"/config/system/telegram",description:"telegram.description"},{title:"app.title",key:"app",icon:e.jsx(On,{size:18}),href:"/config/system/app",description:"app.description"},{title:"subscribe_template.title",key:"subscribe_template",icon:e.jsx(jo,{size:18}),href:"/config/system/subscribe-template",description:"subscribe_template.description"}];function Cu(){const{t:s}=F("settings");return e.jsxs(Pe,{fadedBelow:!0,fixedHeight:!0,children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:s("title")}),e.jsx("div",{className:"text-muted-foreground",children:s("description")})]}),e.jsx(Se,{className:"my-6"}),e.jsxs("div",{className:"flex flex-1 flex-col space-y-8 overflow-auto lg:flex-row lg:space-x-12 lg:space-y-0",children:[e.jsx("aside",{className:"sticky top-0 lg:w-1/5",children:e.jsx(_u,{items:wu})}),e.jsx("div",{className:"flex-1 w-full p-1 pr-4",children:e.jsx("div",{className:"pb-16",children:e.jsx(Ca,{})})})]})]})]})}const Su=Object.freeze(Object.defineProperty({__proto__:null,default:Cu},Symbol.toStringTag,{value:"Module"})),W=m.forwardRef(({className:s,...n},a)=>e.jsx(nr,{className:N("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:a,children:e.jsx(vo,{className:N("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));W.displayName=nr.displayName;const js=m.forwardRef(({className:s,...n},a)=>e.jsx("textarea",{className:N("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...n}));js.displayName="Textarea";const ku=h.object({logo:h.string().nullable().default(""),force_https:h.number().nullable().default(0),stop_register:h.number().nullable().default(0),app_name:h.string().nullable().default(""),app_description:h.string().nullable().default(""),app_url:h.string().nullable().default(""),subscribe_url:h.string().nullable().default(""),try_out_plan_id:h.number().nullable().default(0),try_out_hour:h.coerce.number().nullable().default(0),tos_url:h.string().nullable().default(""),currency:h.string().nullable().default(""),currency_symbol:h.string().nullable().default("")});function Tu(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),{data:r}=ie({queryKey:["settings","site"],queryFn:()=>hs("site")}),{data:c}=ie({queryKey:["plans"],queryFn:()=>Us()}),o=fe({resolver:ye(ku),defaultValues:{},mode:"onBlur"}),{mutateAsync:u}=Je({mutationFn:ps,onSuccess:d=>{d.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(r?.data?.site){const d=r?.data?.site;Object.entries(d).forEach(([p,w])=>{o.setValue(p,w)}),l.current=d}},[r]);const x=m.useCallback(Ce.debounce(async d=>{if(!Ce.isEqual(d,l.current)){a(!0);try{const p=Object.entries(d).reduce((w,[P,f])=>(w[P]=f===null?"":f,w),{});await u(p),l.current=d}finally{a(!1)}}},1e3),[u]),i=m.useCallback(d=>{x(d)},[x]);return m.useEffect(()=>{const d=o.watch(p=>{i(p)});return()=>d.unsubscribe()},[o.watch,i]),e.jsx(Ne,{...o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:o.control,name:"app_name",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.siteName.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.siteName.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.siteName.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"app_description",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.siteDescription.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.siteDescription.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.siteDescription.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"app_url",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.siteUrl.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.siteUrl.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.siteUrl.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"force_https",render:({field:d})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("site.form.forceHttps.label")}),e.jsx(z,{children:s("site.form.forceHttps.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:!!d.value,onCheckedChange:p=>{d.onChange(Number(p)),i(o.getValues())}})})]})}),e.jsx(b,{control:o.control,name:"logo",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.logo.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.logo.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.logo.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"subscribe_url",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.subscribeUrl.label")}),e.jsx(_,{children:e.jsx(js,{placeholder:s("site.form.subscribeUrl.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.subscribeUrl.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"tos_url",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.tosUrl.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.tosUrl.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.tosUrl.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"stop_register",render:({field:d})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("site.form.stopRegister.label")}),e.jsx(z,{children:s("site.form.stopRegister.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:!!d.value,onCheckedChange:p=>{d.onChange(Number(p)),i(o.getValues())}})})]})}),e.jsx(b,{control:o.control,name:"try_out_plan_id",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.tryOut.label")}),e.jsx(_,{children:e.jsxs(X,{value:d.value?.toString(),onValueChange:p=>{d.onChange(Number(p)),i(o.getValues())},children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:s("site.form.tryOut.placeholder")})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("site.form.tryOut.placeholder")}),c?.data?.map(p=>e.jsx(U,{value:p.id.toString(),children:p.name},p.id.toString()))]})]})}),e.jsx(z,{children:s("site.form.tryOut.description")}),e.jsx(k,{})]})}),!!o.watch("try_out_plan_id")&&e.jsx(b,{control:o.control,name:"try_out_hour",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"",children:s("site.form.tryOut.duration.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.tryOut.duration.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.tryOut.duration.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"currency",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.currency.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.currency.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.currency.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:o.control,name:"currency_symbol",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("site.form.currencySymbol.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("site.form.currencySymbol.placeholder"),...d,value:d.value||"",onChange:p=>{d.onChange(p),i(o.getValues())}})}),e.jsx(z,{children:s("site.form.currencySymbol.description")}),e.jsx(k,{})]})}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("site.form.saving")})]})})}function Du(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("site.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("site.description")})]}),e.jsx(Se,{}),e.jsx(Tu,{})]})}const Pu=Object.freeze(Object.defineProperty({__proto__:null,default:Du},Symbol.toStringTag,{value:"Module"})),Eu=h.object({email_verify:h.boolean().nullable(),safe_mode_enable:h.boolean().nullable(),secure_path:h.string().nullable(),email_whitelist_enable:h.boolean().nullable(),email_whitelist_suffix:h.array(h.string().nullable()).nullable(),email_gmail_limit_enable:h.boolean().nullable(),recaptcha_enable:h.boolean().nullable(),recaptcha_key:h.string().nullable(),recaptcha_site_key:h.string().nullable(),register_limit_by_ip_enable:h.boolean().nullable(),register_limit_count:h.coerce.string().transform(s=>s===""?null:s).nullable(),register_limit_expire:h.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_enable:h.boolean().nullable(),password_limit_count:h.coerce.string().transform(s=>s===""?null:s).nullable(),password_limit_expire:h.coerce.string().transform(s=>s===""?null:s).nullable()}),Ru={email_verify:!1,safe_mode_enable:!1,secure_path:"",email_whitelist_enable:!1,email_whitelist_suffix:[],email_gmail_limit_enable:!1,recaptcha_enable:!1,recaptcha_key:"",recaptcha_site_key:"",register_limit_by_ip_enable:!1,register_limit_count:"",register_limit_expire:"",password_limit_enable:!1,password_limit_count:"",password_limit_expire:""};function Iu(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye(Eu),defaultValues:Ru,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","safe"],queryFn:()=>hs("safe")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(c?.data.safe){const i=c.data.safe;Object.entries(i).forEach(([d,p])=>{typeof p=="number"?r.setValue(d,String(p)):r.setValue(d,p)}),l.current=i}},[c]);const u=m.useCallback(Ce.debounce(async i=>{if(!Ce.isEqual(i,l.current)){a(!0);try{await o(i),l.current=i}finally{a(!1)}}},1e3),[o]),x=m.useCallback(i=>{u(i)},[u]);return m.useEffect(()=>{const i=r.watch(d=>{x(d)});return()=>i.unsubscribe()},[r.watch,x]),e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"email_verify",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.emailVerify.label")}),e.jsx(z,{children:s("safe.form.emailVerify.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"email_gmail_limit_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.gmailLimit.label")}),e.jsx(z,{children:s("safe.form.gmailLimit.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"safe_mode_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.safeMode.label")}),e.jsx(z,{children:s("safe.form.safeMode.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"secure_path",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.securePath.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.securePath.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.securePath.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"email_whitelist_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.emailWhitelist.label")}),e.jsx(z,{children:s("safe.form.emailWhitelist.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),r.watch("email_whitelist_enable")&&e.jsx(b,{control:r.control,name:"email_whitelist_suffix",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.emailWhitelist.suffixes.label")}),e.jsx(_,{children:e.jsx(js,{placeholder:s("safe.form.emailWhitelist.suffixes.placeholder"),...i,value:(i.value||[]).join(`
`),onChange:d=>{const p=d.target.value.split(`
`).filter(Boolean);i.onChange(p),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.emailWhitelist.suffixes.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"recaptcha_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.recaptcha.enable.label")}),e.jsx(z,{children:s("safe.form.recaptcha.enable.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),r.watch("recaptcha_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(b,{control:r.control,name:"recaptcha_site_key",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.recaptcha.siteKey.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.recaptcha.siteKey.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.recaptcha.siteKey.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"recaptcha_key",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.recaptcha.key.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.recaptcha.key.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.recaptcha.key.description")}),e.jsx(k,{})]})})]}),e.jsx(b,{control:r.control,name:"register_limit_by_ip_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.registerLimit.enable.label")}),e.jsx(z,{children:s("safe.form.registerLimit.enable.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),r.watch("register_limit_by_ip_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(b,{control:r.control,name:"register_limit_count",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.registerLimit.count.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.registerLimit.count.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.registerLimit.count.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"register_limit_expire",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.registerLimit.expire.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.registerLimit.expire.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.registerLimit.expire.description")}),e.jsx(k,{})]})})]}),e.jsx(b,{control:r.control,name:"password_limit_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("safe.form.passwordLimit.enable.label")}),e.jsx(z,{children:s("safe.form.passwordLimit.enable.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),r.watch("password_limit_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(b,{control:r.control,name:"password_limit_count",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.passwordLimit.count.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.passwordLimit.count.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.passwordLimit.count.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"password_limit_expire",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("safe.form.passwordLimit.expire.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("safe.form.passwordLimit.expire.placeholder"),...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(z,{children:s("safe.form.passwordLimit.expire.description")}),e.jsx(k,{})]})})]}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("safe.form.saving")})]})})}function Vu(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("safe.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("safe.description")})]}),e.jsx(Se,{}),e.jsx(Iu,{})]})}const Fu=Object.freeze(Object.defineProperty({__proto__:null,default:Vu},Symbol.toStringTag,{value:"Module"})),Ou=h.object({plan_change_enable:h.boolean().nullable().default(!1),reset_traffic_method:h.coerce.number().nullable().default(0),surplus_enable:h.boolean().nullable().default(!1),new_order_event_id:h.coerce.number().nullable().default(0),renew_order_event_id:h.coerce.number().nullable().default(0),change_order_event_id:h.coerce.number().nullable().default(0),show_info_to_server_enable:h.boolean().nullable().default(!1),show_protocol_to_server_enable:h.boolean().nullable().default(!1),default_remind_expire:h.boolean().nullable().default(!1),default_remind_traffic:h.boolean().nullable().default(!1),subscribe_path:h.string().nullable().default("s")}),Mu={plan_change_enable:!1,reset_traffic_method:0,surplus_enable:!1,new_order_event_id:0,renew_order_event_id:0,change_order_event_id:0,show_info_to_server_enable:!1,show_protocol_to_server_enable:!1,default_remind_expire:!1,default_remind_traffic:!1,subscribe_path:"s"};function zu(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye(Ou),defaultValues:Mu,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","subscribe"],queryFn:()=>hs("subscribe")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(c?.data?.subscribe){const i=c?.data?.subscribe;Object.entries(i).forEach(([d,p])=>{r.setValue(d,p)}),l.current=i}},[c]);const u=m.useCallback(Ce.debounce(async i=>{if(!Ce.isEqual(i,l.current)){a(!0);try{await o(i),l.current=i}finally{a(!1)}}},1e3),[o]),x=m.useCallback(i=>{u(i)},[u]);return m.useEffect(()=>{const i=r.watch(d=>{x(d)});return()=>i.unsubscribe()},[r.watch,x]),e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"plan_change_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.plan_change_enable.title")}),e.jsx(z,{children:s("subscribe.plan_change_enable.description")}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"reset_traffic_method",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.reset_traffic_method.title")}),e.jsxs(X,{onValueChange:i.onChange,value:i.value?.toString()||"0",children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:"请选择重置方式"})})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("subscribe.reset_traffic_method.options.monthly_first")}),e.jsx(U,{value:"1",children:s("subscribe.reset_traffic_method.options.monthly_reset")}),e.jsx(U,{value:"2",children:s("subscribe.reset_traffic_method.options.no_reset")}),e.jsx(U,{value:"3",children:s("subscribe.reset_traffic_method.options.yearly_first")}),e.jsx(U,{value:"4",children:s("subscribe.reset_traffic_method.options.yearly_reset")})]})]}),e.jsx(z,{children:s("subscribe.reset_traffic_method.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"surplus_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.surplus_enable.title")}),e.jsx(z,{children:s("subscribe.surplus_enable.description")}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"new_order_event_id",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.new_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(_,{children:e.jsxs(X,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"请选择"})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("subscribe.new_order_event.options.no_action")}),e.jsx(U,{value:"1",children:s("subscribe.new_order_event.options.reset_traffic")})]})]})})}),e.jsx(z,{children:s("subscribe.new_order_event.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"renew_order_event_id",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.renew_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(_,{children:e.jsxs(X,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"请选择"})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("subscribe.renew_order_event.options.no_action")}),e.jsx(U,{value:"1",children:s("subscribe.renew_order_event.options.reset_traffic")})]})]})})}),e.jsx(z,{children:s("renew_order_event.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"change_order_event_id",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.change_order_event.title")}),e.jsx("div",{className:"relative w-max",children:e.jsx(_,{children:e.jsxs(X,{onValueChange:i.onChange,value:i.value?.toString(),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"请选择"})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("subscribe.change_order_event.options.no_action")}),e.jsx(U,{value:"1",children:s("subscribe.change_order_event.options.reset_traffic")})]})]})})}),e.jsx(z,{children:s("subscribe.change_order_event.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"subscribe_path",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("subscribe.subscribe_path.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:"subscribe",...i,value:i.value||"",onChange:d=>{i.onChange(d),x(r.getValues())}})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s("subscribe.subscribe_path.description"),e.jsx("br",{}),s("subscribe.subscribe_path.current_format",{path:i.value||"s"})]}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"show_info_to_server_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("subscribe.show_info_to_server.title")}),e.jsx(z,{children:s("subscribe.show_info_to_server.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"show_protocol_to_server_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("subscribe.show_protocol_to_server.title")}),e.jsx(z,{children:s("subscribe.show_protocol_to_server.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value||!1,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function Lu(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("subscribe.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("subscribe.description")})]}),e.jsx(Se,{}),e.jsx(zu,{})]})}const Au=Object.freeze(Object.defineProperty({__proto__:null,default:Lu},Symbol.toStringTag,{value:"Module"})),$u=h.object({invite_force:h.boolean().default(!1),invite_commission:h.coerce.string().default("0"),invite_gen_limit:h.coerce.string().default("0"),invite_never_expire:h.boolean().default(!1),commission_first_time_enable:h.boolean().default(!1),commission_auto_check_enable:h.boolean().default(!1),commission_withdraw_limit:h.coerce.string().default("0"),commission_withdraw_method:h.array(h.string()).default(["支付宝","USDT","Paypal"]),withdraw_close_enable:h.boolean().default(!1),commission_distribution_enable:h.boolean().default(!1),commission_distribution_l1:h.coerce.number().default(0),commission_distribution_l2:h.coerce.number().default(0),commission_distribution_l3:h.coerce.number().default(0)}),qu={invite_force:!1,invite_commission:"0",invite_gen_limit:"0",invite_never_expire:!1,commission_first_time_enable:!1,commission_auto_check_enable:!1,commission_withdraw_limit:"0",commission_withdraw_method:["支付宝","USDT","Paypal"],withdraw_close_enable:!1,commission_distribution_enable:!1,commission_distribution_l1:0,commission_distribution_l2:0,commission_distribution_l3:0};function Uu(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye($u),defaultValues:qu,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","invite"],queryFn:()=>hs("invite")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:i=>{i.data&&$.success(s("common.autoSaved"))}});m.useEffect(()=>{if(c?.data?.invite){const i=c?.data?.invite;Object.entries(i).forEach(([d,p])=>{typeof p=="number"?r.setValue(d,String(p)):r.setValue(d,p)}),l.current=i}},[c]);const u=m.useCallback(Ce.debounce(async i=>{if(!Ce.isEqual(i,l.current)){a(!0);try{await o(i),l.current=i}finally{a(!1)}}},1e3),[o]),x=m.useCallback(i=>{u(i)},[u]);return m.useEffect(()=>{const i=r.watch(d=>{x(d)});return()=>i.unsubscribe()},[r.watch,x]),e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"invite_force",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.invite_force.title")}),e.jsx(z,{children:s("invite.invite_force.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"invite_commission",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("invite.invite_commission.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("invite.invite_commission.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("invite.invite_commission.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"invite_gen_limit",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("invite.invite_gen_limit.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("invite.invite_gen_limit.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("invite.invite_gen_limit.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"invite_never_expire",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.invite_never_expire.title")}),e.jsx(z,{children:s("invite.invite_never_expire.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"commission_first_time_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.commission_first_time.title")}),e.jsx(z,{children:s("invite.commission_first_time.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"commission_auto_check_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.commission_auto_check.title")}),e.jsx(z,{children:s("invite.commission_auto_check.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"commission_withdraw_limit",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("invite.commission_withdraw_limit.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("invite.commission_withdraw_limit.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("invite.commission_withdraw_limit.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"commission_withdraw_method",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("invite.commission_withdraw_method.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("invite.commission_withdraw_method.placeholder"),...i,value:Array.isArray(i.value)?i.value.join(","):"",onChange:d=>{const p=d.target.value.split(",").filter(Boolean);i.onChange(p),x(r.getValues())}})}),e.jsx(z,{children:s("invite.commission_withdraw_method.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"withdraw_close_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.withdraw_close.title")}),e.jsx(z,{children:s("invite.withdraw_close.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),e.jsx(b,{control:r.control,name:"commission_distribution_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("invite.commission_distribution.title")}),e.jsx(z,{children:s("invite.commission_distribution.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:d=>{i.onChange(d),x(r.getValues())}})})]})}),r.watch("commission_distribution_enable")&&e.jsxs(e.Fragment,{children:[e.jsx(b,{control:r.control,name:"commission_distribution_l1",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:s("invite.commission_distribution.l1")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const p=d.target.value?Number(d.target.value):0;i.onChange(p),x(r.getValues())}})}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"commission_distribution_l2",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:s("invite.commission_distribution.l2")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const p=d.target.value?Number(d.target.value):0;i.onChange(p),x(r.getValues())}})}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"commission_distribution_l3",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:s("invite.commission_distribution.l3")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("invite.commission_distribution.placeholder"),...i,value:i.value||"",onChange:d=>{const p=d.target.value?Number(d.target.value):0;i.onChange(p),x(r.getValues())}})}),e.jsx(k,{})]})})]}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("invite.saving")})]})})}function Hu(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("invite.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("invite.description")})]}),e.jsx(Se,{}),e.jsx(Uu,{})]})}const Ku=Object.freeze(Object.defineProperty({__proto__:null,default:Hu},Symbol.toStringTag,{value:"Module"})),Bu=h.object({frontend_theme:h.string().nullable(),frontend_theme_sidebar:h.string().nullable(),frontend_theme_header:h.string().nullable(),frontend_theme_color:h.string().nullable(),frontend_background_url:h.string().url().nullable()}),Gu={frontend_theme:"",frontend_theme_sidebar:"",frontend_theme_header:"",frontend_theme_color:"",frontend_background_url:""};function Wu(){const{data:s}=ie({queryKey:["settings","frontend"],queryFn:()=>hs("frontend")}),n=fe({resolver:ye(Bu),defaultValues:Gu,mode:"onChange"});m.useEffect(()=>{if(s?.data?.frontend){const l=s?.data?.frontend;Object.entries(l).forEach(([r,c])=>{n.setValue(r,c)})}},[s]);function a(l){ps(l).then(({data:r})=>{r&&$.success("更新成功")})}return e.jsx(Ne,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(a),className:"space-y-8",children:[e.jsx(b,{control:n.control,name:"frontend_theme_sidebar",render:({field:l})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:"边栏风格"}),e.jsx(z,{children:"边栏风格"})]}),e.jsx(_,{children:e.jsx(W,{checked:l.value,onCheckedChange:l.onChange})})]})}),e.jsx(b,{control:n.control,name:"frontend_theme_header",render:({field:l})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:"头部风格"}),e.jsx(z,{children:"边栏风格"})]}),e.jsx(_,{children:e.jsx(W,{checked:l.value,onCheckedChange:l.onChange})})]})}),e.jsx(b,{control:n.control,name:"frontend_theme_color",render:({field:l})=>e.jsxs(v,{children:[e.jsx(y,{children:"主题色"}),e.jsxs("div",{className:"relative w-max",children:[e.jsx(_,{children:e.jsxs("select",{className:N(st({variant:"outline"}),"w-[200px] appearance-none font-normal"),...l,children:[e.jsx("option",{value:"default",children:"默认"}),e.jsx("option",{value:"black",children:"黑色"}),e.jsx("option",{value:"blackblue",children:"暗蓝色"}),e.jsx("option",{value:"green",children:"奶绿色"})]})}),e.jsx(Da,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50"})]}),e.jsx(z,{children:"主题色"}),e.jsx(k,{})]})}),e.jsx(b,{control:n.control,name:"frontend_background_url",render:({field:l})=>e.jsxs(v,{children:[e.jsx(y,{children:"背景"}),e.jsx(_,{children:e.jsx(D,{placeholder:"请输入图片地址",...l})}),e.jsx(z,{children:"将会在后台登录页面进行展示。"}),e.jsx(k,{})]})}),e.jsx(T,{type:"submit",children:"保存设置"})]})})}function Yu(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"个性化设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"自定义系统界面外观，包括主题风格、布局、颜色方案、背景图等个性化选项。"})]}),e.jsx(Se,{}),e.jsx(Wu,{})]})}const Qu=Object.freeze(Object.defineProperty({__proto__:null,default:Yu},Symbol.toStringTag,{value:"Module"})),Ju=h.object({server_pull_interval:h.coerce.number().nullable(),server_push_interval:h.coerce.number().nullable(),server_token:h.string().nullable(),device_limit_mode:h.coerce.number().nullable()}),Zu={server_pull_interval:0,server_push_interval:0,server_token:"",device_limit_mode:0};function Xu(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye(Ju),defaultValues:Zu,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","server"],queryFn:()=>hs("server")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:d=>{d.data&&$.success(s("common.AutoSaved"))}});m.useEffect(()=>{if(c?.data.server){const d=c.data.server;Object.entries(d).forEach(([p,w])=>{r.setValue(p,w)}),l.current=d}},[c]);const u=m.useCallback(Ce.debounce(async d=>{if(!Ce.isEqual(d,l.current)){a(!0);try{await o(d),l.current=d}finally{a(!1)}}},1e3),[o]),x=m.useCallback(d=>{u(d)},[u]);m.useEffect(()=>{const d=r.watch(p=>{x(p)});return()=>d.unsubscribe()},[r.watch,x]);const i=()=>{const d=Math.floor(Math.random()*17)+16,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let w="";for(let P=0;P<d;P++)w+=p.charAt(Math.floor(Math.random()*p.length));r.setValue("server_token",w)};return e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"server_token",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("server.server_token.title")}),e.jsx(_,{children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{placeholder:s("server.server_token.placeholder"),...d,value:d.value||"",className:"pr-10"}),e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(G,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2",onClick:p=>{p.preventDefault(),i()},children:e.jsx(bo,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})}),e.jsx(ce,{children:e.jsx("p",{children:s("server.server_token.generate_tooltip")})})]})})]})}),e.jsx(z,{children:s("server.server_token.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"server_pull_interval",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("server.server_pull_interval.title")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("server.server_pull_interval.placeholder"),...d,value:d.value||"",onChange:p=>{const w=p.target.value?Number(p.target.value):null;d.onChange(w)}})}),e.jsx(z,{children:s("server.server_pull_interval.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"server_push_interval",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("server.server_push_interval.title")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("server.server_push_interval.placeholder"),...d,value:d.value||"",onChange:p=>{const w=p.target.value?Number(p.target.value):null;d.onChange(w)}})}),e.jsx(z,{children:s("server.server_push_interval.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"device_limit_mode",render:({field:d})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("server.device_limit_mode.title")}),e.jsxs(X,{onValueChange:d.onChange,value:d.value?.toString()||"0",children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:s("server.device_limit_mode.placeholder")})})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("server.device_limit_mode.strict")}),e.jsx(U,{value:"1",children:s("server.device_limit_mode.relaxed")})]})]}),e.jsx(z,{children:s("server.device_limit_mode.description")}),e.jsx(k,{})]})}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("server.saving")})]})})}function em(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("server.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("server.description")})]}),e.jsx(Se,{}),e.jsx(Xu,{})]})}const sm=Object.freeze(Object.defineProperty({__proto__:null,default:em},Symbol.toStringTag,{value:"Module"}));function tm({open:s,onOpenChange:n,result:a}){const l=!a.error;return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(tr,{className:"h-5 w-5 text-green-500"}):e.jsx(ar,{className:"h-5 w-5 text-destructive"}),e.jsx(be,{children:l?"邮件发送成功":"邮件发送失败"})]}),e.jsx(ke,{children:l?"测试邮件已成功发送，请检查收件箱":"发送测试邮件时遇到错误"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium",children:"发送详情"}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"收件地址"}),e.jsx("div",{children:a.email}),e.jsx("div",{className:"text-muted-foreground",children:"邮件主题"}),e.jsx("div",{children:a.subject}),e.jsx("div",{className:"text-muted-foreground",children:"模板名称"}),e.jsx("div",{children:a.template_name})]})]}),a.error&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium text-destructive",children:"错误信息"}),e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive break-all",children:a.error})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium",children:"配置信息"}),e.jsx(zs,{className:"h-[200px] rounded-md border p-4",children:e.jsx("div",{className:"grid gap-2 text-sm",children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"驱动"}),e.jsx("div",{children:a.config.driver}),e.jsx("div",{className:"text-muted-foreground",children:"服务器"}),e.jsx("div",{children:a.config.host}),e.jsx("div",{className:"text-muted-foreground",children:"端口"}),e.jsx("div",{children:a.config.port}),e.jsx("div",{className:"text-muted-foreground",children:"加密方式"}),e.jsx("div",{children:a.config.encryption||"无"}),e.jsx("div",{className:"text-muted-foreground",children:"发件人"}),e.jsx("div",{children:a.config.from.address?`${a.config.from.address}${a.config.from.name?` (${a.config.from.name})`:""}`:"未设置"}),e.jsx("div",{className:"text-muted-foreground",children:"用户名"}),e.jsx("div",{children:a.config.username||"未设置"})]})})})]})]})]})})}const am=h.object({email_template:h.string().nullable().default("classic"),email_host:h.string().nullable().default(""),email_port:h.coerce.number().nullable().default(465),email_username:h.string().nullable().default(""),email_password:h.string().nullable().default(""),email_encryption:h.string().nullable().default(""),email_from_address:h.string().email().nullable().default(""),remind_mail_enable:h.boolean().nullable().default(!1)});function nm(){const{t:s}=F("settings"),[n,a]=m.useState(null),[l,r]=m.useState(!1),c=m.useRef(null),[o,u]=m.useState(!1),x=fe({resolver:ye(am),defaultValues:{},mode:"onBlur"}),{data:i}=ie({queryKey:["settings","email"],queryFn:()=>hs("email")}),{data:d}=ie({queryKey:["emailTemplate"],queryFn:()=>jd()}),{mutateAsync:p}=Je({mutationFn:ps,onSuccess:C=>{C.data&&$.success(s("common.autoSaved"))}}),{mutate:w,isPending:P}=Je({mutationFn:vd,onMutate:()=>{a(null),r(!1)},onSuccess:C=>{a(C.data),r(!0),C.data.error?$.error(s("email.test.error")):$.success(s("email.test.success"))}});m.useEffect(()=>{if(i?.data.email){const C=i.data.email;Object.entries(C).forEach(([g,S])=>{x.setValue(g,S)}),c.current=C}},[i]);const f=m.useCallback(Ce.debounce(async C=>{if(!Ce.isEqual(C,c.current)){u(!0);try{await p(C),c.current=C}finally{u(!1)}}},1e3),[p]),j=m.useCallback(C=>{f(C)},[f]);return m.useEffect(()=>{const C=x.watch(g=>{j(g)});return()=>C.unsubscribe()},[x.watch,j]),e.jsxs(e.Fragment,{children:[e.jsx(Ne,{...x,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:x.control,name:"email_host",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_host.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...C,value:C.value||""})}),e.jsx(z,{children:s("email.email_host.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_port",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_port.title")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:s("common.placeholder"),...C,value:C.value||"",onChange:g=>{const S=g.target.value?Number(g.target.value):null;C.onChange(S)}})}),e.jsx(z,{children:s("email.email_port.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_encryption",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_encryption.title")}),e.jsxs(X,{onValueChange:C.onChange,value:C.value||"none",children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:"请选择加密方式"})})}),e.jsxs(J,{children:[e.jsx(U,{value:"none",children:s("email.email_encryption.none")}),e.jsx(U,{value:"ssl",children:s("email.email_encryption.ssl")}),e.jsx(U,{value:"tls",children:s("email.email_encryption.tls")})]})]}),e.jsx(z,{children:s("email.email_encryption.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_username",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_username.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...C,value:C.value||""})}),e.jsx(z,{children:s("email.email_username.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_password",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_password.title")}),e.jsx(_,{children:e.jsx(D,{type:"password",placeholder:s("common.placeholder"),...C,value:C.value||""})}),e.jsx(z,{children:s("email.email_password.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_from_address",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_from.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...C,value:C.value||""})}),e.jsx(z,{children:s("email.email_from.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"email_template",render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("email.email_template.title")}),e.jsxs(X,{onValueChange:g=>{C.onChange(g),j(x.getValues())},value:C.value||void 0,children:[e.jsx(_,{children:e.jsx(Q,{className:"w-[200px]",children:e.jsx(ee,{placeholder:s("email.email_template.placeholder")})})}),e.jsx(J,{children:d?.data?.map(g=>e.jsx(U,{value:g,children:g},g))})]}),e.jsx(z,{children:s("email.email_template.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"remind_mail_enable",render:({field:C})=>e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:s("email.remind_mail.title")}),e.jsx(z,{children:s("email.remind_mail.description")})]}),e.jsx(_,{children:e.jsx(W,{checked:C.value||!1,onCheckedChange:g=>{C.onChange(g),j(x.getValues())}})})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(T,{onClick:()=>w(),loading:P,disabled:P,children:s(P?"test.sending":"test.title")})})]})}),o&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("saving")}),n&&e.jsx(tm,{open:l,onOpenChange:r,result:n})]})}function rm(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("email.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("email.description")})]}),e.jsx(Se,{}),e.jsx(nm,{})]})}const lm=Object.freeze(Object.defineProperty({__proto__:null,default:rm},Symbol.toStringTag,{value:"Module"})),im=h.object({telegram_bot_enable:h.boolean().nullable(),telegram_bot_token:h.string().nullable(),telegram_discuss_link:h.string().nullable()}),om={telegram_bot_enable:!1,telegram_bot_token:"",telegram_discuss_link:""};function cm(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye(im),defaultValues:om,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","telegram"],queryFn:()=>hs("telegram")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:p=>{p.data&&$.success(s("common.autoSaved"))}}),{mutate:u,isPending:x}=Je({mutationFn:bd,onSuccess:p=>{p.data&&$.success(s("telegram.webhook.success"))}});m.useEffect(()=>{if(c?.data.telegram){const p=c.data.telegram;Object.entries(p).forEach(([w,P])=>{r.setValue(w,P)}),l.current=p}},[c]);const i=m.useCallback(Ce.debounce(async p=>{if(!Ce.isEqual(p,l.current)){a(!0);try{await o(p),l.current=p}finally{a(!1)}}},1e3),[o]),d=m.useCallback(p=>{i(p)},[i]);return m.useEffect(()=>{const p=r.watch(w=>{d(w)});return()=>p.unsubscribe()},[r.watch,d]),e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"telegram_bot_token",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("telegram.bot_token.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("telegram.bot_token.placeholder"),...p,value:p.value||""})}),e.jsx(z,{children:s("telegram.bot_token.description")}),e.jsx(k,{})]})}),r.watch("telegram_bot_token")&&e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("telegram.webhook.title")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{loading:x,disabled:x,onClick:()=>u(),children:s(x?"telegram.webhook.setting":"telegram.webhook.button")}),n&&e.jsx("span",{className:"text-sm text-muted-foreground",children:s("common.saving")})]}),e.jsx(z,{children:s("telegram.webhook.description")}),e.jsx(k,{})]}),e.jsx(b,{control:r.control,name:"telegram_bot_enable",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("telegram.bot_enable.title")}),e.jsx(z,{children:s("telegram.bot_enable.description")}),e.jsx(_,{children:e.jsx(W,{checked:p.value||!1,onCheckedChange:w=>{p.onChange(w),d(r.getValues())}})}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"telegram_discuss_link",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("telegram.discuss_link.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("telegram.discuss_link.placeholder"),...p,value:p.value||""})}),e.jsx(z,{children:s("telegram.discuss_link.description")}),e.jsx(k,{})]})}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function dm(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("telegram.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("telegram.description")})]}),e.jsx(Se,{}),e.jsx(cm,{})]})}const um=Object.freeze(Object.defineProperty({__proto__:null,default:dm},Symbol.toStringTag,{value:"Module"})),mm=h.object({windows_version:h.string().nullable(),windows_download_url:h.string().nullable(),macos_version:h.string().nullable(),macos_download_url:h.string().nullable(),android_version:h.string().nullable(),android_download_url:h.string().nullable()}),xm={windows_version:"",windows_download_url:"",macos_version:"",macos_download_url:"",android_version:"",android_download_url:""};function hm(){const{t:s}=F("settings"),[n,a]=m.useState(!1),l=m.useRef(null),r=fe({resolver:ye(mm),defaultValues:xm,mode:"onBlur"}),{data:c}=ie({queryKey:["settings","app"],queryFn:()=>hs("app")}),{mutateAsync:o}=Je({mutationFn:ps,onSuccess:i=>{i.data&&$.success(s("app.save_success"))}});m.useEffect(()=>{if(c?.data.app){const i=c.data.app;Object.entries(i).forEach(([d,p])=>{r.setValue(d,p)}),l.current=i}},[c]);const u=m.useCallback(Ce.debounce(async i=>{if(!Ce.isEqual(i,l.current)){a(!0);try{await o(i),l.current=i}finally{a(!1)}}},1e3),[o]),x=m.useCallback(i=>{u(i)},[u]);return m.useEffect(()=>{const i=r.watch(d=>{x(d)});return()=>i.unsubscribe()},[r.watch,x]),e.jsx(Ne,{...r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:r.control,name:"windows_version",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.windows.version.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.windows.version.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"windows_download_url",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.windows.download.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.windows.download.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"macos_version",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.macos.version.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.macos.version.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"macos_download_url",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.macos.download.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.macos.download.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"android_version",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.android.version.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.android.version.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"android_download_url",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-base",children:s("app.android.download.title")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("common.placeholder"),...i,value:i.value||""})}),e.jsx(z,{children:s("app.android.download.description")}),e.jsx(k,{})]})}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("common.saving")})]})})}function pm(){const{t:s}=F("settings");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s("app.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("app.description")})]}),e.jsx(Se,{}),e.jsx(hm,{})]})}const fm=Object.freeze(Object.defineProperty({__proto__:null,default:pm},Symbol.toStringTag,{value:"Module"})),Va=m.forwardRef(({className:s,...n},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:N("w-full caption-bottom text-sm",s),...n})}));Va.displayName="Table";const Fa=m.forwardRef(({className:s,...n},a)=>e.jsx("thead",{ref:a,className:N("[&_tr]:border-b",s),...n}));Fa.displayName="TableHeader";const Oa=m.forwardRef(({className:s,...n},a)=>e.jsx("tbody",{ref:a,className:N("[&_tr:last-child]:border-0",s),...n}));Oa.displayName="TableBody";const gm=m.forwardRef(({className:s,...n},a)=>e.jsx("tfoot",{ref:a,className:N("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n}));gm.displayName="TableFooter";const Rs=m.forwardRef(({className:s,...n},a)=>e.jsx("tr",{ref:a,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n}));Rs.displayName="TableRow";const Ma=m.forwardRef(({className:s,...n},a)=>e.jsx("th",{ref:a,className:N("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...n}));Ma.displayName="TableHead";const Js=m.forwardRef(({className:s,...n},a)=>e.jsx("td",{ref:a,className:N("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...n}));Js.displayName="TableCell";const jm=m.forwardRef(({className:s,...n},a)=>e.jsx("caption",{ref:a,className:N("mt-4 text-sm text-muted-foreground",s),...n}));jm.displayName="TableCaption";function vm({table:s}){const[n,a]=m.useState(""),{t:l}=F("common");m.useEffect(()=>{a((s.getState().pagination.pageIndex+1).toString())},[s.getState().pagination.pageIndex]);const r=c=>{const o=parseInt(c);!isNaN(o)&&o>=1&&o<=s.getPageCount()?s.setPageIndex(o-1):a((s.getState().pagination.pageIndex+1).toString())};return e.jsxs("div",{className:"flex flex-col-reverse gap-4 px-2 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex-1 text-sm text-muted-foreground",children:l("table.pagination.selected",{selected:s.getFilteredSelectedRowModel().rows.length,total:s.getFilteredRowModel().rows.length})}),e.jsxs("div",{className:"flex flex-col-reverse items-center gap-4 sm:flex-row sm:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:l("table.pagination.itemsPerPage")}),e.jsxs(X,{value:`${s.getState().pagination.pageSize}`,onValueChange:c=>{s.setPageSize(Number(c))},children:[e.jsx(Q,{className:"h-8 w-[70px]",children:e.jsx(ee,{placeholder:s.getState().pagination.pageSize})}),e.jsx(J,{side:"top",children:[10,20,30,40,50,100,500].map(c=>e.jsx(U,{value:`${c}`,children:c},c))})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm font-medium",children:[e.jsx("span",{children:l("table.pagination.page")}),e.jsx(D,{type:"text",value:n,onChange:c=>a(c.target.value),onBlur:c=>r(c.target.value),onKeyDown:c=>{c.key==="Enter"&&r(c.currentTarget.value)},className:"h-8 w-[50px] text-center"}),e.jsx("span",{children:l("table.pagination.pageOf",{total:s.getPageCount()})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(T,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.firstPage")}),e.jsx(yo,{className:"h-4 w-4"})]}),e.jsxs(T,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.previousPage")}),e.jsx(Xn,{className:"h-4 w-4"})]}),e.jsxs(T,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.nextPage")}),e.jsx(ka,{className:"h-4 w-4"})]}),e.jsxs(T,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:l("table.pagination.lastPage")}),e.jsx(No,{className:"h-4 w-4"})]})]})]})]})}function us({table:s,toolbar:n,draggable:a=!1,onDragStart:l,onDragEnd:r,onDragOver:c,onDragLeave:o,onDrop:u,showPagination:x=!0,isLoading:i=!1}){const{t:d}=F("common"),p=m.useRef(null),w=s.getAllColumns().filter(C=>C.getIsPinned()==="left"),P=s.getAllColumns().filter(C=>C.getIsPinned()==="right"),f=C=>w.slice(0,C).reduce((g,S)=>g+(S.getSize()??0),0),j=C=>P.slice(C+1).reduce((g,S)=>g+(S.getSize()??0),0);return e.jsxs("div",{className:"space-y-4",children:[typeof n=="function"?n(s):n,e.jsx("div",{ref:p,className:"relative overflow-auto rounded-md border bg-card",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs(Va,{children:[e.jsx(Fa,{children:s.getHeaderGroups().map(C=>e.jsx(Rs,{className:"hover:bg-transparent",children:C.headers.map((g,S)=>{const R=g.column.getIsPinned()==="left",E=g.column.getIsPinned()==="right",O=R?f(w.indexOf(g.column)):void 0,q=E?j(P.indexOf(g.column)):void 0;return e.jsx(Ma,{colSpan:g.colSpan,style:{width:g.getSize(),...R&&{left:O},...E&&{right:q}},className:N("h-11 bg-card px-4 text-muted-foreground",(R||E)&&["sticky z-20","before:absolute before:bottom-0 before:top-0 before:w-[1px] before:bg-border",R&&"before:right-0",E&&"before:left-0"]),children:g.isPlaceholder?null:Vt(g.column.columnDef.header,g.getContext())},g.id)})},C.id))}),e.jsx(Oa,{children:s.getRowModel().rows?.length?s.getRowModel().rows.map((C,g)=>e.jsx(Rs,{"data-state":C.getIsSelected()&&"selected",className:"hover:bg-muted/50",draggable:a,onDragStart:S=>l?.(S,g),onDragEnd:r,onDragOver:c,onDragLeave:o,onDrop:S=>u?.(S,g),children:C.getVisibleCells().map((S,R)=>{const E=S.column.getIsPinned()==="left",O=S.column.getIsPinned()==="right",q=E?f(w.indexOf(S.column)):void 0,te=O?j(P.indexOf(S.column)):void 0;return e.jsx(Js,{style:{width:S.column.getSize(),...E&&{left:q},...O&&{right:te}},className:N("bg-card",(E||O)&&["sticky z-20","before:absolute before:bottom-0 before:top-0 before:w-[1px] before:bg-border",E&&"before:right-0",O&&"before:left-0"]),children:Vt(S.column.columnDef.cell,S.getContext())},S.id)})},C.id)):e.jsx(Rs,{children:e.jsx(Js,{colSpan:s.getAllColumns().length,className:"h-24 text-center",children:d("table.noData")})})})]})})}),x&&e.jsx(vm,{table:s})]})}const bm=s=>h.object({id:h.number().nullable(),name:h.string().min(2,s("form.validation.name.min")).max(30,s("form.validation.name.max")),icon:h.string().optional().nullable(),notify_domain:h.string().refine(a=>!a||/^https?:\/\/\S+/.test(a),s("form.validation.notify_domain.url")).optional().nullable(),handling_fee_fixed:h.coerce.number().min(0).optional().nullable(),handling_fee_percent:h.coerce.number().min(0).max(100).optional().nullable(),payment:h.string().min(1,s("form.validation.payment.required")),config:h.record(h.string(),h.string())}),on={id:null,name:"",icon:"",notify_domain:"",handling_fee_fixed:0,handling_fee_percent:0,payment:"",config:{}};function Hr({refetch:s,dialogTrigger:n,type:a="add",defaultFormValues:l=on}){const{t:r}=F("payment"),[c,o]=m.useState(!1),[u,x]=m.useState(!1),[i,d]=m.useState([]),[p,w]=m.useState([]),P=bm(r),f=fe({resolver:ye(P),defaultValues:l,mode:"onChange"}),j=f.watch("payment");m.useEffect(()=>{c&&(async()=>{const{data:S}=await Mc();d(S)})()},[c]),m.useEffect(()=>{if(!j||!c)return;(async()=>{const S={payment:j,...a==="edit"&&{id:Number(f.getValues("id"))}};zc(S).then(({data:R})=>{w(R);const E=R.reduce((O,q)=>(q.field_name&&(O[q.field_name]=q.value??""),O),{});f.setValue("config",E)})})()},[j,c,f,a]);const C=async g=>{x(!0);try{(await Lc(g)).data&&($.success(r("form.messages.success")),f.reset(on),s(),o(!1))}finally{x(!1)}};return e.jsxs(ve,{open:c,onOpenChange:o,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"})," ",e.jsx("div",{children:r("form.add.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(we,{children:e.jsx(be,{children:r(a==="add"?"form.add.title":"form.edit.title")})}),e.jsx(Ne,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(C),className:"space-y-4",children:[e.jsx(b,{control:f.control,name:"name",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:r("form.fields.name.placeholder"),...g})}),e.jsx(z,{children:r("form.fields.name.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"icon",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.icon.label")}),e.jsx(_,{children:e.jsx(D,{...g,value:g.value||"",placeholder:r("form.fields.icon.placeholder")})}),e.jsx(z,{children:r("form.fields.icon.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"notify_domain",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.notify_domain.label")}),e.jsx(_,{children:e.jsx(D,{...g,value:g.value||"",placeholder:r("form.fields.notify_domain.placeholder")})}),e.jsx(z,{children:r("form.fields.notify_domain.description")}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{control:f.control,name:"handling_fee_percent",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.handling_fee_percent.label")}),e.jsx(_,{children:e.jsx(D,{type:"number",...g,value:g.value||"",placeholder:r("form.fields.handling_fee_percent.placeholder")})}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"handling_fee_fixed",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.handling_fee_fixed.label")}),e.jsx(_,{children:e.jsx(D,{type:"number",...g,value:g.value||"",placeholder:r("form.fields.handling_fee_fixed.placeholder")})}),e.jsx(k,{})]})})]}),e.jsx(b,{control:f.control,name:"payment",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.payment.label")}),e.jsxs(X,{onValueChange:g.onChange,defaultValue:g.value,children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:r("form.fields.payment.placeholder")})})}),e.jsx(J,{children:i.map(S=>e.jsx(U,{value:S,children:S},S))})]}),e.jsx(z,{children:r("form.fields.payment.description")}),e.jsx(k,{})]})}),p.length>0&&e.jsx("div",{className:"space-y-4",children:p.map(g=>e.jsx(b,{control:f.control,name:`config.${g.field_name}`,render:({field:S})=>e.jsxs(v,{children:[e.jsx(y,{children:g.label}),e.jsx(_,{children:e.jsx(D,{...S,value:S.value||""})}),e.jsx(k,{})]})},g.field_name))}),e.jsxs(Me,{children:[e.jsx(Nt,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:r("form.buttons.cancel")})}),e.jsx(T,{type:"submit",disabled:u,children:r("form.buttons.submit")})]})]})})]})]})}function L({column:s,title:n,tooltip:a,className:l}){return s.getCanSort()?e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(T,{variant:"ghost",size:"default",className:N("-ml-3 flex h-8 items-center gap-2 text-nowrap font-medium hover:bg-muted/60",l),onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:[e.jsx("span",{children:n}),a&&e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(Qa,{className:"h-4 w-4 cursor-pointer text-muted-foreground"})}),e.jsx(ce,{children:a})]})}),s.getIsSorted()==="asc"?e.jsx(fa,{className:"h-4 w-4 text-foreground/70"}):s.getIsSorted()==="desc"?e.jsx(ga,{className:"h-4 w-4 text-foreground/70"}):e.jsx(_o,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-foreground/70"})]})})}):e.jsxs("div",{className:N("flex items-center space-x-1 text-nowrap py-2 font-medium text-muted-foreground",l),children:[e.jsx("span",{children:n}),a&&e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx(Qa,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(ce,{children:a})]})})]})}const za=wo,Kr=Co,ym=So,Br=m.forwardRef(({className:s,...n},a)=>e.jsx(rr,{className:N("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a}));Br.displayName=rr.displayName;const Qt=m.forwardRef(({className:s,...n},a)=>e.jsxs(ym,{children:[e.jsx(Br,{}),e.jsx(lr,{ref:a,className:N("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n})]}));Qt.displayName=lr.displayName;const Jt=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col space-y-2 text-center sm:text-left",s),...n});Jt.displayName="AlertDialogHeader";const Zt=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...n});Zt.displayName="AlertDialogFooter";const Xt=m.forwardRef(({className:s,...n},a)=>e.jsx(ir,{ref:a,className:N("text-lg font-semibold",s),...n}));Xt.displayName=ir.displayName;const ea=m.forwardRef(({className:s,...n},a)=>e.jsx(or,{ref:a,className:N("text-sm text-muted-foreground",s),...n}));ea.displayName=or.displayName;const sa=m.forwardRef(({className:s,...n},a)=>e.jsx(cr,{ref:a,className:N(Xs(),s),...n}));sa.displayName=cr.displayName;const ta=m.forwardRef(({className:s,...n},a)=>e.jsx(dr,{ref:a,className:N(Xs({variant:"outline"}),"mt-2 sm:mt-0",s),...n}));ta.displayName=dr.displayName;function Ge({onConfirm:s,children:n,title:a="确认操作",description:l="确定要执行此操作吗？",cancelText:r="取消",confirmText:c="确认",variant:o="default",className:u}){return e.jsxs(za,{children:[e.jsx(Kr,{asChild:!0,children:n}),e.jsxs(Qt,{className:N("sm:max-w-[425px]",u),children:[e.jsxs(Jt,{children:[e.jsx(Xt,{children:a}),e.jsx(ea,{children:l})]}),e.jsxs(Zt,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(T,{variant:"outline",children:r})}),e.jsx(sa,{asChild:!0,children:e.jsx(T,{variant:o,onClick:s,children:c})})]})]})]})}const Gr=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M11.29 15.29a2 2 0 0 0-.12.15a.8.8 0 0 0-.09.18a.6.6 0 0 0-.06.18a1.4 1.4 0 0 0 0 .2a.84.84 0 0 0 .08.38a.9.9 0 0 0 .54.54a.94.94 0 0 0 .76 0a.9.9 0 0 0 .54-.54A1 1 0 0 0 13 16a1 1 0 0 0-.29-.71a1 1 0 0 0-1.42 0M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8 8 0 0 1-8 8m0-13a3 3 0 0 0-2.6 1.5a1 1 0 1 0 1.73 1A1 1 0 0 1 12 9a1 1 0 0 1 0 2a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-.18A3 3 0 0 0 12 7"})}),Nm=({refetch:s,isSortMode:n=!1})=>{const{t:a}=F("payment");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:n?"cursor-move":"opacity-0",children:e.jsx(Kt,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:l})=>e.jsx(L,{column:l,title:a("table.columns.id")}),cell:({row:l})=>e.jsx(K,{variant:"outline",children:l.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"enable",header:({column:l})=>e.jsx(L,{column:l,title:a("table.columns.enable")}),cell:({row:l})=>e.jsx(W,{defaultChecked:l.getValue("enable"),onCheckedChange:async()=>{const{data:r}=await $c({id:l.original.id});r||s()}}),enableSorting:!1,size:100},{accessorKey:"name",header:({column:l})=>e.jsx(L,{column:l,title:a("table.columns.name")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:l.getValue("name")})}),enableSorting:!1,size:200},{accessorKey:"payment",header:({column:l})=>e.jsx(L,{column:l,title:a("table.columns.payment")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[200px] truncate font-medium",children:l.getValue("payment")})}),enableSorting:!1,size:200},{accessorKey:"notify_url",header:({column:l})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{column:l,title:a("table.columns.notify_url")}),e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{className:"ml-1",children:e.jsx(Gr,{className:"h-4 w-4"})}),e.jsx(ce,{children:a("table.columns.notify_url_tooltip")})]})})]}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"max-w-[300px] truncate font-medium",children:l.getValue("notify_url")})}),enableSorting:!1,size:3e3},{id:"actions",header:({column:l})=>e.jsx(L,{className:"justify-end",column:l,title:a("table.columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(Hr,{refetch:s,dialogTrigger:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("table.actions.edit")})]}),type:"edit",defaultFormValues:l.original}),e.jsx(Ge,{title:a("table.actions.delete.title"),description:a("table.actions.delete.description"),onConfirm:async()=>{const{data:r}=await Ac({id:l.original.id});r&&s()},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"}),e.jsx("span",{className:"sr-only",children:a("table.actions.delete.title")})]})})]}),size:100}]};function _m({table:s,refetch:n,saveOrder:a,isSortMode:l}){const{t:r}=F("payment"),c=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[l?e.jsx("p",{className:"text-sm text-muted-foreground",children:r("table.toolbar.sort.hint")}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hr,{refetch:n}),e.jsx(D,{placeholder:r("table.toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[250px]"}),c&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:[r("table.toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:l?"default":"outline",onClick:a,size:"sm",children:r(l?"table.toolbar.sort.save":"table.toolbar.sort.edit")})})]})}function wm(){const[s,n]=m.useState([]),[a,l]=m.useState([]),[r,c]=m.useState(!1),[o,u]=m.useState([]),[x,i]=m.useState({"drag-handle":!1}),[d,p]=m.useState({pageSize:20,pageIndex:0}),{refetch:w}=ie({queryKey:["paymentList"],queryFn:async()=>{const{data:g}=await Oc();return u(g?.map(S=>({...S,enable:!!S.enable}))||[]),g}});m.useEffect(()=>{i({"drag-handle":r,actions:!r}),p({pageSize:r?99999:10,pageIndex:0})},[r]);const P=(g,S)=>{r&&(g.dataTransfer.setData("text/plain",S.toString()),g.currentTarget.classList.add("opacity-50"))},f=(g,S)=>{if(!r)return;g.preventDefault(),g.currentTarget.classList.remove("bg-muted");const R=parseInt(g.dataTransfer.getData("text/plain"));if(R===S)return;const E=[...o],[O]=E.splice(R,1);E.splice(S,0,O),u(E)},j=async()=>{r?qc({ids:o.map(g=>g.id)}).then(()=>{w(),c(!1),$.success("排序保存成功")}):c(!0)},C=ss({data:o,columns:Nm({refetch:w,isSortMode:r}),state:{sorting:a,columnFilters:s,columnVisibility:x,pagination:d},onSortingChange:l,onColumnFiltersChange:n,onColumnVisibilityChange:i,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),initialState:{columnPinning:{right:["actions"]}},pageCount:r?1:void 0});return e.jsx(us,{table:C,toolbar:g=>e.jsx(_m,{table:g,refetch:w,saveOrder:j,isSortMode:r}),draggable:r,onDragStart:P,onDragEnd:g=>g.currentTarget.classList.remove("opacity-50"),onDragOver:g=>{g.preventDefault(),g.currentTarget.classList.add("bg-muted")},onDragLeave:g=>g.currentTarget.classList.remove("bg-muted"),onDrop:f,showPagination:!r})}function Cm(){const{t:s}=F("payment");return e.jsxs(Pe,{children:[e.jsxs(Ee,{className:"flex items-center justify-between",children:[e.jsx($e,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{children:[e.jsx("header",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("section",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(wm,{})})]})]})}const Sm=Object.freeze(Object.defineProperty({__proto__:null,default:Cm},Symbol.toStringTag,{value:"Module"}));function km({pluginName:s,onClose:n,onSuccess:a}){const{t:l}=F("plugin"),[r,c]=m.useState(!0),[o,u]=m.useState(!1),[x,i]=m.useState(null),d=ko({config:To(Do())}),p=fe({resolver:ye(d),defaultValues:{config:{}}});m.useEffect(()=>{(async()=>{try{const{data:j}=await bs.getPluginConfig(s);i(j),p.reset({config:Object.fromEntries(Object.entries(j).map(([C,g])=>[C,g.value]))})}catch{$.error(l("messages.configLoadError"))}finally{c(!1)}})()},[s]);const w=async f=>{u(!0);try{await bs.updatePluginConfig(s,f.config),$.success(l("messages.configSaveSuccess")),a()}catch{$.error(l("messages.configSaveError"))}finally{u(!1)}},P=(f,j)=>{switch(j.type){case"string":return e.jsx(b,{control:p.control,name:`config.${f}`,render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{children:j.label||j.description}),e.jsx(_,{children:e.jsx(D,{placeholder:j.placeholder,...C})}),j.description&&j.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description}),e.jsx(k,{})]})},f);case"number":case"percentage":return e.jsx(b,{control:p.control,name:`config.${f}`,render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{children:j.label||j.description}),e.jsx(_,{children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{type:"number",placeholder:j.placeholder,...C,onChange:g=>{const S=Number(g.target.value);j.type==="percentage"?C.onChange(Math.min(100,Math.max(0,S))):C.onChange(S)},className:j.type==="percentage"?"pr-8":"",min:j.type==="percentage"?0:void 0,max:j.type==="percentage"?100:void 0,step:j.type==="percentage"?1:void 0}),j.type==="percentage"&&e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx(Po,{className:"h-4 w-4 text-muted-foreground"})})]})}),j.description&&j.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description}),e.jsx(k,{})]})},f);case"select":return e.jsx(b,{control:p.control,name:`config.${f}`,render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{children:j.label||j.description}),e.jsxs(X,{onValueChange:C.onChange,defaultValue:C.value,children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:j.placeholder})})}),e.jsx(J,{children:j.options?.map(g=>e.jsx(U,{value:g.value,children:g.label},g.value))})]}),j.description&&j.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description}),e.jsx(k,{})]})},f);case"boolean":return e.jsx(b,{control:p.control,name:`config.${f}`,render:({field:C})=>e.jsxs(v,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{className:"text-base",children:j.label||j.description}),j.description&&j.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description})]}),e.jsx(_,{children:e.jsx(W,{checked:C.value,onCheckedChange:C.onChange})})]})},f);case"text":return e.jsx(b,{control:p.control,name:`config.${f}`,render:({field:C})=>e.jsxs(v,{children:[e.jsx(y,{children:j.label||j.description}),e.jsx(_,{children:e.jsx(js,{placeholder:j.placeholder,...C})}),j.description&&j.label&&e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description}),e.jsx(k,{})]})},f);default:return null}};return r?e.jsxs("div",{className:"space-y-4",children:[e.jsx(oe,{className:"h-4 w-[200px]"}),e.jsx(oe,{className:"h-10 w-full"}),e.jsx(oe,{className:"h-4 w-[200px]"}),e.jsx(oe,{className:"h-10 w-full"})]}):e.jsx(Ne,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(w),className:"space-y-4",children:[x&&Object.entries(x).map(([f,j])=>P(f,j)),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:n,disabled:o,children:l("config.cancel")}),e.jsx(T,{type:"submit",loading:o,disabled:o,children:l("config.save")})]})]})})}function Tm(){const{t:s}=F("plugin"),[n,a]=m.useState(null),[l,r]=m.useState(!1),[c,o]=m.useState(null),[u,x]=m.useState(""),[i,d]=m.useState("all"),[p,w]=m.useState(!1),[P,f]=m.useState(!1),[j,C]=m.useState(!1),g=m.useRef(null),{data:S,isLoading:R,refetch:E}=ie({queryKey:["pluginList"],queryFn:async()=>{const{data:V}=await bs.getPluginList();return V}});S&&[...new Set(S.map(V=>V.category||"other"))];const O=S?.filter(V=>{const Y=V.name.toLowerCase().includes(u.toLowerCase())||V.description.toLowerCase().includes(u.toLowerCase())||V.code.toLowerCase().includes(u.toLowerCase()),ne=i==="all"||V.category===i;return Y&&ne}),q=async V=>{a(V),bs.installPlugin(V).then(()=>{$.success(s("messages.installSuccess")),E()}).catch(Y=>{$.error(Y.message||s("messages.installError"))}).finally(()=>{a(null)})},te=async V=>{a(V),bs.uninstallPlugin(V).then(()=>{$.success(s("messages.uninstallSuccess")),E()}).catch(Y=>{$.error(Y.message||s("messages.uninstallError"))}).finally(()=>{a(null)})},M=async(V,Y)=>{a(V),(Y?bs.disablePlugin:bs.enablePlugin)(V).then(()=>{$.success(s(Y?"messages.disableSuccess":"messages.enableSuccess")),E()}).catch(Ye=>{$.error(Ye.message||s(Y?"messages.disableError":"messages.enableError"))}).finally(()=>{a(null)})},se=V=>{S?.find(Y=>Y.code===V),o(V),r(!0)},qe=async V=>{if(!V.name.endsWith(".zip")){$.error(s("upload.error.format"));return}w(!0),bs.uploadPlugin(V).then(()=>{$.success(s("messages.uploadSuccess")),f(!1),E()}).catch(Y=>{$.error(Y.message||s("messages.uploadError"))}).finally(()=>{w(!1),g.current&&(g.current.value="")})},B=V=>{V.preventDefault(),V.stopPropagation(),V.type==="dragenter"||V.type==="dragover"?C(!0):V.type==="dragleave"&&C(!1)},ae=V=>{V.preventDefault(),V.stopPropagation(),C(!1),V.dataTransfer.files&&V.dataTransfer.files[0]&&qe(V.dataTransfer.files[0])},A=async V=>{a(V),bs.deletePlugin(V).then(()=>{$.success(s("messages.deleteSuccess")),E()}).catch(Y=>{$.error(Y.message||s("messages.deleteError"))}).finally(()=>{a(null)})};return e.jsxs(Pe,{children:[e.jsxs(Ee,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ta,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("title")})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{children:[e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"relative max-w-sm flex-1",children:[e.jsx(An,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(D,{placeholder:s("search.placeholder"),value:u,onChange:V=>x(V.target.value),className:"pl-9"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(T,{onClick:()=>f(!0),variant:"outline",className:"shrink-0",size:"sm",children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),s("upload.button")]})})]}),e.jsxs(Wt,{defaultValue:"all",className:"w-full",children:[e.jsxs(bt,{children:[e.jsx(He,{value:"all",children:s("tabs.all")}),e.jsx(He,{value:"installed",children:s("tabs.installed")}),e.jsx(He,{value:"available",children:s("tabs.available")})]}),e.jsx(ys,{value:"all",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:R?e.jsxs(e.Fragment,{children:[e.jsx(ca,{}),e.jsx(ca,{}),e.jsx(ca,{})]}):O?.map(V=>e.jsx(oa,{plugin:V,onInstall:q,onUninstall:te,onToggleEnable:M,onOpenConfig:se,onDelete:A,isLoading:n===V.name},V.name))})}),e.jsx(ys,{value:"installed",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:O?.filter(V=>V.is_installed).map(V=>e.jsx(oa,{plugin:V,onInstall:q,onUninstall:te,onToggleEnable:M,onOpenConfig:se,onDelete:A,isLoading:n===V.name},V.name))})}),e.jsx(ys,{value:"available",className:"mt-6",children:e.jsx("div",{className:"space-y-4",children:O?.filter(V=>!V.is_installed).map(V=>e.jsx(oa,{plugin:V,onInstall:q,onUninstall:te,onToggleEnable:M,onOpenConfig:se,onDelete:A,isLoading:n===V.name},V.code))})})]})]}),e.jsx(ve,{open:l,onOpenChange:r,children:e.jsxs(pe,{className:"sm:max-w-lg",children:[e.jsxs(we,{children:[e.jsxs(be,{children:[S?.find(V=>V.code===c)?.name," ",s("config.title")]}),e.jsx(ke,{children:s("config.description")})]}),c&&e.jsx(km,{pluginName:c,onClose:()=>r(!1),onSuccess:()=>{r(!1),E()}})]})}),e.jsx(ve,{open:P,onOpenChange:f,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsxs(we,{children:[e.jsx(be,{children:s("upload.title")}),e.jsx(ke,{children:s("upload.description")})]}),e.jsxs("div",{className:N("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",j&&"border-primary/50 bg-muted/50"),onDragEnter:B,onDragLeave:B,onDragOver:B,onDrop:ae,children:[e.jsx("input",{type:"file",ref:g,className:"hidden",accept:".zip",onChange:V=>{const Y=V.target.files?.[0];Y&&qe(Y)}}),p?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("upload.uploading")})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(ht,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s("upload.dragText")," ",e.jsx("button",{type:"button",onClick:()=>g.current?.click(),className:"mx-1 text-primary hover:underline",children:s("upload.clickText")})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("upload.supportText")})]})]})})]})]})})]})]})}function oa({plugin:s,onInstall:n,onUninstall:a,onToggleEnable:l,onOpenConfig:r,onDelete:c,isLoading:o}){const{t:u}=F("plugin");return e.jsxs(Ke,{className:"group relative overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(Xe,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{children:s.name}),s.is_installed&&e.jsx(K,{variant:s.is_enabled?"success":"secondary",children:s.is_enabled?u("status.enabled"):u("status.disabled")})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ta,{className:"h-4 w-4"}),e.jsx("code",{className:"rounded bg-muted px-1 py-0.5",children:s.code})]}),e.jsxs("div",{children:["v",s.version]})]})]})}),e.jsx(Zs,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"mt-2",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1",children:[u("author"),": ",s.author]})})]})})]}),e.jsx(es,{children:e.jsx("div",{className:"flex items-center justify-end space-x-2",children:s.is_installed?e.jsxs(e.Fragment,{children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>r(s.code),disabled:!s.is_enabled||o,children:[e.jsx(Eo,{className:"mr-2 h-4 w-4"}),u("button.config")]}),e.jsxs(T,{variant:s.is_enabled?"destructive":"default",size:"sm",onClick:()=>l(s.code,s.is_enabled),disabled:o,children:[e.jsx(Ro,{className:"mr-2 h-4 w-4"}),s.is_enabled?u("button.disable"):u("button.enable")]}),e.jsx(Ge,{title:u("uninstall.title"),description:u("uninstall.description"),cancelText:u("common:cancel"),confirmText:u("uninstall.button"),variant:"destructive",onConfirm:()=>a(s.code),children:e.jsxs(T,{variant:"outline",size:"sm",className:"text-muted-foreground hover:text-destructive",disabled:o,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),u("button.uninstall")]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>n(s.code),disabled:o,loading:o,children:u("button.install")}),e.jsx(Ge,{title:u("delete.title"),description:u("delete.description"),cancelText:u("common:cancel"),confirmText:u("delete.button"),variant:"destructive",onConfirm:()=>c(s.code),children:e.jsx(T,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",disabled:o,children:e.jsx(ls,{className:"h-4 w-4"})})})]})})})]})}function ca(){return e.jsxs(Ke,{children:[e.jsxs(Xe,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-6 w-[200px]"}),e.jsx(oe,{className:"h-6 w-[80px]"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(oe,{className:"h-5 w-[120px]"}),e.jsx(oe,{className:"h-5 w-[60px]"})]})]})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(oe,{className:"h-4 w-[300px]"}),e.jsx(oe,{className:"h-4 w-[150px]"})]})]}),e.jsx(es,{children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(oe,{className:"h-9 w-[100px]"}),e.jsx(oe,{className:"h-9 w-[100px]"}),e.jsx(oe,{className:"h-8 w-8"})]})})]})}const Dm=Object.freeze(Object.defineProperty({__proto__:null,default:Tm},Symbol.toStringTag,{value:"Module"})),Pm=(s,n)=>{let a=null;switch(s.field_type){case"input":a=e.jsx(D,{placeholder:s.placeholder,...n});break;case"textarea":a=e.jsx(js,{placeholder:s.placeholder,...n});break;case"select":a=e.jsx("select",{className:N(Xs({variant:"outline"}),"w-full appearance-none font-normal"),...n,children:s.select_options&&Object.keys(s.select_options).map(l=>e.jsx("option",{value:l,children:s.select_options?.[l]},l))});break;default:a=null;break}return a};function Em({themeKey:s,themeInfo:n}){const{t:a}=F("theme"),[l,r]=m.useState(!1),[c,o]=m.useState(!1),[u,x]=m.useState(!1),i=fe({defaultValues:n.configs.reduce((w,P)=>(w[P.field_name]="",w),{})}),d=async()=>{o(!0),Nc(s).then(({data:w})=>{Object.entries(w).forEach(([P,f])=>{i.setValue(P,f)})}).finally(()=>{o(!1)})},p=async w=>{x(!0),_c(s,w).then(()=>{$.success(a("config.success")),r(!1)}).finally(()=>{x(!1)})};return e.jsxs(ve,{open:l,onOpenChange:w=>{r(w),w?d():i.reset()},children:[e.jsx(We,{asChild:!0,children:e.jsx(T,{variant:"outline",children:a("card.configureTheme")})}),e.jsxs(pe,{className:"max-h-[90vh] overflow-auto sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:a("config.title",{name:n.name})}),e.jsx(ke,{children:a("config.description")})]}),c?e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(Pa,{className:"h-6 w-6 animate-spin"})}):e.jsx(Ne,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(p),className:"space-y-4",children:[n.configs.map(w=>e.jsx(b,{control:i.control,name:w.field_name,render:({field:P})=>e.jsxs(v,{children:[e.jsx(y,{children:w.label}),e.jsx(_,{children:Pm(w,P)}),e.jsx(k,{})]})},w.field_name)),e.jsxs(Me,{className:"mt-6 gap-2",children:[e.jsx(T,{type:"button",variant:"secondary",onClick:()=>r(!1),children:a("config.cancel")}),e.jsx(T,{type:"submit",loading:u,children:a("config.save")})]})]})})]})]})}function Rm(){const{t:s}=F("theme"),[n,a]=m.useState(null),[l,r]=m.useState(!1),[c,o]=m.useState(!1),[u,x]=m.useState(!1),[i,d]=m.useState(null),p=m.useRef(null),[w,P]=m.useState(0),{data:f,isLoading:j,refetch:C}=ie({queryKey:["themeList"],queryFn:async()=>{const{data:M}=await yc();return M}}),g=async M=>{a(M),Sc({frontend_theme:M}).then(()=>{$.success("主题切换成功"),C()}).finally(()=>{a(null)})},S=async M=>{if(!M.name.endsWith(".zip")){$.error(s("upload.error.format"));return}r(!0),wc(M).then(()=>{$.success("主题上传成功"),o(!1),C()}).finally(()=>{r(!1),p.current&&(p.current.value="")})},R=M=>{M.preventDefault(),M.stopPropagation(),M.type==="dragenter"||M.type==="dragover"?x(!0):M.type==="dragleave"&&x(!1)},E=M=>{M.preventDefault(),M.stopPropagation(),x(!1),M.dataTransfer.files&&M.dataTransfer.files[0]&&S(M.dataTransfer.files[0])},O=()=>{i&&P(M=>M===0?i.images.length-1:M-1)},q=()=>{i&&P(M=>M===i.images.length-1?0:M+1)},te=(M,se)=>{P(0),d({name:M,images:se})};return e.jsxs(Pe,{children:[e.jsxs(Ee,{className:"flex items-center justify-between",children:[e.jsx($e,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-muted-foreground",children:s("description")}),e.jsxs(T,{onClick:()=>o(!0),variant:"outline",className:"ml-4 shrink-0",size:"sm",children:[e.jsx(ht,{className:"mr-2 h-4 w-4"}),s("upload.button")]})]})]}),e.jsx("section",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3",children:j?e.jsxs(e.Fragment,{children:[e.jsx(cn,{}),e.jsx(cn,{})]}):f?.themes&&Object.entries(f.themes).map(([M,se])=>e.jsx(Ke,{className:"group relative overflow-hidden transition-all hover:shadow-md",style:{backgroundImage:se.background_url?`url(${se.background_url})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:N("relative z-10 h-full transition-colors",se.background_url?"group-hover:from-background/98 bg-gradient-to-t from-background/95 via-background/80 to-background/60 backdrop-blur-[1px] group-hover:via-background/90 group-hover:to-background/70":"bg-background"),children:[!!se.can_delete&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(Ge,{title:s("card.delete.title"),description:s("card.delete.description"),confirmText:s("card.delete.button"),variant:"destructive",onConfirm:async()=>{if(M===f?.active){$.error(s("card.delete.error.active"));return}a(M),Cc(M).then(()=>{$.success("主题删除成功"),C()}).finally(()=>{a(null)})},children:e.jsx(T,{disabled:n===M,loading:n===M,variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(ls,{className:"h-4 w-4"})})})}),e.jsxs(Xe,{children:[e.jsx(_s,{children:se.name}),e.jsx(Zs,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:se.description}),se.version&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s("card.version",{version:se.version})})]})})]}),e.jsxs(es,{className:"flex items-center justify-end space-x-3",children:[se.images&&Array.isArray(se.images)&&se.images.length>0&&e.jsx(T,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>te(se.name,se.images),children:e.jsx(Io,{className:"h-4 w-4"})}),e.jsx(Em,{themeKey:M,themeInfo:se}),e.jsx(T,{onClick:()=>g(M),disabled:n===M||M===f.active,loading:n===M,variant:M===f.active?"secondary":"default",children:M===f.active?s("card.currentTheme"):s("card.activateTheme")})]})]})},M))}),e.jsx(ve,{open:c,onOpenChange:o,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsxs(we,{children:[e.jsx(be,{children:s("upload.title")}),e.jsx(ke,{children:s("upload.description")})]}),e.jsxs("div",{className:N("relative mt-4 flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 px-5 py-10 text-center transition-colors",u&&"border-primary/50 bg-muted/50"),onDragEnter:R,onDragLeave:R,onDragOver:R,onDrop:E,children:[e.jsx("input",{type:"file",ref:p,className:"hidden",accept:".zip",onChange:M=>{const se=M.target.files?.[0];se&&S(se)}}),l?e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s("upload.uploading")})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full border-2 border-muted-foreground/25 p-3",children:e.jsx(ht,{className:"h-6 w-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s("upload.dragText")," ",e.jsx("button",{type:"button",onClick:()=>p.current?.click(),className:"mx-1 text-primary hover:underline",children:s("upload.clickText")})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("upload.supportText")})]})]})})]})]})}),e.jsx(ve,{open:!!i,onOpenChange:M=>{M||(d(null),P(0))},children:e.jsxs(pe,{className:"max-w-4xl",children:[e.jsxs(we,{children:[e.jsxs(be,{children:[i?.name," ",s("preview.title")]}),e.jsx(ke,{className:"text-center",children:i&&s("preview.imageCount",{current:w+1,total:i.images.length})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-[16/9] overflow-hidden rounded-lg border bg-muted",children:i?.images[w]&&e.jsx("img",{src:i.images[w],alt:`${i.name} 预览图 ${w+1}`,className:"h-full w-full object-contain"})}),i&&i.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"outline",size:"icon",className:"absolute left-4 top-1/2 h-8 w-8 -translate-y-1/2 rounded-full bg-background/80 hover:bg-background",onClick:O,children:e.jsx(Vo,{className:"h-4 w-4"})}),e.jsx(T,{variant:"outline",size:"icon",className:"absolute right-4 top-1/2 h-8 w-8 -translate-y-1/2 rounded-full bg-background/80 hover:bg-background",onClick:q,children:e.jsx(Fo,{className:"h-4 w-4"})})]})]}),i&&i.images.length>1&&e.jsx("div",{className:"mt-4 flex gap-2 overflow-x-auto pb-2",children:i.images.map((M,se)=>e.jsx("button",{onClick:()=>P(se),className:N("relative h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border-2",w===se?"border-primary":"border-transparent"),children:e.jsx("img",{src:M,alt:`缩略图 ${se+1}`,className:"h-full w-full object-cover"})},se))})]})})]})]})}function cn(){return e.jsxs(Ke,{children:[e.jsxs(Xe,{children:[e.jsx(oe,{className:"h-6 w-[200px]"}),e.jsx(oe,{className:"h-4 w-[300px]"})]}),e.jsxs(es,{className:"flex items-center justify-end space-x-3",children:[e.jsx(oe,{className:"h-10 w-[100px]"}),e.jsx(oe,{className:"h-10 w-[100px]"})]})]})}const Im=Object.freeze(Object.defineProperty({__proto__:null,default:Rm},Symbol.toStringTag,{value:"Module"})),La=m.forwardRef(({className:s,value:n,onChange:a,...l},r)=>{const[c,o]=m.useState("");m.useEffect(()=>{if(c.includes(",")){const x=new Set([...n,...c.split(",").map(i=>i.trim())]);a(Array.from(x)),o("")}},[c,a,n]);const u=()=>{if(c){const x=new Set([...n,c]);a(Array.from(x)),o("")}};return e.jsxs("div",{className:N(" has-[:focus-visible]:outline-none has-[:focus-visible]:ring-1 has-[:focus-visible]:ring-neutral-950  dark:has-[:focus-visible]:ring-neutral-300  flex w-full flex-wrap gap-2 rounded-md border border-input shadow-sm px-3 py-2 text-sm ring-offset-white  disabled:cursor-not-allowed disabled:opacity-50",s),children:[n.map(x=>e.jsxs(K,{variant:"secondary",children:[x,e.jsx(G,{variant:"ghost",size:"icon",className:"ml-2 h-3 w-3",onClick:()=>{a(n.filter(i=>i!==x))},children:e.jsx(ja,{className:"w-3"})})]},x)),e.jsx("input",{className:"flex-1 outline-none placeholder:text-muted-foreground bg-transparent",value:c,onChange:x=>o(x.target.value),onKeyDown:x=>{x.key==="Enter"||x.key===","?(x.preventDefault(),u()):x.key==="Backspace"&&c.length===0&&n.length>0&&(x.preventDefault(),a(n.slice(0,-1)))},...l,ref:r})]})});La.displayName="InputTags";const Vm=h.object({id:h.number().nullable(),title:h.string().min(1).max(250),content:h.string().min(1),show:h.boolean(),tags:h.array(h.string()),img_url:h.string().nullable()}),Fm={id:null,show:!1,tags:[],img_url:"",title:"",content:""};function Wr({refetch:s,dialogTrigger:n,type:a="add",defaultFormValues:l=Fm}){const{t:r}=F("notice"),[c,o]=m.useState(!1),u=fe({resolver:ye(Vm),defaultValues:l,mode:"onChange",shouldFocusError:!0}),x=new Ea({html:!0});return e.jsx(Ne,{...u,children:e.jsxs(ve,{onOpenChange:o,open:c,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"})," ",e.jsx("div",{children:r("form.add.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[1025px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:r(a==="add"?"form.add.title":"form.edit.title")}),e.jsx(ke,{})]}),e.jsx(b,{control:u.control,name:"title",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.title.label")}),e.jsx("div",{className:"relative ",children:e.jsx(_,{children:e.jsx(D,{placeholder:r("form.fields.title.placeholder"),...i})})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"content",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.content.label")}),e.jsx(_,{children:e.jsx(Ra,{style:{height:"500px"},value:i.value,renderHTML:d=>x.render(d),onChange:({text:d})=>{i.onChange(d)}})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"img_url",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.img_url.label")}),e.jsx("div",{className:"relative",children:e.jsx(_,{children:e.jsx(D,{type:"text",placeholder:r("form.fields.img_url.placeholder"),...i,value:i.value||""})})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"show",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.show.label")}),e.jsx("div",{className:"relative py-2",children:e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:i.onChange})})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"tags",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.fields.tags.label")}),e.jsx(_,{children:e.jsx(La,{value:i.value,onChange:i.onChange,placeholder:r("form.fields.tags.placeholder"),className:"w-full"})}),e.jsx(k,{})]})}),e.jsxs(Me,{children:[e.jsx(Nt,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:r("form.buttons.cancel")})}),e.jsx(T,{type:"submit",onClick:i=>{i.preventDefault(),u.handleSubmit(async d=>{Uc(d).then(({data:p})=>{p&&($.success(r("form.buttons.success")),s(),o(!1))})})()},children:r("form.buttons.submit")})]})]})]})})}function Om({table:s,refetch:n,saveOrder:a,isSortMode:l}){const{t:r}=F("notice"),c=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between space-x-2 ",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[!l&&e.jsx(Wr,{refetch:n}),!l&&e.jsx(D,{placeholder:r("table.toolbar.search"),value:s.getColumn("title")?.getFilterValue()??"",onChange:o=>s.getColumn("title")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),c&&!l&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-9 px-2 lg:px-3",children:[r("table.toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(T,{variant:l?"default":"outline",onClick:a,className:"h-8",size:"sm",children:r(l?"table.toolbar.sort.save":"table.toolbar.sort.edit")})})]})}const Mm=s=>{const{t:n}=F("notice");return[{id:"drag-handle",header:"",cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Oo,{className:"h-4 w-4 text-muted-foreground cursor-move"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.id")}),cell:({row:a})=>e.jsx(K,{variant:"outline",className:"font-mono",children:a.getValue("id")}),enableSorting:!0,size:60},{accessorKey:"show",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.show")}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx(W,{defaultChecked:a.getValue("show"),onCheckedChange:async()=>{const{data:l}=await Kc({id:a.original.id});l||s()}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.title")}),cell:({row:a})=>e.jsx("div",{className:"flex max-w-[500px] items-center",children:e.jsx("span",{className:"truncate font-medium",children:a.getValue("title")})}),enableSorting:!1,size:6e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("table.columns.actions")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(Wr,{refetch:s,dialogTrigger:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:n("table.actions.edit")})]}),type:"edit",defaultFormValues:a.original}),e.jsx(Ge,{title:n("table.actions.delete.title"),description:n("table.actions.delete.description"),onConfirm:async()=>{Hc({id:a.original.id}).then(()=>{$.success(n("table.actions.delete.success")),s()})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:n("table.actions.delete.title")})]})})]}),size:100}]};function zm(){const[s,n]=m.useState({}),[a,l]=m.useState({}),[r,c]=m.useState([]),[o,u]=m.useState([]),[x,i]=m.useState(!1),[d,p]=m.useState({}),[w,P]=m.useState({pageSize:50,pageIndex:0}),[f,j]=m.useState([]),{refetch:C}=ie({queryKey:["notices"],queryFn:async()=>{const{data:O}=await nn.getList();return j(O),O}});m.useEffect(()=>{l({"drag-handle":x,content:!x,created_at:!x,actions:!x}),P({pageSize:x?99999:50,pageIndex:0})},[x]);const g=(O,q)=>{x&&(O.dataTransfer.setData("text/plain",q.toString()),O.currentTarget.classList.add("opacity-50"))},S=(O,q)=>{if(!x)return;O.preventDefault(),O.currentTarget.classList.remove("bg-muted");const te=parseInt(O.dataTransfer.getData("text/plain"));if(te===q)return;const M=[...f],[se]=M.splice(te,1);M.splice(q,0,se),j(M)},R=async()=>{if(!x){i(!0);return}nn.sort(f.map(O=>O.id)).then(()=>{$.success("排序保存成功"),i(!1),C()}).finally(()=>{i(!1)})},E=ss({data:f??[],columns:Mm(C),state:{sorting:o,columnVisibility:a,rowSelection:s,columnFilters:r,columnSizing:d,pagination:w},enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:l,onColumnSizingChange:p,onPaginationChange:P,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx("div",{className:"space-y-4",children:e.jsx(us,{table:E,toolbar:O=>e.jsx(Om,{table:O,refetch:C,saveOrder:R,isSortMode:x}),draggable:x,onDragStart:g,onDragEnd:O=>O.currentTarget.classList.remove("opacity-50"),onDragOver:O=>{O.preventDefault(),O.currentTarget.classList.add("bg-muted")},onDragLeave:O=>O.currentTarget.classList.remove("bg-muted"),onDrop:S,showPagination:!x})})}function Lm(){const{t:s}=F("notice");return e.jsxs(Pe,{children:[e.jsxs(Ee,{className:"flex items-center justify-between",children:[e.jsx($e,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")})}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(zm,{})})]})]})}const Am=Object.freeze(Object.defineProperty({__proto__:null,default:Lm},Symbol.toStringTag,{value:"Module"})),$m=h.object({id:h.number().nullable(),language:h.string().max(250),category:h.string().max(250),title:h.string().min(1).max(250),body:h.string().min(1),show:h.boolean()}),qm={id:null,language:"zh-CN",category:"",title:"",body:"",show:!1};function Yr({refreshData:s,dialogTrigger:n,type:a="add",defaultFormValues:l=qm}){const{t:r}=F("knowledge"),[c,o]=m.useState(!1),u=fe({resolver:ye($m),defaultValues:l,mode:"onChange",shouldFocusError:!0}),x=new Ea({html:!0});return m.useEffect(()=>{c&&l.id&&Gc(l.id).then(({data:i})=>{u.reset(i)})},[l.id,u,c]),e.jsxs(ve,{onOpenChange:o,open:c,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"})," ",e.jsx("div",{children:r("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[1025px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:r(a==="add"?"form.add":"form.edit")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...u,children:[e.jsx(b,{control:u.control,name:"title",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.title")}),e.jsx("div",{className:"relative ",children:e.jsx(_,{children:e.jsx(D,{placeholder:r("form.titlePlaceholder"),...i})})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"category",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.category")}),e.jsx("div",{className:"relative ",children:e.jsx(_,{children:e.jsx(D,{placeholder:r("form.categoryPlaceholder"),...i})})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"language",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.language")}),e.jsx(_,{children:e.jsxs(X,{value:i.value,onValueChange:i.onChange,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:r("form.languagePlaceholder")})}),e.jsx(J,{children:[{value:"en-US"},{value:"ja-JP"},{value:"ko-KR"},{value:"vi-VN"},{value:"zh-CN"},{value:"zh-TW"}].map(d=>e.jsx(U,{value:d.value,className:"cursor-pointer",children:r(`languages.${d.value}`)},d.value))})]})})]})}),e.jsx(b,{control:u.control,name:"body",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.content")}),e.jsx(_,{children:e.jsx(Ra,{style:{height:"500px"},value:i.value,renderHTML:d=>x.render(d),onChange:({text:d})=>{i.onChange(d)}})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"show",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.show")}),e.jsx("div",{className:"relative py-2",children:e.jsx(_,{children:e.jsx(W,{checked:i.value,onCheckedChange:i.onChange})})}),e.jsx(k,{})]})}),e.jsxs(Me,{children:[e.jsx(Nt,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:r("form.cancel")})}),e.jsx(T,{type:"submit",onClick:()=>{u.handleSubmit(i=>{Wc(i).then(({data:d})=>{d&&(u.reset(),$.success(r("messages.operationSuccess")),o(!1),s())})})()},children:r("form.submit")})]})]})]})]})}function Um({column:s,title:n,options:a}){const l=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),n,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(c=>r.has(c.value)).map(c=>e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:c.label},c.value))})]})]})}),e.jsx(ds,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Vs,{children:[e.jsx(Hs,{placeholder:n}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:"No results found."}),e.jsx(Be,{children:a.map(c=>{const o=r.has(c.value);return e.jsxs(Ie,{onSelect:()=>{o?r.delete(c.value):r.add(c.value);const u=Array.from(r);s?.setFilterValue(u.length?u:void 0)},children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(As,{className:N("h-4 w-4")})}),c.icon&&e.jsx(c.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:c.label}),l?.get(c.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(c.value)})]},c.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),e.jsx(Be,{children:e.jsx(Ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function Hm({table:s,refetch:n,saveOrder:a,isSortMode:l}){const r=s.getState().columnFilters.length>0,{t:c}=F("knowledge");return e.jsxs("div",{className:"flex items-center justify-between",children:[l?e.jsx("p",{className:"text-sm text-muted-foreground",children:c("toolbar.sortModeHint")}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yr,{refreshData:n}),e.jsx(D,{placeholder:c("toolbar.searchPlaceholder"),value:s.getColumn("title")?.getFilterValue()??"",onChange:o=>s.getColumn("title")?.setFilterValue(o.target.value),className:"h-8 w-[250px]"}),s.getColumn("category")&&e.jsx(Um,{column:s.getColumn("category"),title:c("columns.category"),options:Array.from(new Set(s.getCoreRowModel().rows.map(o=>o.getValue("category")))).map(o=>({label:o,value:o}))}),r&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),children:[c("toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:l?"default":"outline",onClick:a,size:"sm",children:c(l?"toolbar.saveSort":"toolbar.editSort")})})]})}const Km=({refetch:s,isSortMode:n=!1})=>{const{t:a}=F("knowledge");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:n?"cursor-move":"opacity-0",children:e.jsx(Kt,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.id")}),cell:({row:l})=>e.jsx(K,{variant:"outline",className:"justify-center",children:l.getValue("id")}),enableSorting:!0,size:70},{accessorKey:"show",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.status")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center",children:e.jsx(W,{defaultChecked:l.getValue("show"),onCheckedChange:async()=>{Qc({id:l.original.id}).then(({data:r})=>{r||s()})}})}),enableSorting:!1,size:100},{accessorKey:"title",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.title")}),cell:({row:l})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"line-clamp-2 font-medium",children:l.getValue("title")})}),enableSorting:!0,size:600},{accessorKey:"category",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.category")}),cell:({row:l})=>e.jsx(K,{variant:"secondary",className:"max-w-[180px] truncate",children:l.getValue("category")}),enableSorting:!0,size:1800},{id:"actions",header:({column:l})=>e.jsx(L,{className:"justify-end",column:l,title:a("columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(Yr,{refreshData:s,dialogTrigger:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:a("form.edit")})]}),type:"edit",defaultFormValues:l.original}),e.jsx(Ge,{title:a("messages.deleteConfirm"),description:a("messages.deleteDescription"),confirmText:a("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{Yc({id:l.original.id}).then(({data:r})=>{r&&($.success(a("messages.operationSuccess")),s())})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:a("messages.deleteButton")})]})})]}),size:100}]};function Bm(){const[s,n]=m.useState([]),[a,l]=m.useState([]),[r,c]=m.useState(!1),[o,u]=m.useState([]),[x,i]=m.useState({"drag-handle":!1}),[d,p]=m.useState({pageSize:20,pageIndex:0}),{refetch:w,isLoading:P,data:f}=ie({queryKey:["knowledge"],queryFn:async()=>{const{data:R}=await Bc();return u(R||[]),R}});m.useEffect(()=>{i({"drag-handle":r,actions:!r}),p({pageSize:r?99999:10,pageIndex:0})},[r]);const j=(R,E)=>{r&&(R.dataTransfer.setData("text/plain",E.toString()),R.currentTarget.classList.add("opacity-50"))},C=(R,E)=>{if(!r)return;R.preventDefault(),R.currentTarget.classList.remove("bg-muted");const O=parseInt(R.dataTransfer.getData("text/plain"));if(O===E)return;const q=[...o],[te]=q.splice(O,1);q.splice(E,0,te),u(q)},g=async()=>{r?Jc({ids:o.map(R=>R.id)}).then(()=>{w(),c(!1),$.success("排序保存成功")}):c(!0)},S=ss({data:o,columns:Km({refetch:w,isSortMode:r}),state:{sorting:a,columnFilters:s,columnVisibility:x,pagination:d},onSortingChange:l,onColumnFiltersChange:n,onColumnVisibilityChange:i,onPaginationChange:p,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(us,{table:S,toolbar:R=>e.jsx(Hm,{table:R,refetch:w,saveOrder:g,isSortMode:r}),draggable:r,onDragStart:j,onDragEnd:R=>R.currentTarget.classList.remove("opacity-50"),onDragOver:R=>{R.preventDefault(),R.currentTarget.classList.add("bg-muted")},onDragLeave:R=>R.currentTarget.classList.remove("bg-muted"),onDrop:C,showPagination:!r})}function Gm(){const{t:s}=F("knowledge");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:s("title")}),e.jsx("p",{className:"text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Bm,{})})]})]})}const Wm=Object.freeze(Object.defineProperty({__proto__:null,default:Gm},Symbol.toStringTag,{value:"Module"}));function Ym(s,n){const[a,l]=m.useState(s);return m.useEffect(()=>{const r=setTimeout(()=>l(s),n);return()=>{clearTimeout(r)}},[s,n]),a}function da(s,n){if(s.length===0)return{};if(!n)return{"":s};const a={};return s.forEach(l=>{const r=l[n]||"";a[r]||(a[r]=[]),a[r].push(l)}),a}function Qm(s,n){const a=JSON.parse(JSON.stringify(s));for(const[l,r]of Object.entries(a))a[l]=r.filter(c=>!n.find(o=>o.value===c.value));return a}function Jm(s,n){for(const[,a]of Object.entries(s))if(a.some(l=>n.find(r=>r.value===l.value)))return!0;return!1}const Qr=m.forwardRef(({className:s,...n},a)=>Mo(r=>r.filtered.count===0)?e.jsx("div",{ref:a,className:N("py-6 text-center text-sm",s),"cmdk-empty":"",role:"presentation",...n}):null);Qr.displayName="CommandEmpty";const ft=m.forwardRef(({value:s,onChange:n,placeholder:a,defaultOptions:l=[],options:r,delay:c,onSearch:o,loadingIndicator:u,emptyIndicator:x,maxSelected:i=Number.MAX_SAFE_INTEGER,onMaxSelected:d,hidePlaceholderWhenSelected:p,disabled:w,groupBy:P,className:f,badgeClassName:j,selectFirstItem:C=!0,creatable:g=!1,triggerSearchOnFocus:S=!1,commandProps:R,inputProps:E,hideClearAllButton:O=!1},q)=>{const te=m.useRef(null),[M,se]=m.useState(!1),qe=m.useRef(!1),[B,ae]=m.useState(!1),[A,V]=m.useState(s||[]),[Y,ne]=m.useState(da(l,P)),[Ye,at]=m.useState(""),nt=Ym(Ye,c||500);m.useImperativeHandle(q,()=>({selectedValue:[...A],input:te.current,focus:()=>te.current?.focus()}),[A]);const _t=m.useCallback(Z=>{const de=A.filter(Ae=>Ae.value!==Z.value);V(de),n?.(de)},[n,A]),bl=m.useCallback(Z=>{const de=te.current;de&&((Z.key==="Delete"||Z.key==="Backspace")&&de.value===""&&A.length>0&&(A[A.length-1].fixed||_t(A[A.length-1])),Z.key==="Escape"&&de.blur())},[_t,A]);m.useEffect(()=>{s&&V(s)},[s]),m.useEffect(()=>{if(!r||o)return;const Z=da(r||[],P);JSON.stringify(Z)!==JSON.stringify(Y)&&ne(Z)},[l,r,P,o,Y]),m.useEffect(()=>{const Z=async()=>{ae(!0);const Ae=await o?.(nt);ne(da(Ae||[],P)),ae(!1)};(async()=>{!o||!M||(S&&await Z(),nt&&await Z())})()},[nt,P,M,S]);const yl=()=>{if(!g||Jm(Y,[{value:Ye,label:Ye}])||A.find(de=>de.value===Ye))return;const Z=e.jsx(Ie,{value:Ye,className:"cursor-pointer",onMouseDown:de=>{de.preventDefault(),de.stopPropagation()},onSelect:de=>{if(A.length>=i){d?.(A.length);return}at("");const Ae=[...A,{value:de,label:de}];V(Ae),n?.(Ae)},children:`Create "${Ye}"`});if(!o&&Ye.length>0||o&&nt.length>0&&!B)return Z},Nl=m.useCallback(()=>{if(x)return o&&!g&&Object.keys(Y).length===0?e.jsx(Ie,{value:"-",disabled:!0,children:x}):e.jsx(Qr,{children:x})},[g,x,o,Y]),_l=m.useMemo(()=>Qm(Y,A),[Y,A]),wl=m.useCallback(()=>{if(R?.filter)return R.filter;if(g)return(Z,de)=>Z.toLowerCase().includes(de.toLowerCase())?1:-1},[g,R?.filter]),Cl=m.useCallback(()=>{const Z=A.filter(de=>de.fixed);V(Z),n?.(Z)},[n,A]);return e.jsxs(Vs,{...R,onKeyDown:Z=>{bl(Z),R?.onKeyDown?.(Z)},className:N("h-auto overflow-visible bg-transparent",R?.className),shouldFilter:R?.shouldFilter!==void 0?R.shouldFilter:!o,filter:wl(),children:[e.jsx("div",{className:N("rounded-md border border-input text-sm ring-offset-background focus-within:ring-1 focus-within:ring-ring ",{"px-3 py-2":A.length!==0,"cursor-text":!w&&A.length!==0},f),onClick:()=>{w||te.current?.focus()},children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[A.map(Z=>e.jsxs(K,{className:N("data-[disabled]:bg-muted-foreground data-[disabled]:text-muted data-[disabled]:hover:bg-muted-foreground","data-[fixed]:bg-muted-foreground data-[fixed]:text-muted data-[fixed]:hover:bg-muted-foreground",j),"data-fixed":Z.fixed,"data-disabled":w||void 0,children:[Z.label,e.jsx("button",{className:N("ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",(w||Z.fixed)&&"hidden"),onKeyDown:de=>{de.key==="Enter"&&_t(Z)},onMouseDown:de=>{de.preventDefault(),de.stopPropagation()},onClick:()=>_t(Z),children:e.jsx(ja,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},Z.value)),e.jsx(Oe.Input,{...E,ref:te,value:Ye,disabled:w,onValueChange:Z=>{at(Z),E?.onValueChange?.(Z)},onBlur:Z=>{qe.current===!1&&se(!1),E?.onBlur?.(Z)},onFocus:Z=>{se(!0),S&&o?.(nt),E?.onFocus?.(Z)},placeholder:p&&A.length!==0?"":a,className:N("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":p,"px-3 py-2":A.length===0,"ml-1":A.length!==0},E?.className)}),e.jsx("button",{type:"button",onClick:Cl,className:N((O||w||A.length<1||A.filter(Z=>Z.fixed).length===A.length)&&"hidden"),children:e.jsx(ja,{})})]})}),e.jsx("div",{className:"relative",children:M&&e.jsx(Fs,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",onMouseLeave:()=>{qe.current=!1},onMouseEnter:()=>{qe.current=!0},onMouseUp:()=>{te.current?.focus()},children:B?e.jsx(e.Fragment,{children:u}):e.jsxs(e.Fragment,{children:[Nl(),yl(),!C&&e.jsx(Ie,{value:"-",className:"hidden"}),Object.entries(_l).map(([Z,de])=>e.jsx(Be,{heading:Z,className:"h-full overflow-auto",children:e.jsx(e.Fragment,{children:de.map(Ae=>e.jsx(Ie,{value:Ae.value,disabled:Ae.disable,onMouseDown:rt=>{rt.preventDefault(),rt.stopPropagation()},onSelect:()=>{if(A.length>=i){d?.(A.length);return}at("");const rt=[...A,Ae];V(rt),n?.(rt)},className:N("cursor-pointer",Ae.disable&&"cursor-default text-muted-foreground"),children:Ae.label},Ae.value))})},Z))]})})})]})});ft.displayName="MultipleSelector";const Zm=s=>h.object({id:h.number().optional(),name:h.string().min(2,s("messages.nameValidation.min")).max(50,s("messages.nameValidation.max")).regex(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/,s("messages.nameValidation.pattern"))});function aa({refetch:s,dialogTrigger:n,defaultValues:a={name:""},type:l="add"}){const{t:r}=F("group"),c=fe({resolver:ye(Zm(r)),defaultValues:a,mode:"onChange"}),[o,u]=m.useState(!1),[x,i]=m.useState(!1),d=async p=>{i(!0),Rc(p).then(()=>{$.success(r(l==="edit"?"messages.updateSuccess":"messages.createSuccess")),s&&s(),c.reset(),u(!1)}).finally(()=>{i(!1)})};return e.jsxs(ve,{open:o,onOpenChange:u,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("span",{children:r("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:r(l==="edit"?"form.edit":"form.create")}),e.jsx(ke,{children:r(l==="edit"?"form.editDescription":"form.createDescription")})]}),e.jsx(Ne,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(d),className:"space-y-4",children:[e.jsx(b,{control:c.control,name:"name",render:({field:p})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.name")}),e.jsx(_,{children:e.jsx(D,{placeholder:r("form.namePlaceholder"),...p,className:"w-full"})}),e.jsx(z,{children:r("form.nameDescription")}),e.jsx(k,{})]})}),e.jsxs(Me,{className:"gap-2",children:[e.jsx(Nt,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:r("form.cancel")})}),e.jsxs(T,{type:"submit",disabled:x||!c.formState.isValid,children:[x&&e.jsx(Pa,{className:"mr-2 h-4 w-4 animate-spin"}),r(l==="edit"?"form.update":"form.create")]})]})]})})]})]})}const Jr=m.createContext(void 0);function Xm({children:s,refetch:n}){const[a,l]=m.useState(!1),[r,c]=m.useState(null),[o,u]=m.useState(Te.Shadowsocks);return e.jsx(Jr.Provider,{value:{isOpen:a,setIsOpen:l,editingServer:r,setEditingServer:c,serverType:o,setServerType:u,refetch:n},children:s})}function Zr(){const s=m.useContext(Jr);if(s===void 0)throw new Error("useServerEdit must be used within a ServerEditProvider");return s}function ua({dialogTrigger:s,value:n,setValue:a,templateType:l}){const{t:r}=F("server");m.useEffect(()=>{console.log(n)},[n]);const[c,o]=m.useState(!1),[u,x]=m.useState(()=>{if(!n||Object.keys(n).length===0)return"";try{return JSON.stringify(n,null,2)}catch{return""}}),[i,d]=m.useState(null),p=g=>{if(!g)return null;try{const S=JSON.parse(g);return typeof S!="object"||S===null?r("network_settings.validation.must_be_object"):null}catch{return r("network_settings.validation.invalid_json")}},w={tcp:{label:"TCP",content:{acceptProxyProtocol:!1,header:{type:"none"}}},"tcp-http":{label:"TCP + HTTP",content:{acceptProxyProtocol:!1,header:{type:"http",request:{version:"1.1",method:"GET",path:["/"],headers:{Host:["www.example.com"]}},response:{version:"1.1",status:"200",reason:"OK"}}}},grpc:{label:"gRPC",content:{serviceName:"GunService"}},ws:{label:"WebSocket",content:{path:"/",headers:{Host:"v2ray.com"}}}},P=()=>{switch(l){case"tcp":return["tcp","tcp-http"];case"grpc":return["grpc"];case"ws":return["ws"];default:return[]}},f=()=>{const g=p(u||"");if(g){$.error(g);return}try{if(!u){a(null),o(!1);return}a(JSON.parse(u)),o(!1)}catch{$.error(r("network_settings.errors.save_failed"))}},j=g=>{x(g),d(p(g))},C=g=>{const S=w[g];if(S){const R=JSON.stringify(S.content,null,2);x(R),d(null)}};return m.useEffect(()=>{c&&console.log(n)},[c,n]),m.useEffect(()=>{c&&n&&Object.keys(n).length>0&&x(JSON.stringify(n,null,2))},[c,n]),e.jsxs(ve,{open:c,onOpenChange:g=>{!g&&c&&f(),o(g)},children:[e.jsx(We,{asChild:!0,children:s??e.jsx(G,{variant:"link",children:r("network_settings.edit_protocol")})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(we,{children:e.jsx(be,{children:r("network_settings.edit_protocol_config")})}),e.jsxs("div",{className:"space-y-4",children:[P().length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:P().map(g=>e.jsx(G,{variant:"outline",size:"sm",onClick:()=>C(g),children:r("network_settings.use_template",{template:w[g].label})},g))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(js,{className:`min-h-[200px] font-mono text-sm ${i?"border-red-500 focus-visible:ring-red-500":""}`,value:u,placeholder:P().length>0?r("network_settings.json_config_placeholder_with_template"):r("network_settings.json_config_placeholder"),onChange:g=>j(g.target.value)}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i})]})]}),e.jsxs(Me,{className:"gap-2",children:[e.jsx(G,{variant:"outline",onClick:()=>o(!1),children:r("common.cancel")}),e.jsx(G,{onClick:f,disabled:!!i,children:r("common.confirm")})]})]})]})}function dp(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}const ex={},sx=Object.freeze(Object.defineProperty({__proto__:null,default:ex},Symbol.toStringTag,{value:"Module"})),up=Jo(sx),dn=s=>s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),tx=()=>{try{const s=zo.box.keyPair(),n=dn(Ja.encodeBase64(s.secretKey)),a=dn(Ja.encodeBase64(s.publicKey));return{privateKey:n,publicKey:a}}catch(s){throw console.error("Error generating x25519 key pair:",s),s}},ax=()=>{try{return tx()}catch(s){throw console.error("Error generating key pair:",s),s}},nx=s=>{const n=new Uint8Array(Math.ceil(s/2));return window.crypto.getRandomValues(n),Array.from(n).map(a=>a.toString(16).padStart(2,"0")).join("").substring(0,s)},rx=()=>{const s=Math.floor(Math.random()*8)*2+2;return nx(s)},lx=h.object({cipher:h.string().default("aes-128-gcm"),obfs:h.string().default("0"),obfs_settings:h.object({path:h.string().default(""),host:h.string().default("")}).default({})}),ix=h.object({tls:h.coerce.number().default(0),tls_settings:h.object({server_name:h.string().default(""),allow_insecure:h.boolean().default(!1)}).default({}),network:h.string().default("tcp"),network_settings:h.record(h.any()).default({})}),ox=h.object({server_name:h.string().default(""),allow_insecure:h.boolean().default(!1),network:h.string().default("tcp"),network_settings:h.record(h.any()).default({})}),cx=h.object({version:h.coerce.number().default(2),alpn:h.string().default("h2"),obfs:h.object({open:h.coerce.boolean().default(!1),type:h.string().default("salamander"),password:h.string().default("")}).default({}),tls:h.object({server_name:h.string().default(""),allow_insecure:h.boolean().default(!1)}).default({}),bandwidth:h.object({up:h.string().default(""),down:h.string().default("")}).default({})}),dx=h.object({tls:h.coerce.number().default(0),tls_settings:h.object({server_name:h.string().default(""),allow_insecure:h.boolean().default(!1)}).default({}),reality_settings:h.object({server_port:h.coerce.number().default(443),server_name:h.string().default(""),allow_insecure:h.boolean().default(!1),public_key:h.string().default(""),private_key:h.string().default(""),short_id:h.string().default("")}).default({}),network:h.string().default("tcp"),network_settings:h.record(h.any()).default({}),flow:h.string().default("")}),vs={shadowsocks:{schema:lx,ciphers:["aes-128-gcm","aes-192-gcm","aes-256-gcm","chacha20-ietf-poly1305","2022-blake3-aes-128-gcm","2022-blake3-aes-256-gcm"]},vmess:{schema:ix,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}]},trojan:{schema:ox,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"}]},hysteria:{schema:cx,versions:["1","2"],alpnOptions:["hysteria","http/1.1","h2","h3"]},vless:{schema:dx,networkOptions:[{value:"tcp",label:"TCP"},{value:"ws",label:"Websocket"},{value:"grpc",label:"gRPC"},{value:"kcp",label:"mKCP"},{value:"httpupgrade",label:"HttpUpgrade"},{value:"xhttp",label:"XHTTP"}],flowOptions:["none","xtls-rprx-direct","xtls-rprx-splice","xtls-rprx-vision"]}},ux=({serverType:s,value:n,onChange:a})=>{const{t:l}=F("server"),r=s?vs[s]:null,c=r?.schema||h.record(h.any()),o=s?c.parse({}):{},u=fe({resolver:ye(c),defaultValues:o,mode:"onChange"});if(m.useEffect(()=>{if(!n||Object.keys(n).length===0){if(s){const f=c.parse({});u.reset(f)}}else u.reset(n)},[s,n,a,u,c]),m.useEffect(()=>{const f=u.watch(j=>{a(j)});return()=>f.unsubscribe()},[u,a]),!s||!r)return null;const P={shadowsocks:()=>e.jsxs(e.Fragment,{children:[e.jsx(b,{control:u.control,name:"cipher",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.shadowsocks.cipher.label")}),e.jsx(_,{children:e.jsxs(X,{onValueChange:f.onChange,value:f.value,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.shadowsocks.cipher.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.shadowsocks.ciphers.map(j=>e.jsx(U,{value:j,children:j},j))})})]})})]})}),e.jsx(b,{control:u.control,name:"obfs",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.shadowsocks.obfs.label")}),e.jsx(_,{children:e.jsxs(X,{onValueChange:f.onChange,value:f.value,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.shadowsocks.obfs.placeholder")})}),e.jsx(J,{children:e.jsxs(Ds,{children:[e.jsx(U,{value:"0",children:l("dynamic_form.shadowsocks.obfs.none")}),e.jsx(U,{value:"http",children:l("dynamic_form.shadowsocks.obfs.http")})]})})]})})]})}),u.watch("obfs")==="http"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"obfs_settings.path",render:({field:f})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(_,{children:e.jsx(D,{type:"text",placeholder:l("dynamic_form.shadowsocks.obfs_settings.path"),...f})}),e.jsx(k,{})]})}),e.jsx(b,{control:u.control,name:"obfs_settings.host",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(_,{children:e.jsx(D,{type:"text",placeholder:l("dynamic_form.shadowsocks.obfs_settings.host"),...f})}),e.jsx(k,{})]})})]})]}),vmess:()=>e.jsxs(e.Fragment,{children:[e.jsx(b,{control:u.control,name:"tls",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vmess.tls.label")}),e.jsx(_,{children:e.jsxs(X,{value:f.value?.toString(),onValueChange:j=>f.onChange(Number(j)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.vmess.tls.placeholder")})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:l("dynamic_form.vmess.tls.disabled")}),e.jsx(U,{value:"1",children:l("dynamic_form.vmess.tls.enabled")})]})]})})]})}),u.watch("tls")==1&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"tls_settings.server_name",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.vmess.tls_settings.server_name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.vmess.tls_settings.server_name.placeholder"),...f})})]})}),e.jsx(b,{control:u.control,name:"tls_settings.allow_insecure",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vmess.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value,onCheckedChange:f.onChange})})})]})})]}),e.jsx(b,{control:u.control,name:"network",render:({field:f})=>e.jsxs(v,{children:[e.jsxs(y,{children:[l("dynamic_form.vmess.network.label"),e.jsx(ua,{value:u.watch("network_settings"),setValue:j=>u.setValue("network_settings",j),templateType:u.watch("network")})]}),e.jsx(_,{children:e.jsxs(X,{onValueChange:f.onChange,value:f.value,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.vmess.network.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.vmess.networkOptions.map(j=>e.jsx(U,{value:j.value,className:"cursor-pointer",children:j.label},j.value))})})]})})]})})]}),trojan:()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"server_name",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.trojan.server_name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.trojan.server_name.placeholder"),...f,value:f.value||""})})]})}),e.jsx(b,{control:u.control,name:"allow_insecure",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.trojan.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value||!1,onCheckedChange:f.onChange})})})]})})]}),e.jsx(b,{control:u.control,name:"network",render:({field:f})=>e.jsxs(v,{children:[e.jsxs(y,{children:[l("dynamic_form.trojan.network.label"),e.jsx(ua,{value:u.watch("network_settings")||{},setValue:j=>u.setValue("network_settings",j),templateType:u.watch("network")||"tcp"})]}),e.jsx(_,{children:e.jsxs(X,{onValueChange:f.onChange,value:f.value||"tcp",children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.trojan.network.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.trojan.networkOptions.map(j=>e.jsx(U,{value:j.value,className:"cursor-pointer",children:j.label},j.value))})})]})})]})})]}),hysteria:()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"version",render:({field:f})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:l("dynamic_form.hysteria.version.label")}),e.jsx(_,{children:e.jsxs(X,{value:(f.value||2).toString(),onValueChange:j=>f.onChange(Number(j)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.hysteria.version.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.hysteria.versions.map(j=>e.jsxs(U,{value:j,className:"cursor-pointer",children:["V",j]},j))})})]})})]})}),u.watch("version")==1&&e.jsx(b,{control:u.control,name:"alpn",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.hysteria.alpn.label")}),e.jsx(_,{children:e.jsxs(X,{value:f.value||"h2",onValueChange:f.onChange,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.hysteria.alpn.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.hysteria.alpnOptions.map(j=>e.jsx(U,{value:j,children:j},j))})})]})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"obfs.open",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.hysteria.obfs.label")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value||!1,onCheckedChange:f.onChange})})})]})}),!!u.watch("obfs.open")&&e.jsxs(e.Fragment,{children:[u.watch("version")=="2"&&e.jsx(b,{control:u.control,name:"obfs.type",render:({field:f})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:l("dynamic_form.hysteria.obfs.type.label")}),e.jsx(_,{children:e.jsxs(X,{value:f.value||"salamander",onValueChange:f.onChange,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.hysteria.obfs.type.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:e.jsx(U,{value:"salamander",children:l("dynamic_form.hysteria.obfs.type.salamander")})})})]})})]})}),e.jsx(b,{control:u.control,name:"obfs.password",render:({field:f})=>e.jsxs(v,{className:u.watch("version")==2?"w-full":"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.hysteria.obfs.password.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.hysteria.obfs.password.placeholder"),...f,value:f.value||"",className:"pr-9"})}),e.jsx(G,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",C=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(g=>j[g%j.length]).join("");u.setValue("obfs.password",C),$.success(l("dynamic_form.hysteria.obfs.password.generate_success"))},className:"absolute right-0 top-0 h-full px-2  active:scale-90 transition-transform duration-150",children:e.jsx(Re,{icon:"ion:refresh-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})]})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"tls.server_name",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.hysteria.tls.server_name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.hysteria.tls.server_name.placeholder"),...f,value:f.value||""})})]})}),e.jsx(b,{control:u.control,name:"tls.allow_insecure",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.hysteria.tls.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value||!1,onCheckedChange:f.onChange})})})]})})]}),e.jsx(b,{control:u.control,name:"bandwidth.up",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.hysteria.bandwidth.up.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:l("dynamic_form.hysteria.bandwidth.up.placeholder")+(u.watch("version")==2?l("dynamic_form.hysteria.bandwidth.up.bbr_tip"):""),className:"rounded-br-none rounded-tr-none",...f,value:f.value||""})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:l("dynamic_form.hysteria.bandwidth.up.suffix")})})]})]})}),e.jsx(b,{control:u.control,name:"bandwidth.down",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.hysteria.bandwidth.down.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:l("dynamic_form.hysteria.bandwidth.down.placeholder")+(u.watch("version")==2?l("dynamic_form.hysteria.bandwidth.down.bbr_tip"):""),className:"rounded-br-none rounded-tr-none",...f,value:f.value||""})}),e.jsx("div",{className:"pointer-events-none z-[-1] flex items-center rounded-md rounded-bl-none rounded-tl-none border border-l-0 border-input px-3 shadow-sm",children:e.jsx("span",{className:"text-gray-500",children:l("dynamic_form.hysteria.bandwidth.down.suffix")})})]})]})})]}),vless:()=>e.jsxs(e.Fragment,{children:[e.jsx(b,{control:u.control,name:"tls",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.tls.label")}),e.jsx(_,{children:e.jsxs(X,{value:f.value?.toString(),onValueChange:j=>f.onChange(Number(j)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.vless.tls.placeholder")})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:l("dynamic_form.vless.tls.none")}),e.jsx(U,{value:"1",children:l("dynamic_form.vless.tls.tls")}),e.jsx(U,{value:"2",children:l("dynamic_form.vless.tls.reality")})]})]})})]})}),u.watch("tls")=="1"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"tls_settings.server_name",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.vless.tls_settings.server_name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.tls_settings.server_name.placeholder"),...f})})]})}),e.jsx(b,{control:u.control,name:"tls_settings.allow_insecure",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.tls_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value,onCheckedChange:f.onChange})})})]})})]}),u.watch("tls")==2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:u.control,name:"reality_settings.server_name",render:({field:f})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.server_name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.reality_settings.server_name.placeholder"),...f})})]})}),e.jsx(b,{control:u.control,name:"reality_settings.server_port",render:({field:f})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.server_port.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dynamic_form.vless.reality_settings.server_port.placeholder"),...f})})]})}),e.jsx(b,{control:u.control,name:"reality_settings.allow_insecure",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.allow_insecure")}),e.jsx("div",{className:"py-2 text-center",children:e.jsx(_,{children:e.jsx(W,{checked:f.value,onCheckedChange:f.onChange})})})]})})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(b,{control:u.control,name:"reality_settings.private_key",render:({field:f})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.private_key.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{children:e.jsx(D,{...f,className:"pr-9"})}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(G,{type:"button",variant:"ghost",size:"icon",onClick:()=>{try{const j=ax();u.setValue("reality_settings.private_key",j.privateKey),u.setValue("reality_settings.public_key",j.publicKey),$.success(l("dynamic_form.vless.reality_settings.key_pair.success"))}catch{$.error(l("dynamic_form.vless.reality_settings.key_pair.error"))}},className:"absolute right-0 top-0 h-full px-2 active:scale-90 transition-transform duration-150",children:e.jsx(Re,{icon:"ion:key-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})}),e.jsx(Ft,{children:e.jsx(ce,{children:e.jsx("p",{children:l("dynamic_form.vless.reality_settings.key_pair.generate")})})})]})]})]})})}),e.jsx(b,{control:u.control,name:"reality_settings.public_key",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.public_key.label")}),e.jsx(_,{children:e.jsx(D,{...f})})]})}),e.jsx(b,{control:u.control,name:"reality_settings.short_id",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.reality_settings.short_id.label")}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{children:e.jsx(D,{...f,className:"pr-9",placeholder:l("dynamic_form.vless.reality_settings.short_id.placeholder")})}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(G,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const j=rx();u.setValue("reality_settings.short_id",j),$.success(l("dynamic_form.vless.reality_settings.short_id.success"))},className:"absolute right-0 top-0 h-full px-2 active:scale-90 transition-transform duration-150",children:e.jsx(Re,{icon:"ion:refresh-outline",className:"h-4 w-4 transition-transform hover:rotate-180 duration-300"})})}),e.jsx(Ft,{children:e.jsx(ce,{children:e.jsx("p",{children:l("dynamic_form.vless.reality_settings.short_id.generate")})})})]})]}),e.jsx(z,{className:"text-xs text-muted-foreground",children:l("dynamic_form.vless.reality_settings.short_id.description")})]})})]}),e.jsx(b,{control:u.control,name:"network",render:({field:f})=>e.jsxs(v,{children:[e.jsxs(y,{children:[l("dynamic_form.vless.network.label"),e.jsx(ua,{value:u.watch("network_settings"),setValue:j=>u.setValue("network_settings",j),templateType:u.watch("network")})]}),e.jsx(_,{children:e.jsxs(X,{onValueChange:f.onChange,value:f.value,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.vless.network.placeholder")})}),e.jsx(J,{children:e.jsx(Ds,{children:vs.vless.networkOptions.map(j=>e.jsx(U,{value:j.value,className:"cursor-pointer",children:j.label},j.value))})})]})})]})}),e.jsx(b,{control:u.control,name:"flow",render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dynamic_form.vless.flow.label")}),e.jsx(_,{children:e.jsxs(X,{onValueChange:j=>f.onChange(j==="none"?null:j),value:f.value||"none",children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dynamic_form.vless.flow.placeholder")})}),e.jsx(J,{children:vs.vless.flowOptions.map(j=>e.jsx(U,{value:j,children:j},j))})]})})]})})]})};return e.jsx(je,{children:P[s]?.()})},mx=h.object({id:h.number().optional().nullable(),code:h.string().optional(),name:h.string().min(1,"form.name.error"),rate:h.string().min(1,"form.rate.error"),tags:h.array(h.string()).default([]),excludes:h.array(h.string()).default([]),ips:h.array(h.string()).default([]),group_ids:h.array(h.string()).default([]),host:h.string().min(1,"form.host.error"),port:h.string().min(1,"form.port.error"),server_port:h.string().min(1,"form.server_port.error"),parent_id:h.string().default("0").nullable(),route_ids:h.array(h.string()).default([]),protocol_settings:h.record(h.any()).default({}).nullable()}),St={id:null,code:"",name:"",rate:"1",tags:[],excludes:[],ips:[],group_ids:[],host:"",port:"",server_port:"",parent_id:"0",route_ids:[],protocol_settings:null};function xx(){const{t:s}=F("server"),{isOpen:n,setIsOpen:a,editingServer:l,setEditingServer:r,serverType:c,setServerType:o,refetch:u}=Zr(),[x,i]=m.useState([]),[d,p]=m.useState([]),[w,P]=m.useState([]),f=fe({resolver:ye(mx),defaultValues:St,mode:"onChange"});m.useEffect(()=>{j()},[n]),m.useEffect(()=>{l?.type&&l.type!==c&&o(l.type)},[l,c,o]),m.useEffect(()=>{l?l.type===c&&f.reset({...St,...l}):f.reset({...St,protocol_settings:vs[c].schema.parse({})})},[l,f,c]);const j=async()=>{if(!n)return;const[E,O,q]=await Promise.all([yt(),Sr(),Cr()]);i(E.data?.map(te=>({label:te.name,value:te.id.toString()}))||[]),p(O.data?.map(te=>({label:te.remarks,value:te.id.toString()}))||[]),P(q.data||[])},C=m.useMemo(()=>w?.filter(E=>(E.parent_id===0||E.parent_id===null)&&E.type===c&&E.id!==f.watch("id")),[c,w,f]),g=()=>e.jsxs(ws,{children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("div",{children:s("form.add_node")})]})}),e.jsx(xs,{align:"start",children:e.jsx(Md,{children:Ms.map(({type:E,label:O})=>e.jsx(ge,{onClick:()=>{o(E),a(!0)},className:"cursor-pointer",children:e.jsx(K,{variant:"outline",className:"text-white",style:{background:Ns[E]},children:O})},E))})})]}),S=()=>{a(!1),r(null),f.reset(St)},R=async()=>{const E=f.getValues();(await kc({...E,type:c})).data&&(S(),$.success(s("form.success")),u())};return e.jsxs(ve,{open:n,onOpenChange:S,children:[g(),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:s(l?"form.edit_node":"form.new_node")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...f,children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{control:f.control,name:"name",render:({field:E})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:s("form.name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("form.name.placeholder"),...E})}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"rate",render:({field:E})=>e.jsxs(v,{className:"flex-[1]",children:[e.jsx(y,{children:s("form.rate.label")}),e.jsx("div",{className:"relative flex",children:e.jsx(_,{children:e.jsx(D,{type:"number",min:"0",step:"0.1",...E})})}),e.jsx(k,{})]})})]}),e.jsx(b,{control:f.control,name:"code",render:({field:E})=>e.jsxs(v,{children:[e.jsxs(y,{children:[s("form.code.label"),e.jsx("span",{className:"ml-1 text-xs text-muted-foreground",children:s("form.code.optional")})]}),e.jsx(_,{children:e.jsx(D,{placeholder:s("form.code.placeholder"),...E,value:E.value||""})}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"tags",render:({field:E})=>e.jsxs(v,{children:[e.jsx(y,{children:s("form.tags.label")}),e.jsx(_,{children:e.jsx(La,{value:E.value,onChange:E.onChange,placeholder:s("form.tags.placeholder"),className:"w-full"})}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"group_ids",render:({field:E})=>e.jsxs(v,{children:[e.jsxs(y,{className:"flex items-center justify-between",children:[s("form.groups.label"),e.jsx(aa,{dialogTrigger:e.jsx(T,{variant:"link",children:s("form.groups.add")}),refetch:j})]}),e.jsx(_,{children:e.jsx(ft,{options:x,onChange:O=>E.onChange(O.map(q=>q.value)),value:x?.filter(O=>E.value.includes(O.value)),placeholder:s("form.groups.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:s("form.groups.empty")})})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:f.control,name:"host",render:({field:E})=>e.jsxs(v,{children:[e.jsx(y,{children:s("form.host.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:s("form.host.placeholder"),...E})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{control:f.control,name:"port",render:({field:E})=>e.jsxs(v,{className:"flex-1",children:[e.jsxs(y,{className:"flex items-center gap-1.5",children:[s("form.port.label"),e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(Re,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(Ft,{children:e.jsx(ce,{side:"top",sideOffset:8,className:"max-w-80 p-3",children:e.jsx("p",{children:s("form.port.tooltip")})})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{children:e.jsx(D,{placeholder:s("form.port.placeholder"),...E})}),e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{type:"button",variant:"ghost",size:"icon",className:"size-6 shrink-0 text-muted-foreground/50 hover:text-muted-foreground",onClick:()=>{const O=E.value;O&&f.setValue("server_port",O)},children:e.jsx(Re,{icon:"tabler:arrows-right",className:"size-3"})})}),e.jsx(ce,{side:"right",children:e.jsx("p",{children:s("form.port.sync")})})]})})]}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"server_port",render:({field:E})=>e.jsxs(v,{className:"flex-1",children:[e.jsxs(y,{className:"flex items-center gap-1.5",children:[s("form.server_port.label"),e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(Re,{icon:"ph:info-light",className:"size-3.5 cursor-help text-muted-foreground"})}),e.jsx(Ft,{children:e.jsx(ce,{side:"top",sideOffset:8,className:"max-w-80 p-3",children:e.jsx("p",{children:s("form.server_port.tooltip")})})})]})})]}),e.jsx(_,{children:e.jsx(D,{placeholder:s("form.server_port.placeholder"),...E})}),e.jsx(k,{})]})})]})]}),n&&e.jsx(ux,{serverType:c,value:f.watch("protocol_settings"),onChange:E=>f.setValue("protocol_settings",E,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0})}),e.jsx(b,{control:f.control,name:"parent_id",render:({field:E})=>e.jsxs(v,{children:[e.jsx(y,{children:s("form.parent.label")}),e.jsxs(X,{onValueChange:E.onChange,value:E.value?.toString()||"0",children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:s("form.parent.placeholder")})})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:s("form.parent.none")}),C?.map(O=>e.jsx(U,{value:O.id.toString(),className:"cursor-pointer",children:O.name},O.id))]})]}),e.jsx(k,{})]})}),e.jsx(b,{control:f.control,name:"route_ids",render:({field:E})=>e.jsxs(v,{children:[e.jsx(y,{children:s("form.route.label")}),e.jsx(_,{children:e.jsx(ft,{options:d,onChange:O=>E.onChange(O.map(q=>q.value)),value:d?.filter(O=>E.value.includes(O.value)),placeholder:s("form.route.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:s("form.route.empty")})})}),e.jsx(k,{})]})})]}),e.jsxs(Me,{className:"mt-6",children:[e.jsx(T,{type:"button",variant:"outline",onClick:S,children:s("form.cancel")}),e.jsx(T,{type:"submit",onClick:R,children:s("form.submit")})]})]})]})]})}function un({column:s,title:n,options:a}){const l=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),n,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(c=>r.has(c.value)).map(c=>e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:c.label},c.value))})]})]})}),e.jsx(ds,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Vs,{children:[e.jsx(Hs,{placeholder:n}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:"No results found."}),e.jsx(Be,{children:a.map(c=>{const o=r.has(c.value);return e.jsxs(Ie,{onSelect:()=>{o?r.delete(c.value):r.add(c.value);const u=Array.from(r);s?.setFilterValue(u.length?u:void 0)},className:"cursor-pointer",children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(As,{className:N("h-4 w-4")})}),c.icon&&e.jsx(c.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${c.color}`}),e.jsx("span",{children:c.label}),l?.get(c.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(c.value)})]},c.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),e.jsx(Be,{children:e.jsx(Ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center cursor-pointer",children:"Clear filters"})})]})]})]})})]})}const hx=[{value:Te.Shadowsocks,label:Ms.find(s=>s.type===Te.Shadowsocks)?.label,color:Ns[Te.Shadowsocks]},{value:Te.Vmess,label:Ms.find(s=>s.type===Te.Vmess)?.label,color:Ns[Te.Vmess]},{value:Te.Trojan,label:Ms.find(s=>s.type===Te.Trojan)?.label,color:Ns[Te.Trojan]},{value:Te.Hysteria,label:Ms.find(s=>s.type===Te.Hysteria)?.label,color:Ns[Te.Hysteria]},{value:Te.Vless,label:Ms.find(s=>s.type===Te.Vless)?.label,color:Ns[Te.Vless]}];function px({table:s,saveOrder:n,isSortMode:a,groups:l}){const r=s.getState().columnFilters.length>0,{t:c}=F("server");return e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx(xx,{}),e.jsx(D,{placeholder:c("toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("type")&&e.jsx(un,{column:s.getColumn("type"),title:c("toolbar.type"),options:hx}),s.getColumn("group_ids")&&e.jsx(un,{column:s.getColumn("group_ids"),title:c("columns.groups.title"),options:l.map(o=>({label:o.name,value:o.id.toString()}))})]}),r&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[c("toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]}),a&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:c("toolbar.sort.tip")})})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:a?"default":"outline",onClick:n,size:"sm",children:c(a?"toolbar.sort.save":"toolbar.sort.edit")})})]})}const gt=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.71 12.71a6 6 0 1 0-7.42 0a10 10 0 0 0-6.22 8.18a1 1 0 0 0 2 .22a8 8 0 0 1 15.9 0a1 1 0 0 0 1 .89h.11a1 1 0 0 0 .88-1.1a10 10 0 0 0-6.25-8.19M12 12a4 4 0 1 1 4-4a4 4 0 0 1-4 4"})}),kt={0:"bg-destructive/80 shadow-sm shadow-destructive/50",1:"bg-yellow-500/80 shadow-sm shadow-yellow-500/50",2:"bg-emerald-500/80 shadow-sm shadow-emerald-500/50"},fx=s=>{const{t:n}=F("server");return[{id:"drag-handle",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.sort")}),cell:()=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Kt,{className:"size-4 cursor-move text-muted-foreground transition-colors hover:text-primary","aria-hidden":"true"})}),size:50},{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.nodeId")}),cell:({row:a})=>{const l=a.getValue("id"),r=a.original.code;return e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs("div",{className:"group/id flex items-center space-x-2",children:[e.jsxs(K,{variant:"outline",className:N("border-2 font-medium transition-all duration-200 hover:opacity-80","flex items-center gap-1.5"),style:{borderColor:Ns[a.original.type]},children:[e.jsx(ur,{className:"size-3"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"flex items-center gap-0.5",children:r??l}),a.original.parent?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted-foreground/30",children:"→"}),e.jsx("span",{children:a.original.parent?.code||a.original.parent?.id})]}):""]})]}),e.jsx(T,{variant:"ghost",size:"icon",className:"size-5 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:text-muted-foreground group-hover/id:opacity-100",onClick:c=>{c.stopPropagation(),zt(r||l.toString()).then(()=>{$.success(n("common:copy.success"))})},children:e.jsx(Za,{className:"size-3"})})]})}),e.jsxs(ce,{side:"top",className:"flex flex-col gap-1 p-3",children:[e.jsxs("p",{className:"font-medium",children:[Ms.find(c=>c.type===a.original.type)?.label,a.original.parent_id?" (子节点)":""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"点击括号内容或复制按钮可复制节点代码":"点击复制按钮可复制节点ID"})]})]})})},size:50,enableSorting:!0},{accessorKey:"show",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.show")}),cell:({row:a})=>{const[l,r]=m.useState(!!a.getValue("show"));return e.jsx(W,{checked:l,onCheckedChange:async c=>{r(c),Pc({id:a.original.id,type:a.original.type,show:c?1:0}).catch(()=>{r(!c),s()})},style:{backgroundColor:l?Ns[a.original.type]:void 0}})},size:50,enableSorting:!1},{accessorKey:"name",header:({column:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx(L,{column:a,title:n("columns.node"),tooltip:e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-2",children:[e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:N("h-2.5 w-2.5 rounded-full",kt[0])}),e.jsx("span",{className:"text-sm font-medium",children:n("columns.status.0")})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:N("h-2.5 w-2.5 rounded-full",kt[1])}),e.jsx("span",{className:"text-sm font-medium",children:n("columns.status.1")})]}),e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:N("h-2.5 w-2.5 rounded-full",kt[2])}),e.jsx("span",{className:"text-sm font-medium",children:n("columns.status.2")})]})]})})}),cell:({row:a})=>e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center space-x-2.5",children:[e.jsx("span",{className:N("size-2.5 flex-shrink-0 rounded-full transition-all duration-200",kt[a.original.available_status])}),e.jsx("span",{className:"text-left font-medium transition-colors hover:text-primary",children:a.getValue("name")})]})}),e.jsx(ce,{children:e.jsx("p",{className:"font-medium",children:n(`columns.status.${a.original.available_status}`)})})]})}),enableSorting:!1,size:200},{accessorKey:"host",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.address")}),cell:({row:a})=>{const l=`${a.original.host}:${a.original.port}`,r=a.original.port!==a.original.server_port;return e.jsxs("div",{className:"group relative flex min-w-0 items-start",children:[e.jsxs("div",{className:"flex min-w-0 flex-wrap items-baseline gap-x-1 gap-y-0.5 pr-7",children:[e.jsx("div",{className:"flex items-center ",children:e.jsxs("span",{className:"font-mono text-sm font-medium text-foreground/90",children:[a.original.host,":",a.original.port]})}),r&&e.jsxs("span",{className:"whitespace-nowrap text-[0.7rem] tracking-tight text-muted-foreground/40",children:["(",n("columns.internalPort")," ",a.original.server_port,")"]})]}),e.jsx("div",{className:"absolute right-0 top-0",children:e.jsx(je,{delayDuration:0,children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"icon",className:"size-6 text-muted-foreground/40 opacity-0 transition-all duration-200 hover:bg-muted/50 hover:text-muted-foreground group-hover:opacity-100",onClick:c=>{c.stopPropagation(),zt(l).then(()=>{$.success(n("common:copy.success"))})},children:e.jsx(Za,{className:"size-3"})})}),e.jsx(ce,{side:"top",sideOffset:10,children:n("columns.copyAddress")})]})})})]})},enableSorting:!1,enableHiding:!0},{accessorKey:"online",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.onlineUsers.title"),tooltip:n("columns.onlineUsers.tooltip")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(gt,{className:"size-4"}),e.jsx("span",{className:"font-medium",children:a.getValue("online")})]}),size:80,enableSorting:!0,enableHiding:!0},{accessorKey:"rate",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.rate.title"),tooltip:n("columns.rate.tooltip")}),cell:({row:a})=>e.jsxs(K,{variant:"secondary",className:"font-medium",children:[a.getValue("rate")," x"]}),size:80,enableSorting:!1,enableHiding:!0},{accessorKey:"group_ids",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.groups.title"),tooltip:n("columns.groups.tooltip")}),cell:({row:a})=>{const l=a.original.groups||[];return e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[l.map((r,c)=>e.jsx(K,{variant:"secondary",className:N("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:r.name},c)),l.length===0&&e.jsx("span",{className:"text-sm text-muted-foreground",children:n("columns.groups.empty")})]})},enableSorting:!1,filterFn:(a,l,r)=>{const c=a.getValue(l);return c?r.some(o=>c.includes(o)):!1}},{accessorKey:"type",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.type")}),cell:({row:a})=>{const l=a.getValue("type");return e.jsx(K,{variant:"outline",className:"border-2 font-medium transition-colors",style:{borderColor:Ns[l]},children:l})},enableSorting:!1,enableHiding:!0,enableColumnFilter:!1,size:8e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("columns.actions")}),cell:({row:a})=>{const{setIsOpen:l,setEditingServer:r,setServerType:c}=Zr();return e.jsx("div",{className:"flex justify-center",children:e.jsxs(ws,{modal:!1,children:[e.jsx(Cs,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":n("columns.actions"),children:e.jsx(Ot,{className:"size-4"})})}),e.jsxs(xs,{align:"end",className:"w-40",children:[e.jsx(ge,{className:"cursor-pointer",onClick:()=>{c(a.original.type),r(a.original),l(!0)},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(Lo,{className:"mr-2 size-4"}),n("columns.actions_dropdown.edit")]})}),e.jsxs(ge,{className:"cursor-pointer",onClick:async()=>{Dc({id:a.original.id}).then(({data:o})=>{o&&($.success(n("columns.actions_dropdown.copy_success")),s())})},children:[e.jsx(Ao,{className:"mr-2 size-4"}),n("columns.actions_dropdown.copy")]}),e.jsx(et,{}),e.jsx(ge,{className:"cursor-pointer text-destructive focus:text-destructive",onSelect:o=>o.preventDefault(),children:e.jsx(Ge,{title:n("columns.actions_dropdown.delete.title"),description:n("columns.actions_dropdown.delete.description"),confirmText:n("columns.actions_dropdown.delete.confirm"),variant:"destructive",onConfirm:async()=>{Tc({id:a.original.id}).then(({data:o})=>{o&&($.success(n("columns.actions_dropdown.delete_success")),s())})},children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(ls,{className:"mr-2 size-4"}),n("columns.actions_dropdown.delete.confirm")]})})})]})]})})},size:50}]};function gx(){const[s,n]=m.useState({}),[a,l]=m.useState({"drag-handle":!1}),[r,c]=m.useState([]),[o,u]=m.useState({pageSize:500,pageIndex:0}),[x,i]=m.useState([]),[d,p]=m.useState(!1),[w,P]=m.useState({}),[f,j]=m.useState([]),{refetch:C}=ie({queryKey:["nodeList"],queryFn:async()=>{const{data:q}=await Cr();return j(q),q}}),{data:g}=ie({queryKey:["groups"],queryFn:async()=>{const{data:q}=await yt();return q}});m.useEffect(()=>{l({"drag-handle":d,show:!d,host:!d,online:!d,rate:!d,groups:!d,type:!1,actions:!d}),P({name:d?2e3:200}),u({pageSize:d?99999:500,pageIndex:0})},[d]);const S=(q,te)=>{d&&(q.dataTransfer.setData("text/plain",te.toString()),q.currentTarget.classList.add("opacity-50"))},R=(q,te)=>{if(!d)return;q.preventDefault(),q.currentTarget.classList.remove("bg-muted");const M=parseInt(q.dataTransfer.getData("text/plain"));if(M===te)return;const se=[...f],[qe]=se.splice(M,1);se.splice(te,0,qe),j(se)},E=async()=>{if(!d){p(!0);return}const q=f?.map((te,M)=>({id:te.id,order:M+1}));Ec(q).then(()=>{$.success("排序保存成功"),p(!1),C()}).finally(()=>{p(!1)})},O=ss({data:f||[],columns:fx(C),state:{sorting:x,columnVisibility:a,rowSelection:s,columnFilters:r,columnSizing:w,pagination:o},enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:i,onColumnFiltersChange:c,onColumnVisibilityChange:l,onColumnSizingChange:P,onPaginationChange:u,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(Xm,{refetch:C,children:e.jsx("div",{className:"space-y-4",children:e.jsx(us,{table:O,toolbar:q=>e.jsx(px,{table:q,refetch:C,saveOrder:E,isSortMode:d,groups:g||[]}),draggable:d,onDragStart:S,onDragEnd:q=>q.currentTarget.classList.remove("opacity-50"),onDragOver:q=>{q.preventDefault(),q.currentTarget.classList.add("bg-muted")},onDragLeave:q=>q.currentTarget.classList.remove("bg-muted"),onDrop:R,showPagination:!d})})})}function jx(){const{t:s}=F("server");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("manage.title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("manage.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(gx,{})})]})]})}const vx=Object.freeze(Object.defineProperty({__proto__:null,default:jx},Symbol.toStringTag,{value:"Module"}));function bx({table:s,refetch:n}){const a=s.getState().columnFilters.length>0,{t:l}=F("group");return e.jsx("div",{className:"flex items-center justify-between space-x-4",children:e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(aa,{refetch:n}),e.jsx(D,{placeholder:l("toolbar.searchPlaceholder"),value:s.getColumn("name")?.getFilterValue()??"",onChange:r=>s.getColumn("name")?.setFilterValue(r.target.value),className:N("h-8  w-[150px] lg:w-[250px]",a&&"border-primary/50 ring-primary/20")}),a&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]})})}const yx=s=>{const{t:n}=F("group");return[{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.id")}),cell:({row:a})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(K,{variant:"outline",children:a.getValue("id")})}),enableSorting:!0},{accessorKey:"name",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.name")}),cell:({row:a})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium",children:a.getValue("name")})})},{accessorKey:"users_count",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.usersCount")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:a.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"server_count",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.serverCount")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 px-4",children:[e.jsx(ur,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:a.getValue("server_count")})]}),enableSorting:!0,size:8e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("columns.actions")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(aa,{defaultValues:a.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:n("form.edit")})]})}),e.jsx(Ge,{title:n("messages.deleteConfirm"),description:n("messages.deleteDescription"),confirmText:n("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{Ic({id:a.original.id}).then(({data:l})=>{l&&($.success(n("messages.updateSuccess")),s())})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:n("messages.deleteButton")})]})})]})}]};function Nx(){const[s,n]=m.useState({}),[a,l]=m.useState({}),[r,c]=m.useState([]),[o,u]=m.useState([]),{data:x,refetch:i,isLoading:d}=ie({queryKey:["serverGroupList"],queryFn:async()=>{const{data:w}=await yt();return w}}),p=ss({data:x||[],columns:yx(i),state:{sorting:o,columnVisibility:a,rowSelection:s,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:l,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(us,{table:p,toolbar:w=>e.jsx(bx,{table:w,refetch:i}),isLoading:d})}function _x(){const{t:s}=F("group");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Nx,{})})]})]})}const wx=Object.freeze(Object.defineProperty({__proto__:null,default:_x},Symbol.toStringTag,{value:"Module"})),Cx=s=>h.object({remarks:h.string().min(1,s("form.validation.remarks")),match:h.array(h.string()),action:h.enum(["block","dns"]),action_value:h.string().optional()});function Xr({refetch:s,dialogTrigger:n,defaultValues:a={remarks:"",match:[],action:"block",action_value:""},type:l="add"}){const{t:r}=F("route"),c=fe({resolver:ye(Cx(r)),defaultValues:a,mode:"onChange"}),[o,u]=m.useState(!1);return e.jsxs(ve,{open:o,onOpenChange:u,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"space-x-2",children:[e.jsx(Re,{icon:"ion:add"})," ",e.jsx("div",{children:r("form.add")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:r(l==="edit"?"form.edit":"form.create")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...c,children:[e.jsx(b,{control:c.control,name:"remarks",render:({field:x})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:r("form.remarks")}),e.jsx("div",{className:"relative",children:e.jsx(_,{children:e.jsx(D,{type:"text",placeholder:r("form.remarksPlaceholder"),...x})})}),e.jsx(k,{})]})}),e.jsx(b,{control:c.control,name:"match",render:({field:x})=>e.jsxs(v,{className:"flex-[2]",children:[e.jsx(y,{children:r("form.match")}),e.jsx("div",{className:"relative",children:e.jsx(_,{children:e.jsx(js,{className:"min-h-[120px]",placeholder:r("form.matchPlaceholder"),value:x.value.join(`
`),onChange:i=>{x.onChange(i.target.value.split(`
`))}})})}),e.jsx(k,{})]})}),e.jsx(b,{control:c.control,name:"action",render:({field:x})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.action")}),e.jsx("div",{className:"relative",children:e.jsx(_,{children:e.jsxs(X,{onValueChange:x.onChange,defaultValue:x.value,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:r("form.actionPlaceholder")})}),e.jsxs(J,{children:[e.jsx(U,{value:"block",children:r("actions.block")}),e.jsx(U,{value:"dns",children:r("actions.dns")})]})]})})}),e.jsx(k,{})]})}),c.watch("action")==="dns"&&e.jsx(b,{control:c.control,name:"action_value",render:({field:x})=>e.jsxs(v,{children:[e.jsx(y,{children:r("form.dns")}),e.jsx("div",{className:"relative",children:e.jsx(_,{children:e.jsx(D,{type:"text",placeholder:r("form.dnsPlaceholder"),...x})})})]})}),e.jsxs(Me,{children:[e.jsx(Nt,{asChild:!0,children:e.jsx(T,{variant:"outline",children:r("form.cancel")})}),e.jsx(T,{type:"submit",onClick:()=>{Vc(c.getValues()).then(({data:x})=>{x&&(u(!1),s&&s(),toast.success(r(l==="edit"?"messages.updateSuccess":"messages.createSuccess")),c.reset())})},children:r("form.submit")})]})]})]})]})}function Sx({table:s,refetch:n}){const a=s.getState().columnFilters.length>0,{t:l}=F("route");return e.jsx("div",{className:"flex items-center justify-between ",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Xr,{refetch:n}),e.jsx(D,{placeholder:l("toolbar.searchPlaceholder"),value:s.getColumn("remarks")?.getFilterValue()??"",onChange:r=>s.getColumn("remarks")?.setFilterValue(r.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),a&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]})})}function kx({columns:s,data:n,refetch:a}){const[l,r]=m.useState({}),[c,o]=m.useState({}),[u,x]=m.useState([]),[i,d]=m.useState([]),p=ss({data:n,columns:s,state:{sorting:i,columnVisibility:c,rowSelection:l,columnFilters:u},enableRowSelection:!0,onRowSelectionChange:r,onSortingChange:d,onColumnFiltersChange:x,onColumnVisibilityChange:o,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(us,{table:p,toolbar:w=>e.jsx(Sx,{table:w,refetch:a})})}const Tx=s=>{const{t:n}=F("route"),a={block:{icon:$o,variant:"destructive",className:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-800"},dns:{icon:qo,variant:"secondary",className:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800"}};return[{accessorKey:"id",header:({column:l})=>e.jsx(L,{column:l,title:n("columns.id")}),cell:({row:l})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(K,{variant:"outline",children:l.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"remarks",header:({column:l})=>e.jsx(L,{column:l,title:n("columns.remarks")}),cell:({row:l})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:l.original.remarks})}),enableHiding:!1,enableSorting:!1},{accessorKey:"action_value",header:({column:l})=>e.jsx(L,{column:l,title:n("columns.action_value.title")}),cell:({row:l})=>{const r=l.original.action,c=l.original.action_value,o=l.original.match?.length||0;return e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",children:r==="dns"&&c?n("columns.action_value.dns",{value:c}):r==="block"?e.jsx("span",{className:"text-destructive",children:n("columns.action_value.block")}):n("columns.action_value.direct")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n("columns.matchRules",{count:o})})]})},enableHiding:!1,enableSorting:!1,size:300},{accessorKey:"action",header:({column:l})=>e.jsx(L,{column:l,title:n("columns.action")}),cell:({row:l})=>{const r=l.getValue("action"),c=a[r]?.icon;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(K,{variant:a[r]?.variant||"default",className:N("flex items-center gap-1.5 px-3 py-1 capitalize",a[r]?.className),children:[c&&e.jsx(c,{className:"h-3.5 w-3.5"}),n(`actions.${r}`)]})})},enableSorting:!1,size:9e3},{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:n("columns.actions")}),cell:({row:l})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Xr,{defaultValues:l.original,refetch:s,type:"edit",dialogTrigger:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:n("form.edit")})]})}),e.jsx(Ge,{title:n("messages.deleteConfirm"),description:n("messages.deleteDescription"),confirmText:n("messages.deleteButton"),variant:"destructive",onConfirm:async()=>{Fc({id:l.original.id}).then(({data:r})=>{r&&($.success(n("messages.deleteSuccess")),s())})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:n("messages.deleteButton")})]})})]})}]};function Dx(){const{t:s}=F("route"),[n,a]=m.useState([]);function l(){Sr().then(({data:r})=>{a(r)})}return m.useEffect(()=>{l()},[]),e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(kx,{data:n,columns:Tx(l),refetch:l})})]})]})}const Px=Object.freeze(Object.defineProperty({__proto__:null,default:Dx},Symbol.toStringTag,{value:"Module"})),el=m.createContext(void 0);function Ex({children:s,refreshData:n}){const[a,l]=m.useState(!1),[r,c]=m.useState(null);return e.jsx(el.Provider,{value:{isOpen:a,setIsOpen:l,editingPlan:r,setEditingPlan:c,refreshData:n},children:s})}function Aa(){const s=m.useContext(el);if(s===void 0)throw new Error("usePlanEdit must be used within a PlanEditProvider");return s}function Rx({table:s,saveOrder:n,isSortMode:a}){const{setIsOpen:l}=Aa(),{t:r}=F("subscribe");return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsxs(T,{variant:"outline",className:"space-x-2",size:"sm",onClick:()=>l(!0),children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("div",{children:r("plan.add")})]}),e.jsx(D,{placeholder:r("plan.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:c=>s.getColumn("name")?.setFilterValue(c.target.value),className:"h-8 w-[150px] lg:w-[250px]"})]}),s.getRowCount()>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{variant:a?"default":"outline",onClick:n,size:"sm",children:r(a?"plan.sort.save":"plan.sort.edit")})})]})}const mn={monthly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},quarterly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},half_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},two_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},three_yearly:{color:"text-slate-700",bgColor:"bg-slate-100/80"},onetime:{color:"text-slate-700",bgColor:"bg-slate-100/80"},reset_traffic:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},Ix=s=>{const{t:n}=F("subscribe");return[{id:"drag-handle",header:()=>null,cell:()=>e.jsx("div",{className:"cursor-move",children:e.jsx(Kt,{className:"size-4"})}),size:40,enableSorting:!1},{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.id")}),cell:({row:a})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(K,{variant:"outline",children:a.getValue("id")})}),enableSorting:!0,enableHiding:!1},{accessorKey:"show",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.show")}),cell:({row:a})=>e.jsx(W,{defaultChecked:a.getValue("show"),onCheckedChange:l=>{na({id:a.original.id,show:l}).then(({data:r})=>{!r&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"sell",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.sell")}),cell:({row:a})=>e.jsx(W,{defaultChecked:a.getValue("sell"),onCheckedChange:l=>{na({id:a.original.id,sell:l}).then(({data:r})=>{!r&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"renew",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.renew"),tooltip:n("plan.columns.renew_tooltip")}),cell:({row:a})=>e.jsx(W,{defaultChecked:a.getValue("renew"),onCheckedChange:l=>{na({id:a.original.id,renew:l}).then(({data:r})=>{!r&&s()})}}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.name")}),cell:({row:a})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:a.getValue("name")})}),enableSorting:!1,enableHiding:!1,size:900},{accessorKey:"users_count",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.stats")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 px-2",children:[e.jsx(gt,{}),e.jsx("span",{className:"max-w-32 truncate font-medium sm:max-w-72 md:max-w-[31rem]",children:a.getValue("users_count")})]}),enableSorting:!0},{accessorKey:"group",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.group")}),cell:({row:a})=>e.jsx("div",{className:"flex max-w-[600px] flex-wrap items-center gap-1.5 text-nowrap",children:e.jsx(K,{variant:"secondary",className:N("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5"),children:a.getValue("group")?.name})}),enableSorting:!1,enableHiding:!1},{accessorKey:"prices",header:({column:a})=>e.jsx(L,{column:a,title:n("plan.columns.price")}),cell:({row:a})=>{const l=a.getValue("prices"),r=[{period:n("plan.columns.price_period.monthly"),key:"monthly",unit:n("plan.columns.price_period.unit.month")},{period:n("plan.columns.price_period.quarterly"),key:"quarterly",unit:n("plan.columns.price_period.unit.quarter")},{period:n("plan.columns.price_period.half_yearly"),key:"half_yearly",unit:n("plan.columns.price_period.unit.half_year")},{period:n("plan.columns.price_period.yearly"),key:"yearly",unit:n("plan.columns.price_period.unit.year")},{period:n("plan.columns.price_period.two_yearly"),key:"two_yearly",unit:n("plan.columns.price_period.unit.two_year")},{period:n("plan.columns.price_period.three_yearly"),key:"three_yearly",unit:n("plan.columns.price_period.unit.three_year")},{period:n("plan.columns.price_period.onetime"),key:"onetime",unit:""},{period:n("plan.columns.price_period.reset_traffic"),key:"reset_traffic",unit:n("plan.columns.price_period.unit.times")}];return e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:r.map(({period:c,key:o,unit:u})=>l[o]!=null&&e.jsxs(K,{variant:"secondary",className:N("px-2 py-0.5 font-medium transition-colors text-nowrap",mn[o].color,mn[o].bgColor,"border border-border/50","hover:bg-slate-200/80"),children:[c," ¥",l[o],u]},o))})},enableSorting:!1,size:9e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("plan.columns.actions")}),cell:({row:a})=>{const{setIsOpen:l,setEditingPlan:r}=Aa();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>{r(a.original),l(!0)},children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:n("plan.columns.edit")})]}),e.jsx(Ge,{title:n("plan.columns.delete_confirm.title"),description:n("plan.columns.delete_confirm.description"),confirmText:n("plan.columns.delete"),variant:"destructive",onConfirm:async()=>{Xc({id:a.original.id}).then(({data:c})=>{c&&($.success(n("plan.columns.delete_confirm.success")),s())})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:n("plan.columns.delete")})]})})]})}}]},Vx=h.object({id:h.number().nullable(),group_id:h.union([h.number(),h.string()]).nullable().optional(),name:h.string().min(1).max(250),content:h.string().nullable().optional(),transfer_enable:h.union([h.number().min(0),h.string().min(1)]),prices:h.object({monthly:h.union([h.number(),h.string()]).nullable().optional(),quarterly:h.union([h.number(),h.string()]).nullable().optional(),half_yearly:h.union([h.number(),h.string()]).nullable().optional(),yearly:h.union([h.number(),h.string()]).nullable().optional(),two_yearly:h.union([h.number(),h.string()]).nullable().optional(),three_yearly:h.union([h.number(),h.string()]).nullable().optional(),onetime:h.union([h.number(),h.string()]).nullable().optional(),reset_traffic:h.union([h.number(),h.string()]).nullable().optional()}).default({}),speed_limit:h.union([h.number(),h.string()]).nullable().optional(),capacity_limit:h.union([h.number(),h.string()]).nullable().optional(),device_limit:h.union([h.number(),h.string()]).nullable().optional(),force_update:h.boolean().optional(),reset_traffic_method:h.number().nullable(),users_count:h.number().optional()}),sl=m.forwardRef(({className:s,...n},a)=>e.jsx(mr,{ref:a,className:N("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(Uo,{className:N("flex items-center justify-center text-current"),children:e.jsx(As,{className:"h-4 w-4"})})}));sl.displayName=mr.displayName;const Tt={id:null,group_id:null,name:"",content:"",transfer_enable:"",prices:{monthly:"",quarterly:"",half_yearly:"",yearly:"",two_yearly:"",three_yearly:"",onetime:"",reset_traffic:""},speed_limit:"",capacity_limit:"",device_limit:"",force_update:!1,reset_traffic_method:null},Dt={monthly:{label:"月付",months:1,discount:1},quarterly:{label:"季付",months:3,discount:.95},half_yearly:{label:"半年付",months:6,discount:.9},yearly:{label:"年付",months:12,discount:.85},two_yearly:{label:"两年付",months:24,discount:.8},three_yearly:{label:"三年付",months:36,discount:.75},onetime:{label:"流量包",months:1,discount:1},reset_traffic:{label:"重置包",months:1,discount:1}},Fx=[{value:null,label:"follow_system"},{value:0,label:"monthly_first"},{value:1,label:"monthly_reset"},{value:2,label:"no_reset"},{value:3,label:"yearly_first"},{value:4,label:"yearly_reset"}];function Ox(){const{isOpen:s,setIsOpen:n,editingPlan:a,setEditingPlan:l,refreshData:r}=Aa(),[c,o]=m.useState(!1),{t:u}=F("subscribe"),x=fe({resolver:ye(Vx),defaultValues:{...Tt,...a||{}},mode:"onChange"});m.useEffect(()=>{a?x.reset({...Tt,...a}):x.reset(Tt)},[a,x]);const i=new Ea({html:!0}),[d,p]=m.useState();async function w(){yt().then(({data:j})=>{p(j)})}m.useEffect(()=>{s&&w()},[s]);const P=j=>{if(isNaN(j))return;const C=Object.entries(Dt).reduce((g,[S,R])=>{const E=j*R.months*R.discount;return{...g,[S]:E.toFixed(2)}},{});x.setValue("prices",C,{shouldDirty:!0})},f=()=>{n(!1),l(null),x.reset(Tt)};return e.jsx(ve,{open:s,onOpenChange:f,children:e.jsxs(pe,{children:[e.jsxs(we,{children:[e.jsx(be,{children:u(a?"plan.form.edit_title":"plan.form.add_title")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...x,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:x.control,name:"name",render:({field:j})=>e.jsxs(v,{children:[e.jsx(y,{children:u("plan.form.name.label")}),e.jsx(_,{children:e.jsx(D,{placeholder:u("plan.form.name.placeholder"),...j})}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"group_id",render:({field:j})=>e.jsxs(v,{children:[e.jsxs(y,{className:"flex items-center justify-between",children:[u("plan.form.group.label"),e.jsx(aa,{dialogTrigger:e.jsx(T,{variant:"link",children:u("plan.form.group.add")}),refetch:w})]}),e.jsxs(X,{value:j.value?.toString()??"",onValueChange:C=>j.onChange(C?Number(C):null),children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:u("plan.form.group.placeholder")})})}),e.jsx(J,{children:d?.map(C=>e.jsx(U,{value:C.id.toString(),children:C.name},C.id))})]}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"transfer_enable",render:({field:j})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:u("plan.form.transfer.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",min:0,placeholder:u("plan.form.transfer.placeholder"),className:"rounded-r-none",...j})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:u("plan.form.transfer.unit")})]}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"speed_limit",render:({field:j})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:u("plan.form.speed.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",min:0,placeholder:u("plan.form.speed.placeholder"),className:"rounded-r-none",...j,value:j.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:u("plan.form.speed.unit")})]}),e.jsx(k,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"}),e.jsx("h3",{className:"mx-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:u("plan.form.price.title")}),e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(D,{type:"number",placeholder:u("plan.form.price.base_price"),className:"h-7 w-32 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500",onChange:j=>{const C=parseFloat(j.target.value);P(C)}})]}),e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>{const j=Object.keys(Dt).reduce((C,g)=>({...C,[g]:""}),{});x.setValue("prices",j,{shouldDirty:!0})},children:u("plan.form.price.clear.button")})}),e.jsx(ce,{side:"top",align:"end",children:e.jsx("p",{className:"text-xs",children:u("plan.form.price.clear.tooltip")})})]})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-3",children:Object.entries(Dt).filter(([j])=>!["onetime","reset_traffic"].includes(j)).map(([j,C])=>e.jsx("div",{className:"group relative rounded-md bg-card p-2 ring-1 ring-gray-200 transition-all hover:ring-primary dark:ring-gray-800",children:e.jsx(b,{control:x.control,name:`prices.${j}`,render:({field:g})=>e.jsxs(v,{children:[e.jsxs(y,{className:"text-xs font-medium text-muted-foreground",children:[u(`plan.columns.price_period.${j}`),e.jsxs("span",{className:"ml-1 text-[10px] text-gray-400",children:["(",C.months===1?u("plan.form.price.period.monthly"):u("plan.form.price.period.months",{count:C.months}),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:"0.00",min:0,...g,value:g.value??"",onChange:S=>g.onChange(S.target.value),className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})},j))}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Object.entries(Dt).filter(([j])=>["onetime","reset_traffic"].includes(j)).map(([j,C])=>e.jsx("div",{className:"rounded-md border border-dashed border-gray-200 bg-muted/30 p-3 dark:border-gray-700",children:e.jsx(b,{control:x.control,name:`prices.${j}`,render:({field:g})=>e.jsx(v,{children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsx(y,{className:"text-xs font-medium",children:u(`plan.columns.price_period.${j}`)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:u(j==="onetime"?"plan.form.price.onetime_desc":"plan.form.price.reset_desc")})]}),e.jsxs("div",{className:"relative w-full md:w-32",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2",children:e.jsx("span",{className:"text-sm font-medium text-gray-400",children:"¥"})}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:"0.00",min:0,...g,className:"h-7 border-0 bg-gray-50 pl-6 pr-2 text-sm shadow-none ring-1 ring-gray-200 transition-shadow focus-visible:ring-2 focus-visible:ring-primary dark:bg-gray-800/50 dark:ring-gray-700 dark:placeholder:text-gray-500"})})]})]})})})},j))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(b,{control:x.control,name:"device_limit",render:({field:j})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:u("plan.form.device.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",min:0,placeholder:u("plan.form.device.placeholder"),className:"rounded-r-none",...j,value:j.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:u("plan.form.device.unit")})]}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"capacity_limit",render:({field:j})=>e.jsxs(v,{className:"flex-1",children:[e.jsx(y,{children:u("plan.form.capacity.label")}),e.jsxs("div",{className:"relative flex",children:[e.jsx(_,{children:e.jsx(D,{type:"number",min:0,placeholder:u("plan.form.capacity.placeholder"),className:"rounded-r-none",...j,value:j.value??""})}),e.jsx("div",{className:"flex items-center rounded-r-md border border-l-0 border-input bg-muted px-3 text-sm text-muted-foreground",children:u("plan.form.capacity.unit")})]}),e.jsx(k,{})]})})]}),e.jsx(b,{control:x.control,name:"reset_traffic_method",render:({field:j})=>e.jsxs(v,{children:[e.jsx(y,{children:u("plan.form.reset_method.label")}),e.jsxs(X,{value:j.value?.toString()??"null",onValueChange:C=>j.onChange(C=="null"?null:Number(C)),children:[e.jsx(_,{children:e.jsx(Q,{children:e.jsx(ee,{placeholder:u("plan.form.reset_method.placeholder")})})}),e.jsx(J,{children:Fx.map(C=>e.jsx(U,{value:C.value?.toString()??"null",children:u(`plan.form.reset_method.options.${C.label}`)},C.value))})]}),e.jsx(z,{className:"text-xs",children:u("plan.form.reset_method.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:x.control,name:"content",render:({field:j})=>{const[C,g]=m.useState(!1);return e.jsxs(v,{className:"space-y-2",children:[e.jsxs(y,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u("plan.form.content.label"),e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>g(!C),children:C?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{d:"M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"}),e.jsx("path",{fillRule:"evenodd",d:"M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.28 2.22a.75.75 0 00-1.06 1.06l14.5 14.5a.75.75 0 101.06-1.06l-1.745-1.745a10.029 10.029 0 003.3-4.38 1.651 1.651 0 000-1.185A10.004 10.004 0 009.999 3a9.956 9.956 0 00-4.744 1.194L3.28 2.22zM7.752 6.69l1.092 1.092a2.5 2.5 0 013.374 3.373l1.091 1.092a4 4 0 00-5.557-5.557z",clipRule:"evenodd"}),e.jsx("path",{d:"M10.748 13.93l2.523 2.523a9.987 9.987 0 01-3.27.547c-4.258 0-7.894-2.66-9.337-6.41a1.651 1.651 0 010-1.186A10.007 10.007 0 012.839 6.02L6.07 9.252a4 4 0 004.678 4.678z"})]})})}),e.jsx(ce,{side:"top",children:e.jsx("p",{className:"text-xs",children:u(C?"plan.form.content.preview_button.hide":"plan.form.content.preview_button.show")})})]})})]}),e.jsx(je,{children:e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{j.onChange(u("plan.form.content.template.content"))},children:u("plan.form.content.template.button")})}),e.jsx(ce,{side:"left",align:"center",children:e.jsx("p",{className:"text-xs",children:u("plan.form.content.template.tooltip")})})]})})]}),e.jsxs("div",{className:`grid gap-4 ${C?"grid-cols-1 lg:grid-cols-2":"grid-cols-1"}`,children:[e.jsx("div",{className:"space-y-2",children:e.jsx(_,{children:e.jsx(Ra,{style:{height:"400px"},value:j.value||"",renderHTML:S=>i.render(S),onChange:({text:S})=>j.onChange(S),config:{view:{menu:!0,md:!0,html:!1},canView:{menu:!0,md:!0,html:!1,fullScreen:!1,hideMenu:!1}},placeholder:u("plan.form.content.placeholder"),className:"rounded-md border"})})}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:u("plan.form.content.preview")}),e.jsx("div",{className:"prose prose-sm dark:prose-invert h-[400px] max-w-none overflow-y-auto rounded-md border p-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:i.render(j.value||"")}})})]})]}),e.jsx(z,{className:"text-xs",children:u("plan.form.content.description")}),e.jsx(k,{})]})}})]}),e.jsx(Me,{className:"mt-6",children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:a&&e.jsx(b,{control:x.control,name:"force_update",render:({field:j})=>e.jsxs(v,{className:"flex flex-row items-center space-x-2 space-y-0",children:[e.jsx(_,{children:e.jsx(sl,{checked:j.value,onCheckedChange:j.onChange})}),e.jsx("div",{className:"",children:e.jsx(y,{className:"text-sm",children:u("plan.form.force_update.label")})})]})})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:f,children:u("plan.form.submit.cancel")}),e.jsx(T,{type:"submit",disabled:c,onClick:()=>{x.handleSubmit(async j=>{o(!0),(await Zc(j)).data&&($.success(u(a?"plan.form.submit.success.update":"plan.form.submit.success.add")),f(),r()),o(!1)})()},children:u(c?"plan.form.submit.submitting":"plan.form.submit.submit")})]})]})})]})]})})}function Mx(){const[s,n]=m.useState({}),[a,l]=m.useState({"drag-handle":!1}),[r,c]=m.useState([]),[o,u]=m.useState([]),[x,i]=m.useState(!1),[d,p]=m.useState({pageSize:20,pageIndex:0}),[w,P]=m.useState([]),{refetch:f}=ie({queryKey:["planList"],queryFn:async()=>{const{data:R}=await Us();return P(R),R}});m.useEffect(()=>{l({"drag-handle":x}),p({pageSize:x?99999:10,pageIndex:0})},[x]);const j=(R,E)=>{x&&(R.dataTransfer.setData("text/plain",E.toString()),R.currentTarget.classList.add("opacity-50"))},C=(R,E)=>{if(!x)return;R.preventDefault(),R.currentTarget.classList.remove("bg-muted");const O=parseInt(R.dataTransfer.getData("text/plain"));if(O===E)return;const q=[...w],[te]=q.splice(O,1);q.splice(E,0,te),P(q)},g=async()=>{if(!x){i(!0);return}const R=w?.map(E=>E.id);ed(R).then(()=>{$.success("排序保存成功"),i(!1),f()}).finally(()=>{i(!1)})},S=ss({data:w||[],columns:Ix(f),state:{sorting:o,columnVisibility:a,rowSelection:s,columnFilters:r,pagination:d},enableRowSelection:!0,onPaginationChange:p,onRowSelectionChange:n,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:l,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}},pageCount:x?1:void 0});return e.jsx(Ex,{refreshData:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(us,{table:S,toolbar:R=>e.jsx(Rx,{table:R,refetch:f,saveOrder:g,isSortMode:x}),draggable:x,onDragStart:j,onDragEnd:R=>R.currentTarget.classList.remove("opacity-50"),onDragOver:R=>{R.preventDefault(),R.currentTarget.classList.add("bg-muted")},onDragLeave:R=>R.currentTarget.classList.remove("bg-muted"),onDrop:C,showPagination:!x}),e.jsx(Ox,{})]})})}function zx(){const{t:s}=F("subscribe");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("plan.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("plan.page.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Mx,{})})]})]})}const Lx=Object.freeze(Object.defineProperty({__proto__:null,default:zx},Symbol.toStringTag,{value:"Module"})),Ys=[{value:re.PENDING,label:it[re.PENDING],icon:Ho,color:ot[re.PENDING]},{value:re.PROCESSING,label:it[re.PROCESSING],icon:xr,color:ot[re.PROCESSING]},{value:re.COMPLETED,label:it[re.COMPLETED],icon:va,color:ot[re.COMPLETED]},{value:re.CANCELLED,label:it[re.CANCELLED],icon:hr,color:ot[re.CANCELLED]},{value:re.DISCOUNTED,label:it[re.DISCOUNTED],icon:va,color:ot[re.DISCOUNTED]}],dt=[{value:me.PENDING,label:wt[me.PENDING],icon:Ko,color:Ct[me.PENDING]},{value:me.PROCESSING,label:wt[me.PROCESSING],icon:xr,color:Ct[me.PROCESSING]},{value:me.VALID,label:wt[me.VALID],icon:va,color:Ct[me.VALID]},{value:me.INVALID,label:wt[me.INVALID],icon:hr,color:Ct[me.INVALID]}];function Pt({column:s,title:n,options:a}){const l=s?.getFacetedUniqueValues(),r=s?.getFilterValue(),c=Array.isArray(r)?new Set(r):r!==void 0?new Set([r]):new Set;return e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),n,c?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:c.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:c.size>2?e.jsxs(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[c.size," selected"]}):a.filter(o=>c.has(o.value)).map(o=>e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:o.label},o.value))})]})]})}),e.jsx(ds,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Vs,{children:[e.jsx(Hs,{placeholder:n}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:"No results found."}),e.jsx(Be,{children:a.map(o=>{const u=c.has(o.value);return e.jsxs(Ie,{onSelect:()=>{const x=new Set(c);u?x.delete(o.value):x.add(o.value);const i=Array.from(x);s?.setFilterValue(i.length?i:void 0)},children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",u?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(As,{className:N("h-4 w-4")})}),o.icon&&e.jsx(o.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${o.color}`}),e.jsx("span",{children:o.label}),l?.get(o.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(o.value)})]},o.value)})}),c.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),e.jsx(Be,{children:e.jsx(Ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Ax=h.object({email:h.string().min(1),plan_id:h.number(),period:h.string(),total_amount:h.number()}),$x={email:"",plan_id:0,total_amount:0,period:""};function tl({refetch:s,trigger:n,defaultValues:a}){const{t:l}=F("order"),[r,c]=m.useState(!1),o=fe({resolver:ye(Ax),defaultValues:{...$x,...a},mode:"onChange"}),[u,x]=m.useState([]);return m.useEffect(()=>{r&&Us().then(({data:i})=>{x(i)})},[r]),e.jsxs(ve,{open:r,onOpenChange:c,children:[e.jsx(We,{asChild:!0,children:n||e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 space-x-2",children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("div",{children:l("dialog.addOrder")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:l("dialog.assignOrder")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...o,children:[e.jsx(b,{control:o.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dialog.fields.userEmail")}),e.jsx(_,{children:e.jsx(D,{placeholder:l("dialog.placeholders.email"),...i})})]})}),e.jsx(b,{control:o.control,name:"plan_id",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dialog.fields.subscriptionPlan")}),e.jsx(_,{children:e.jsxs(X,{value:i.value?i.value?.toString():void 0,onValueChange:d=>i.onChange(parseInt(d)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dialog.placeholders.plan")})}),e.jsx(J,{children:u.map(d=>e.jsx(U,{value:d.id.toString(),children:d.name},d.id))})]})})]})}),e.jsx(b,{control:o.control,name:"period",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dialog.fields.orderPeriod")}),e.jsx(_,{children:e.jsxs(X,{value:i.value,onValueChange:i.onChange,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:l("dialog.placeholders.period")})}),e.jsx(J,{children:Object.keys(fu).map(d=>e.jsx(U,{value:d,children:l(`period.${d}`)},d))})]})})]})}),e.jsx(b,{control:o.control,name:"total_amount",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:l("dialog.fields.paymentAmount")}),e.jsx(_,{children:e.jsx(D,{type:"number",placeholder:l("dialog.placeholders.amount"),value:i.value/100,onChange:d=>i.onChange(parseFloat(d.currentTarget.value)*100)})}),e.jsx(k,{})]})}),e.jsxs(Me,{children:[e.jsx(T,{variant:"outline",onClick:()=>c(!1),children:l("dialog.actions.cancel")}),e.jsx(T,{type:"submit",onClick:()=>{o.handleSubmit(i=>{rd(i).then(({data:d})=>{d&&(s&&s(),o.reset(),c(!1),$.success(l("dialog.messages.addSuccess")))})})()},children:l("dialog.actions.confirm")})]})]})]})]})}function qx({table:s,refetch:n}){const{t:a}=F("order"),l=s.getState().columnFilters.length>0,r=Object.values(rs).filter(x=>typeof x=="number").map(x=>({label:a(`type.${rs[x]}`),value:x,color:x===rs.NEW?"green-500":x===rs.RENEWAL?"blue-500":x===rs.UPGRADE?"purple-500":"orange-500"})),c=Object.values(De).map(x=>({label:a(`period.${x}`),value:x,color:x===De.MONTH_PRICE?"slate-500":x===De.QUARTER_PRICE?"cyan-500":x===De.HALF_YEAR_PRICE?"indigo-500":x===De.YEAR_PRICE?"violet-500":x===De.TWO_YEAR_PRICE?"fuchsia-500":x===De.THREE_YEAR_PRICE?"pink-500":x===De.ONETIME_PRICE?"rose-500":"orange-500"})),o=Object.values(re).filter(x=>typeof x=="number").map(x=>({label:a(`status.${re[x]}`),value:x,icon:x===re.PENDING?Ys[0].icon:x===re.PROCESSING?Ys[1].icon:x===re.COMPLETED?Ys[2].icon:x===re.CANCELLED?Ys[3].icon:Ys[4].icon,color:x===re.PENDING?"yellow-500":x===re.PROCESSING?"blue-500":x===re.COMPLETED?"green-500":x===re.CANCELLED?"red-500":"green-500"})),u=Object.values(me).filter(x=>typeof x=="number").map(x=>({label:a(`commission.${me[x]}`),value:x,icon:x===me.PENDING?dt[0].icon:x===me.PROCESSING?dt[1].icon:x===me.VALID?dt[2].icon:dt[3].icon,color:x===me.PENDING?"yellow-500":x===me.PROCESSING?"blue-500":x===me.VALID?"green-500":"red-500"}));return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(tl,{refetch:n}),e.jsx(D,{placeholder:a("search.placeholder"),value:s.getColumn("trade_no")?.getFilterValue()??"",onChange:x=>s.getColumn("trade_no")?.setFilterValue(x.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex flex-wrap gap-x-2",children:[s.getColumn("type")&&e.jsx(Pt,{column:s.getColumn("type"),title:a("table.columns.type"),options:r}),s.getColumn("period")&&e.jsx(Pt,{column:s.getColumn("period"),title:a("table.columns.period"),options:c}),s.getColumn("status")&&e.jsx(Pt,{column:s.getColumn("status"),title:a("table.columns.status"),options:o}),s.getColumn("commission_status")&&e.jsx(Pt,{column:s.getColumn("commission_status"),title:a("table.columns.commissionStatus"),options:u})]}),l&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[a("actions.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]})}function as({label:s,value:n,className:a,valueClassName:l}){return e.jsxs("div",{className:N("flex items-center py-1.5",a),children:[e.jsx("div",{className:"w-28 shrink-0 text-sm text-muted-foreground",children:s}),e.jsx("div",{className:N("text-sm",l),children:n||"-"})]})}function Ux({status:s}){const{t:n}=F("order"),a={[re.PENDING]:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",[re.PROCESSING]:"bg-blue-100 text-blue-800 hover:bg-blue-100",[re.CANCELLED]:"bg-red-100 text-red-800 hover:bg-red-100",[re.COMPLETED]:"bg-green-100 text-green-800 hover:bg-green-100",[re.DISCOUNTED]:"bg-gray-100 text-gray-800 hover:bg-gray-100"};return e.jsx(K,{variant:"secondary",className:N("font-medium",a[s]),children:n(`status.${re[s]}`)})}function Hx({id:s,trigger:n}){const[a,l]=m.useState(!1),[r,c]=m.useState(),{t:o}=F("order");return m.useEffect(()=>{(async()=>{if(a){const{data:x}=await td({id:s});c(x)}})()},[a,s]),e.jsxs(ve,{onOpenChange:l,open:a,children:[e.jsx(We,{asChild:!0,children:n}),e.jsxs(pe,{className:"max-w-xl",children:[e.jsxs(we,{className:"space-y-2",children:[e.jsx(be,{className:"text-lg font-medium",children:o("dialog.title")}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-muted-foreground",children:[o("table.columns.tradeNo"),"：",r?.trade_no]}),r?.status&&e.jsx(Ux,{status:r.status})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.basicInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(as,{label:o("dialog.fields.userEmail"),value:r?.user?.email?e.jsxs($s,{to:`/user/manage?email=${r.user.email}`,className:"group inline-flex items-center gap-1 text-primary hover:underline",children:[r.user.email,e.jsx(pr,{className:"h-3.5 w-3.5 opacity-0 transition-opacity group-hover:opacity-100"})]}):"-"}),e.jsx(as,{label:o("dialog.fields.orderPeriod"),value:r&&o(`period.${r.period}`)}),e.jsx(as,{label:o("dialog.fields.subscriptionPlan"),value:r?.plan?.name,valueClassName:"font-medium"}),e.jsx(as,{label:o("dialog.fields.callbackNo"),value:r?.callback_no,valueClassName:"font-mono text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.amountInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(as,{label:o("dialog.fields.paymentAmount"),value:Os(r?.total_amount||0),valueClassName:"font-medium text-primary"}),e.jsx(Se,{className:"my-2"}),e.jsx(as,{label:o("dialog.fields.balancePayment"),value:Os(r?.balance_amount||0)}),e.jsx(as,{label:o("dialog.fields.discountAmount"),value:Os(r?.discount_amount||0),valueClassName:"text-green-600"}),e.jsx(as,{label:o("dialog.fields.refundAmount"),value:Os(r?.refund_amount||0),valueClassName:"text-red-600"}),e.jsx(as,{label:o("dialog.fields.deductionAmount"),value:Os(r?.surplus_amount||0)})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:o("dialog.timeInfo")}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(as,{label:o("dialog.fields.createdAt"),value:_e(r?.created_at),valueClassName:"font-mono text-xs"}),e.jsx(as,{label:o("dialog.fields.updatedAt"),value:_e(r?.updated_at),valueClassName:"font-mono text-xs"})]})]})]})]})]})}const Kx={[rs.NEW]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[rs.RENEWAL]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[rs.UPGRADE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[rs.RESET_FLOW]:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},Bx={[De.MONTH_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.QUARTER_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.HALF_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.TWO_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.THREE_YEAR_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.ONETIME_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"},[De.RESET_PRICE]:{color:"text-slate-700",bgColor:"bg-slate-100/80"}},Gx=s=>re[s],Wx=s=>me[s],Yx=s=>rs[s],Qx=s=>{const{t:n}=F("order");return[{accessorKey:"trade_no",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.tradeNo")}),cell:({row:a})=>{const l=a.original.trade_no,r=l.length>6?`${l.slice(0,3)}...${l.slice(-3)}`:l;return e.jsx("div",{className:"flex items-center",children:e.jsx(Hx,{trigger:e.jsxs(G,{variant:"ghost",size:"sm",className:"flex h-8 items-center gap-1.5 px-2 font-medium text-primary transition-colors hover:bg-primary/10 hover:text-primary/80",children:[e.jsx("span",{className:"font-mono",children:r}),e.jsx(pr,{className:"h-3.5 w-3.5 opacity-70"})]}),id:a.original.id})})},enableSorting:!1,enableHiding:!1},{accessorKey:"type",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.type")}),cell:({row:a})=>{const l=a.getValue("type"),r=Kx[l];return e.jsx(K,{variant:"secondary",className:N("font-medium transition-colors text-nowrap",r.color,r.bgColor,"border border-border/50","hover:bg-slate-200/80"),children:n(`type.${Yx(l)}`)})},enableSorting:!1,enableHiding:!1},{accessorKey:"plan.name",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.plan")}),cell:({row:a})=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:"max-w-32 truncate font-medium text-foreground/90 sm:max-w-72 md:max-w-[31rem]",children:a.original.plan?.name||"-"})}),enableSorting:!1,enableHiding:!1},{accessorKey:"period",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.period")}),cell:({row:a})=>{const l=a.getValue("period"),r=Bx[l];return e.jsx(K,{variant:"secondary",className:N("font-medium transition-colors text-nowrap",r.color,r.bgColor,"hover:bg-opacity-80"),children:n(`period.${l}`)})},enableSorting:!1,enableHiding:!1},{accessorKey:"total_amount",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.amount")}),cell:({row:a})=>{const l=a.getValue("total_amount"),r=typeof l=="number"?(l/100).toFixed(2):"N/A";return e.jsxs("div",{className:"flex items-center font-mono text-foreground/90",children:["¥",r]})},enableSorting:!0,enableHiding:!1},{accessorKey:"status",header:({column:a})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{column:a,title:n("table.columns.status")}),e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx(Gr,{className:"h-4 w-4 text-muted-foreground/70 transition-colors hover:text-muted-foreground"})}),e.jsx(ce,{side:"top",className:"max-w-[200px] text-sm",children:n("status.tooltip")})]})})]}),cell:({row:a})=>{const l=Ys.find(r=>r.value===a.getValue("status"));return l?e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l.icon&&e.jsx(l.icon,{className:`h-4 w-4 text-${l.color}`}),e.jsx("span",{className:"text-sm font-medium",children:n(`status.${Gx(l.value)}`)})]}),l.value===re.PENDING&&e.jsxs(ws,{modal:!0,children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(G,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(Ot,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:n("actions.openMenu")})]})}),e.jsxs(xs,{align:"end",className:"w-[140px]",children:[e.jsx(ge,{className:"cursor-pointer",onClick:async()=>{await ad({trade_no:a.original.trade_no}),s()},children:n("actions.markAsPaid")}),e.jsx(ge,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await nd({trade_no:a.original.trade_no}),s()},children:n("actions.cancel")})]})]})]}):null},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_balance",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.commission")}),cell:({row:a})=>{const l=a.getValue("commission_balance"),r=l?(l/100).toFixed(2):"-";return e.jsx("div",{className:"flex items-center font-mono text-foreground/90",children:l?`¥${r}`:"-"})},enableSorting:!0,enableHiding:!1},{accessorKey:"commission_status",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.commissionStatus")}),cell:({row:a})=>{const l=a.original.status,r=a.original.commission_balance,c=dt.find(o=>o.value===a.getValue("commission_status"));return r==0||!c?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c.icon&&e.jsx(c.icon,{className:`h-4 w-4 text-${c.color}`}),e.jsx("span",{className:"text-sm font-medium",children:n(`commission.${Wx(c.value)}`)})]}),c.value===me.PENDING&&l===re.COMPLETED&&e.jsxs(ws,{modal:!0,children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(G,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-muted/60",children:[e.jsx(Ot,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:n("actions.openMenu")})]})}),e.jsxs(xs,{align:"end",className:"w-[120px]",children:[e.jsx(ge,{className:"cursor-pointer",onClick:async()=>{await an({trade_no:a.original.trade_no,commission_status:me.PROCESSING}),s()},children:n("commission.PROCESSING")}),e.jsx(ge,{className:"cursor-pointer text-destructive focus:text-destructive",onClick:async()=>{await an({trade_no:a.original.trade_no,commission_status:me.INVALID}),s()},children:n("commission.INVALID")})]})]})]})},enableSorting:!0,enableHiding:!1},{accessorKey:"created_at",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.createdAt")}),cell:({row:a})=>e.jsx("div",{className:"text-nowrap font-mono text-sm text-muted-foreground",children:_e(a.getValue("created_at"),"YYYY/MM/DD HH:mm:ss")}),enableSorting:!0,enableHiding:!1}]};function Jx(){const[s]=fr(),[n,a]=m.useState({}),[l,r]=m.useState({}),[c,o]=m.useState([]),[u,x]=m.useState([]),[i,d]=m.useState({pageIndex:0,pageSize:20});m.useEffect(()=>{const C=Object.entries({user_id:"string",order_id:"string",commission_status:"number",status:"number",commission_balance:"string"}).map(([g,S])=>{const R=s.get(g);return R?{id:g,value:S==="number"?parseInt(R):R}:null}).filter(Boolean);C.length>0&&o(C)},[s]);const{refetch:p,data:w,isLoading:P}=ie({queryKey:["orderList",i,c,u],queryFn:()=>sd({pageSize:i.pageSize,current:i.pageIndex+1,filter:c,sort:u})}),f=ss({data:w?.data??[],columns:Qx(p),state:{sorting:u,columnVisibility:l,rowSelection:n,columnFilters:c,pagination:i},rowCount:w?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:x,onColumnFiltersChange:o,onColumnVisibilityChange:r,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),onPaginationChange:d,getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(us,{table:f,toolbar:e.jsx(qx,{table:f,refetch:p}),showPagination:!0})}function Zx(){const{t:s}=F("order");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Jx,{})})]})]})}const Xx=Object.freeze(Object.defineProperty({__proto__:null,default:Zx},Symbol.toStringTag,{value:"Module"}));function eh({column:s,title:n,options:a}){const l=s?.getFacetedUniqueValues(),r=new Set(s?.getFilterValue());return e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),n,r?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(c=>r.has(c.value)).map(c=>e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:c.label},c.value))})]})]})}),e.jsx(ds,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Vs,{children:[e.jsx(Hs,{placeholder:n}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:"No results found."}),e.jsx(Be,{children:a.map(c=>{const o=r.has(c.value);return e.jsxs(Ie,{onSelect:()=>{o?r.delete(c.value):r.add(c.value);const u=Array.from(r);s?.setFilterValue(u.length?u:void 0)},children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(As,{className:N("h-4 w-4")})}),c.icon&&e.jsx(c.icon,{className:`mr-2 h-4 w-4 text-muted-foreground text-${c.color}`}),e.jsx("span",{children:c.label}),l?.get(c.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:l.get(c.value)})]},c.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),e.jsx(Be,{children:e.jsx(Ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const sh=h.object({id:h.coerce.number().nullable().optional(),name:h.string().min(1,"请输入优惠券名称"),code:h.string().nullable(),type:h.coerce.number(),value:h.coerce.number(),started_at:h.coerce.number(),ended_at:h.coerce.number(),limit_use:h.union([h.string(),h.number()]).nullable(),limit_use_with_user:h.union([h.string(),h.number()]).nullable(),generate_count:h.coerce.number().nullable().optional(),limit_plan_ids:h.array(h.coerce.number()).default([]).nullable(),limit_period:h.array(h.nativeEnum(mt)).default([]).nullable()}).refine(s=>s.ended_at>s.started_at,{message:"结束时间必须晚于开始时间",path:["ended_at"]}),xn={name:"",code:null,type:Ue.AMOUNT,value:0,started_at:Math.floor(Date.now()/1e3),ended_at:Math.floor(Date.now()/1e3)+7*24*60*60,limit_use:null,limit_use_with_user:null,limit_plan_ids:[],limit_period:[],generate_count:null};function al({defaultValues:s,refetch:n,type:a="create",dialogTrigger:l=null,open:r,onOpenChange:c}){const{t:o}=F("coupon"),[u,x]=m.useState(!1),i=r??u,d=c??x,[p,w]=m.useState([]),P=fe({resolver:ye(sh),defaultValues:s||xn});m.useEffect(()=>{s&&P.reset(s)},[s,P]),m.useEffect(()=>{Us().then(({data:g})=>w(g))},[]);const f=g=>{if(!g)return;const S=(R,E)=>{const O=new Date(E*1e3);return R.setHours(O.getHours(),O.getMinutes(),O.getSeconds()),Math.floor(R.getTime()/1e3)};g.from&&P.setValue("started_at",S(g.from,P.watch("started_at"))),g.to&&P.setValue("ended_at",S(g.to,P.watch("ended_at")))},j=async g=>{const S=await id(g);if(g.generate_count&&S){const R=new Blob([S],{type:"text/csv;charset=utf-8;"}),E=document.createElement("a");E.href=window.URL.createObjectURL(R),E.download=`coupons_${new Date().getTime()}.csv`,E.click(),window.URL.revokeObjectURL(E.href)}d(!1),a==="create"&&P.reset(xn),n()},C=(g,S)=>e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:S}),e.jsx(D,{type:"datetime-local",step:"1",value:_e(P.watch(g),"YYYY-MM-DDTHH:mm:ss"),onChange:R=>{const E=new Date(R.target.value);P.setValue(g,Math.floor(E.getTime()/1e3))},className:"h-8 [&::-webkit-calendar-picker-indicator]:hidden"})]});return e.jsxs(ve,{open:i,onOpenChange:d,children:[l&&e.jsx(We,{asChild:!0,children:l}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsx(we,{children:e.jsx(be,{children:o(a==="create"?"form.add":"form.edit")})}),e.jsx(Ne,{...P,children:e.jsxs("form",{onSubmit:P.handleSubmit(j),className:"space-y-4",children:[e.jsx(b,{control:P.control,name:"name",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.name.label")}),e.jsx(D,{placeholder:o("form.name.placeholder"),...g}),e.jsx(k,{})]})}),a==="create"&&e.jsx(b,{control:P.control,name:"generate_count",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.generateCount.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.generateCount.placeholder"),...g,value:g.value===void 0?"":g.value,onChange:S=>g.onChange(S.target.value===""?"":parseInt(S.target.value)),className:"h-9"}),e.jsx(z,{className:"text-xs",children:o("form.generateCount.description")}),e.jsx(k,{})]})}),(!P.watch("generate_count")||P.watch("generate_count")==null)&&e.jsx(b,{control:P.control,name:"code",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.code.label")}),e.jsx(D,{placeholder:o("form.code.placeholder"),...g,className:"h-9"}),e.jsx(z,{className:"text-xs",children:o("form.code.description")}),e.jsx(k,{})]})}),e.jsxs(v,{children:[e.jsx(y,{children:o("form.type.label")}),e.jsxs("div",{className:"flex",children:[e.jsx(b,{control:P.control,name:"type",render:({field:g})=>e.jsxs(X,{value:g.value.toString(),onValueChange:S=>{const R=g.value,E=parseInt(S);g.onChange(E);const O=P.getValues("value");O&&(R===Ue.AMOUNT&&E===Ue.PERCENTAGE?P.setValue("value",O/100):R===Ue.PERCENTAGE&&E===Ue.AMOUNT&&P.setValue("value",O*100))},children:[e.jsx(Q,{className:"flex-[1.2] rounded-r-none border-r-0 focus:z-10",children:e.jsx(ee,{placeholder:o("form.type.placeholder")})}),e.jsx(J,{children:Object.entries(gu).map(([S,R])=>e.jsx(U,{value:S,children:o(`table.toolbar.types.${S}`)},S))})]})}),e.jsx(b,{control:P.control,name:"value",render:({field:g})=>{const S=g.value==null?"":P.watch("type")===Ue.AMOUNT&&typeof g.value=="number"?(g.value/100).toString():g.value.toString();return e.jsx(D,{type:"number",placeholder:o("form.value.placeholder"),...g,value:S,onChange:R=>{const E=R.target.value;if(E===""){g.onChange("");return}const O=parseFloat(E);isNaN(O)||g.onChange(P.watch("type")===Ue.AMOUNT?Math.round(O*100):O)},step:"any",min:0,className:"flex-[2] rounded-none border-x-0 text-left"})}}),e.jsx("div",{className:"flex min-w-[40px] items-center justify-center rounded-md rounded-l-none border border-l-0 border-input bg-muted/50 px-3 font-medium text-muted-foreground",children:e.jsx("span",{children:P.watch("type")==Ue.AMOUNT?"¥":"%"})})]})]}),e.jsxs(v,{children:[e.jsx(y,{children:o("form.validity.label")}),e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:N("w-full justify-start text-left font-normal",!P.watch("started_at")&&"text-muted-foreground"),children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),_e(P.watch("started_at"),"YYYY-MM-DD HH:mm:ss")," ",o("form.validity.to")," ",_e(P.watch("ended_at"),"YYYY-MM-DD HH:mm:ss")]})}),e.jsxs(ds,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"border-b border-border",children:e.jsx(Bs,{mode:"range",selected:{from:new Date(P.watch("started_at")*1e3),to:new Date(P.watch("ended_at")*1e3)},onSelect:f,numberOfMonths:2})}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[C("started_at",o("table.validity.startTime")),e.jsx("div",{className:"mt-6 text-sm text-muted-foreground",children:o("form.validity.to")}),C("ended_at",o("table.validity.endTime"))]})})]})]}),e.jsx(k,{})]}),e.jsx(b,{control:P.control,name:"limit_use",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.limitUse.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.limitUse.placeholder"),...g,value:g.value===null?"":g.value,onChange:S=>g.onChange(S.target.value===""?null:parseInt(S.target.value)),className:"h-9"}),e.jsx(z,{className:"text-xs",children:o("form.limitUse.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:P.control,name:"limit_use_with_user",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.limitUseWithUser.label")}),e.jsx(D,{type:"number",min:0,placeholder:o("form.limitUseWithUser.placeholder"),...g,value:g.value===null?"":g.value,onChange:S=>g.onChange(S.target.value===""?null:parseInt(S.target.value)),className:"h-9"}),e.jsx(z,{className:"text-xs",children:o("form.limitUseWithUser.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:P.control,name:"limit_period",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.limitPeriod.label")}),e.jsx(ft,{options:Object.entries(mt).filter(([S])=>isNaN(Number(S))).map(([S,R])=>({label:o(`coupon:period.${R}`),value:S})),onChange:S=>{if(S.length===0){g.onChange([]);return}const R=S.map(E=>mt[E.value]);g.onChange(R)},value:(g.value||[]).map(S=>({label:o(`coupon:period.${S}`),value:Object.entries(mt).find(([R,E])=>E===S)?.[0]||""})),placeholder:o("form.limitPeriod.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:o("form.limitPeriod.empty")})}),e.jsx(z,{className:"text-xs",children:o("form.limitPeriod.description")}),e.jsx(k,{})]})}),e.jsx(b,{control:P.control,name:"limit_plan_ids",render:({field:g})=>e.jsxs(v,{children:[e.jsx(y,{children:o("form.limitPlan.label")}),e.jsx(ft,{options:p?.map(S=>({label:S.name,value:S.id.toString()}))||[],onChange:S=>g.onChange(S.map(R=>Number(R.value))),value:(p||[]).filter(S=>(g.value||[]).includes(S.id)).map(S=>({label:S.name,value:S.id.toString()})),placeholder:o("form.limitPlan.placeholder"),emptyIndicator:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:o("form.limitPlan.empty")})}),e.jsx(k,{})]})}),e.jsx(Me,{children:e.jsx(T,{type:"submit",disabled:P.formState.isSubmitting,children:P.formState.isSubmitting?o("form.submit.saving"):o("form.submit.save")})})]})})]})]})}function th({table:s,refetch:n}){const a=s.getState().columnFilters.length>0,{t:l}=F("coupon");return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(al,{refetch:n,dialogTrigger:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 space-x-2",children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("div",{children:l("form.add")})]})}),e.jsx(D,{placeholder:l("table.toolbar.search"),value:s.getColumn("name")?.getFilterValue()??"",onChange:r=>s.getColumn("name")?.setFilterValue(r.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("type")&&e.jsx(eh,{column:s.getColumn("type"),title:l("table.toolbar.type"),options:[{value:Ue.AMOUNT,label:l(`table.toolbar.types.${Ue.AMOUNT}`)},{value:Ue.PERCENTAGE,label:l(`table.toolbar.types.${Ue.PERCENTAGE}`)}]}),a&&e.jsxs(T,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:[l("table.toolbar.reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]})]})}const nl=m.createContext(void 0);function ah({children:s,refetch:n}){const[a,l]=m.useState(!1),[r,c]=m.useState(null),o=x=>{c(x),l(!0)},u=()=>{l(!1),c(null)};return e.jsxs(nl.Provider,{value:{isOpen:a,currentCoupon:r,openEdit:o,closeEdit:u},children:[s,r&&e.jsx(al,{defaultValues:r,refetch:n,type:"edit",open:a,onOpenChange:l})]})}function nh(){const s=m.useContext(nl);if(s===void 0)throw new Error("useCouponEdit must be used within a CouponEditProvider");return s}const rh=s=>{const{t:n}=F("coupon");return[{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.id")}),cell:({row:a})=>e.jsx(K,{children:a.original.id}),enableSorting:!0},{accessorKey:"show",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.show")}),cell:({row:a})=>e.jsx(W,{defaultChecked:a.original.show,onCheckedChange:l=>{cd({id:a.original.id,show:l}).then(({data:r})=>!r&&s())}}),enableSorting:!1},{accessorKey:"name",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.name")}),cell:({row:a})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:a.original.name})}),enableSorting:!1,size:800},{accessorKey:"type",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.type")}),cell:({row:a})=>e.jsx(K,{variant:"outline",children:n(`table.toolbar.types.${a.original.type}`)}),enableSorting:!0},{accessorKey:"code",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.code")}),cell:({row:a})=>e.jsx(K,{variant:"secondary",children:a.original.code}),enableSorting:!0},{accessorKey:"limit_use",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.limitUse")}),cell:({row:a})=>e.jsx(K,{variant:"outline",children:a.original.limit_use===null?n("table.validity.unlimited"):a.original.limit_use}),enableSorting:!0},{accessorKey:"limit_use_with_user",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.limitUseWithUser")}),cell:({row:a})=>e.jsx(K,{variant:"outline",children:a.original.limit_use_with_user===null?n("table.validity.noLimit"):a.original.limit_use_with_user}),enableSorting:!0},{accessorKey:"#",header:({column:a})=>e.jsx(L,{column:a,title:n("table.columns.validity")}),cell:({row:a})=>{const[l,r]=m.useState(!1),c=Date.now(),o=a.original.started_at*1e3,u=a.original.ended_at*1e3,x=c>u,i=c<o,d=Math.ceil((u-c)/(1e3*60*60*24)),w=x?{label:n("table.validity.expired",{days:Math.abs(d)}),color:"bg-red-50 text-red-600 dark:bg-red-500/10 dark:text-red-400"}:i?{label:n("table.validity.notStarted",{days:Math.abs(Math.ceil((o-c)/(1e3*60*60*24)))}),color:"bg-yellow-50 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-400"}:{label:n("table.validity.remaining",{days:d}),color:"bg-green-50 text-green-600 dark:bg-green-500/10 dark:text-green-400"};return e.jsxs(Rr,{open:l,onOpenChange:r,children:[e.jsx(Ir,{asChild:!0,children:e.jsxs("div",{className:"group -m-0.5 flex max-w-[280px] cursor-pointer items-center gap-2 rounded-md p-0.5 transition-colors hover:bg-muted/40",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx("div",{className:N("whitespace-nowrap rounded-md px-1.5 py-0.5 text-xs font-medium",w.color),children:w.label}),e.jsxs("div",{className:"flex min-w-0 items-center gap-1 text-muted-foreground",children:[e.jsx("div",{className:"truncate text-xs",children:_e(a.original.started_at,"MM/DD HH:mm")}),e.jsx("div",{className:"shrink-0 opacity-30",children:"→"}),e.jsx("div",{className:"truncate text-xs",children:_e(a.original.ended_at,"MM/DD HH:mm")})]})]}),e.jsx(Bo,{className:N("h-3.5 w-3.5 shrink-0 text-muted-foreground/50 transition-transform duration-200",l&&"rotate-180")})]})}),e.jsx(Vr,{children:e.jsx("div",{className:"px-0.5 pb-0.5 pt-1.5",children:e.jsxs("div",{className:"space-y-1.5 border-l-2 border-muted pl-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n("table.validity.startTime")}),e.jsx("span",{className:"font-medium text-foreground",children:_e(a.original.started_at,"YYYY/MM/DD HH:mm")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n("table.validity.endTime")}),e.jsx("span",{className:"font-medium text-foreground",children:_e(a.original.ended_at,"YYYY/MM/DD HH:mm")})]})]})})})]})},enableSorting:!1,size:8e3},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("table.columns.actions")}),cell:({row:a})=>{const{openEdit:l}=nh();return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted",onClick:()=>l(a.original),children:[e.jsx(qs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"}),e.jsx("span",{className:"sr-only",children:n("table.actions.edit")})]}),e.jsx(Ge,{title:n("table.actions.deleteConfirm.title"),description:n("table.actions.deleteConfirm.description"),confirmText:n("table.actions.deleteConfirm.confirmText"),variant:"destructive",onConfirm:async()=>{od({id:a.original.id}).then(({data:r})=>{r&&($.success("删除成功"),s())})},children:e.jsxs(T,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-100 dark:hover:bg-red-900",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground hover:text-red-600 dark:hover:text-red-400"}),e.jsx("span",{className:"sr-only",children:n("table.actions.delete")})]})})]})}}]};function lh(){const[s,n]=m.useState({}),[a,l]=m.useState({}),[r,c]=m.useState([]),[o,u]=m.useState([]),[x,i]=m.useState({pageIndex:0,pageSize:20}),{refetch:d,data:p}=ie({queryKey:["couponList",x,r,o],queryFn:()=>ld({pageSize:x.pageSize,current:x.pageIndex+1,filter:r,sort:o})}),w=ss({data:p?.data??[],columns:rh(d),state:{sorting:o,columnVisibility:a,rowSelection:s,columnFilters:r,pagination:x},pageCount:Math.ceil((p?.total??0)/x.pageSize),rowCount:p?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:l,onPaginationChange:i,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsx(ah,{refetch:d,children:e.jsx("div",{className:"space-y-4",children:e.jsx(us,{table:w,toolbar:e.jsx(th,{table:w,refetch:d})})})})}function ih(){const{t:s}=F("coupon");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(lh,{})})]})]})}const oh=Object.freeze(Object.defineProperty({__proto__:null,default:ih},Symbol.toStringTag,{value:"Module"})),ch=1,dh=1e6;let ma=0;function uh(){return ma=(ma+1)%Number.MAX_SAFE_INTEGER,ma.toString()}const xa=new Map,hn=s=>{if(xa.has(s))return;const n=setTimeout(()=>{xa.delete(s),xt({type:"REMOVE_TOAST",toastId:s})},dh);xa.set(s,n)},mh=(s,n)=>{switch(n.type){case"ADD_TOAST":return{...s,toasts:[n.toast,...s.toasts].slice(0,ch)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===n.toast.id?{...a,...n.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=n;return a?hn(a):s.toasts.forEach(l=>{hn(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return n.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==n.toastId)}}},Rt=[];let It={toasts:[]};function xt(s){It=mh(It,s),Rt.forEach(n=>{n(It)})}function xh({...s}){const n=uh(),a=r=>xt({type:"UPDATE_TOAST",toast:{...r,id:n}}),l=()=>xt({type:"DISMISS_TOAST",toastId:n});return xt({type:"ADD_TOAST",toast:{...s,id:n,open:!0,onOpenChange:r=>{r||l()}}}),{id:n,dismiss:l,update:a}}function rl(){const[s,n]=m.useState(It);return m.useEffect(()=>(Rt.push(n),()=>{const a=Rt.indexOf(n);a>-1&&Rt.splice(a,1)}),[s]),{...s,toast:xh,dismiss:a=>xt({type:"DISMISS_TOAST",toastId:a})}}function hh({open:s,onOpenChange:n,table:a}){const{t:l}=F("user"),{toast:r}=rl(),[c,o]=m.useState(!1),[u,x]=m.useState(""),[i,d]=m.useState(""),p=async()=>{if(!u||!i){r({title:l("messages.error"),description:l("messages.send_mail.required_fields"),variant:"destructive"});return}try{o(!0),await Lt.sendMail({subject:u,content:i,filter:a.getState().columnFilters,sort:a.getState().sorting[0]?.id,sort_type:a.getState().sorting[0]?.desc?"DESC":"ASC"}),r({title:l("messages.success"),description:l("messages.send_mail.success")}),n(!1),x(""),d("")}catch{r({title:l("messages.error"),description:l("messages.send_mail.failed"),variant:"destructive"})}finally{o(!1)}};return e.jsx(ve,{open:s,onOpenChange:n,children:e.jsxs(pe,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:l("send_mail.title")}),e.jsx(ke,{children:l("send_mail.description")})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"subject",className:"text-right",children:l("send_mail.subject")}),e.jsx(D,{id:"subject",value:u,onChange:w=>x(w.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"content",className:"text-right",children:l("send_mail.content")}),e.jsx(js,{id:"content",value:i,onChange:w=>d(w.target.value),className:"col-span-3",rows:6})]})]}),e.jsx(Me,{children:e.jsx(G,{type:"submit",onClick:p,disabled:c,children:l(c?"send_mail.sending":"send_mail.send")})})]})})}const ph=h.object({email_prefix:h.string().optional(),email_suffix:h.string().min(1),password:h.string().optional(),expired_at:h.number().optional().nullable(),plan_id:h.number().nullable(),generate_count:h.number().optional().nullable()}).refine(s=>s.generate_count===null?s.email_prefix!==void 0&&s.email_prefix!=="":!0,{message:"Email prefix is required when generate_count is null",path:["email_prefix"]}),fh={email_prefix:"",email_suffix:"",password:"",expired_at:null,plan_id:null,generate_count:void 0};function gh({refetch:s}){const{t:n}=F("user"),[a,l]=m.useState(!1),r=fe({resolver:ye(ph),defaultValues:fh,mode:"onChange"}),[c,o]=m.useState([]);return m.useEffect(()=>{a&&Us().then(({data:u})=>{u&&o(u)})},[a]),e.jsxs(ve,{open:a,onOpenChange:l,children:[e.jsx(We,{asChild:!0,children:e.jsxs(G,{size:"sm",variant:"outline",className:"space-x-2 gap-0",children:[e.jsx(Re,{icon:"ion:add"}),e.jsx("div",{children:n("generate.button")})]})}),e.jsxs(pe,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:n("generate.title")}),e.jsx(ke,{})]}),e.jsxs(Ne,{...r,children:[e.jsxs(v,{children:[e.jsx(y,{children:n("generate.form.email")}),e.jsxs("div",{className:"flex",children:[!r.watch("generate_count")&&e.jsx(b,{control:r.control,name:"email_prefix",render:({field:u})=>e.jsx(D,{className:"flex-[5] rounded-r-none",placeholder:n("generate.form.email_prefix"),...u})}),e.jsx("div",{className:`z-[-1] border border-r-0 border-input px-3 py-1 shadow-sm ${r.watch("generate_count")?"rounded-l-md":"border-l-0"}`,children:"@"}),e.jsx(b,{control:r.control,name:"email_suffix",render:({field:u})=>e.jsx(D,{className:"flex-[4] rounded-l-none",placeholder:n("generate.form.email_domain"),...u})})]})]}),e.jsx(b,{control:r.control,name:"password",render:({field:u})=>e.jsxs(v,{children:[e.jsx(y,{children:n("generate.form.password")}),e.jsx(D,{placeholder:n("generate.form.password_placeholder"),...u}),e.jsx(k,{})]})}),e.jsx(b,{control:r.control,name:"expired_at",render:({field:u})=>e.jsxs(v,{className:"flex flex-col",children:[e.jsx(y,{children:n("generate.form.expire_time")}),e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(_,{children:e.jsxs(G,{variant:"outline",className:N("w-full pl-3 text-left font-normal",!u.value&&"text-muted-foreground"),children:[u.value?_e(u.value):e.jsx("span",{children:n("generate.form.expire_time_placeholder")}),e.jsx(jt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsxs(ds,{className:"flex w-auto flex-col space-y-2 p-2",children:[e.jsx(Go,{asChild:!0,children:e.jsx(G,{variant:"outline",className:"w-full",onClick:()=>{u.onChange(null)},children:n("generate.form.permanent")})}),e.jsx("div",{className:"rounded-md border",children:e.jsx(Bs,{mode:"single",selected:u.value?new Date(u.value*1e3):void 0,onSelect:x=>{x&&u.onChange(x?.getTime()/1e3)}})})]})]})]})}),e.jsx(b,{control:r.control,name:"plan_id",render:({field:u})=>e.jsxs(v,{children:[e.jsx(y,{children:n("generate.form.subscription")}),e.jsx(_,{children:e.jsxs(X,{value:u.value?u.value.toString():"null",onValueChange:x=>u.onChange(x==="null"?null:parseInt(x)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:n("generate.form.subscription_none")})}),e.jsxs(J,{children:[e.jsx(U,{value:"null",children:n("generate.form.subscription_none")}),c.map(x=>e.jsx(U,{value:x.id.toString(),children:x.name},x.id))]})]})})]})}),!r.watch("email_prefix")&&e.jsx(b,{control:r.control,name:"generate_count",render:({field:u})=>e.jsxs(v,{children:[e.jsx(y,{children:n("generate.form.generate_count")}),e.jsx(D,{type:"number",placeholder:n("generate.form.generate_count_placeholder"),value:u.value||"",onChange:x=>u.onChange(x.target.value?parseInt(x.target.value):null)})]})})]}),e.jsxs(Me,{children:[e.jsx(G,{variant:"outline",onClick:()=>l(!1),children:n("generate.form.cancel")}),e.jsx(G,{onClick:()=>r.handleSubmit(u=>{xd(u).then(({data:x})=>{x&&($.success(n("generate.form.success")),r.reset(),s(),l(!1))})})(),children:n("generate.form.submit")})]})]})]})}const ll=Nn,il=_n,jh=wn,ol=m.forwardRef(({className:s,...n},a)=>e.jsx($t,{className:N("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a}));ol.displayName=$t.displayName;const vh=Ls("fixed overflow-y-scroll  z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-md",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-md"}},defaultVariants:{side:"right"}}),$a=m.forwardRef(({side:s="right",className:n,children:a,...l},r)=>e.jsxs(jh,{children:[e.jsx(ol,{}),e.jsxs(qt,{ref:r,className:N(vh({side:s}),n),...l,children:[e.jsxs(Sa,{className:"absolute right-4 top-4  rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),a]})]}));$a.displayName=qt.displayName;const qa=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col space-y-2 text-center sm:text-left",s),...n});qa.displayName="SheetHeader";const cl=({className:s,...n})=>e.jsx("div",{className:N("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...n});cl.displayName="SheetFooter";const Ua=m.forwardRef(({className:s,...n},a)=>e.jsx(Ut,{ref:a,className:N("text-lg font-semibold text-foreground",s),...n}));Ua.displayName=Ut.displayName;const Ha=m.forwardRef(({className:s,...n},a)=>e.jsx(Ht,{ref:a,className:N("text-sm text-muted-foreground",s),...n}));Ha.displayName=Ht.displayName;function bh({table:s,refetch:n,permissionGroups:a=[],subscriptionPlans:l=[]}){const{t:r}=F("user"),{toast:c}=rl(),o=s.getState().columnFilters.length>0,[u,x]=m.useState([]),[i,d]=m.useState(!1),[p,w]=m.useState(!1),[P,f]=m.useState(!1),[j,C]=m.useState(!1),g=async()=>{try{const B=await Lt.dumpCSV({filter:s.getState().columnFilters,sort:s.getState().sorting[0]?.id,sort_type:s.getState().sorting[0]?.desc?"DESC":"ASC"}),ae=window.URL.createObjectURL(new Blob([B.data])),A=document.createElement("a");A.href=ae,A.setAttribute("download",`users_${new Date().toISOString()}.csv`),document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(ae),c({title:r("messages.success"),description:r("messages.export.success")})}catch{c({title:r("messages.error"),description:r("messages.export.failed"),variant:"destructive"})}},S=async()=>{try{C(!0),await Lt.batchBan({filter:s.getState().columnFilters,sort:s.getState().sorting[0]?.id,sort_type:s.getState().sorting[0]?.desc?"DESC":"ASC"}),c({title:r("messages.success"),description:r("messages.batch_ban.success")}),n()}catch{c({title:r("messages.error"),description:r("messages.batch_ban.failed"),variant:"destructive"})}finally{C(!1),f(!1)}},R=[{label:r("filter.fields.email"),value:"email",type:"text",operators:[{label:r("filter.operators.contains"),value:"contains"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.id"),value:"id",type:"number",operators:[{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.plan_id"),value:"plan_id",type:"select",operators:[{label:r("filter.operators.eq"),value:"eq"}],useOptions:!0},{label:r("filter.fields.transfer_enable"),value:"transfer_enable",type:"number",unit:"GB",operators:[{label:r("filter.operators.gt"),value:"gt"},{label:r("filter.operators.lt"),value:"lt"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.total_used"),value:"total_used",type:"number",unit:"GB",operators:[{label:r("filter.operators.gt"),value:"gt"},{label:r("filter.operators.lt"),value:"lt"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.online_count"),value:"online_count",type:"number",operators:[{label:r("filter.operators.eq"),value:"eq"},{label:r("filter.operators.gt"),value:"gt"},{label:r("filter.operators.lt"),value:"lt"}]},{label:r("filter.fields.expired_at"),value:"expired_at",type:"date",operators:[{label:r("filter.operators.lt"),value:"lt"},{label:r("filter.operators.gt"),value:"gt"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.uuid"),value:"uuid",type:"text",operators:[{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.token"),value:"token",type:"text",operators:[{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.banned"),value:"banned",type:"select",operators:[{label:r("filter.operators.eq"),value:"eq"}],options:[{label:r("filter.status.normal"),value:"0"},{label:r("filter.status.banned"),value:"1"}]},{label:r("filter.fields.remark"),value:"remark",type:"text",operators:[{label:r("filter.operators.contains"),value:"contains"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.inviter_email"),value:"inviter_email",type:"text",operators:[{label:r("filter.operators.contains"),value:"contains"},{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.invite_user_id"),value:"invite_user_id",type:"number",operators:[{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.is_admin"),value:"is_admin",type:"boolean",operators:[{label:r("filter.operators.eq"),value:"eq"}]},{label:r("filter.fields.is_staff"),value:"is_staff",type:"boolean",operators:[{label:r("filter.operators.eq"),value:"eq"}]}],E=B=>B*1024*1024*1024,O=B=>B/(1024*1024*1024),q=()=>{x([...u,{field:"",operator:"",value:""}])},te=B=>{x(u.filter((ae,A)=>A!==B))},M=(B,ae,A)=>{const V=[...u];if(V[B]={...V[B],[ae]:A},ae==="field"){const Y=R.find(ne=>ne.value===A);Y&&(V[B].operator=Y.operators[0].value,V[B].value=Y.type==="boolean"?!1:"")}x(V)},se=(B,ae)=>{const A=R.find(V=>V.value===B.field);if(!A)return null;switch(A.type){case"text":return e.jsx(D,{placeholder:r("filter.sheet.value"),value:B.value,onChange:V=>M(ae,"value",V.target.value)});case"number":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{type:"number",placeholder:r("filter.sheet.value_number",{unit:A.unit}),value:A.unit==="GB"?O(B.value||0):B.value,onChange:V=>{const Y=Number(V.target.value);M(ae,"value",A.unit==="GB"?E(Y):Y)}}),A.unit&&e.jsx("span",{className:"text-sm text-muted-foreground",children:A.unit})]});case"date":return e.jsx(Bs,{mode:"single",selected:B.value,onSelect:V=>M(ae,"value",V),className:"rounded-md border"});case"select":return e.jsxs(X,{value:B.value,onValueChange:V=>M(ae,"value",V),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:r("filter.sheet.value")})}),e.jsx(J,{children:A.useOptions?l.map(V=>e.jsx(U,{value:V.value.toString(),children:V.label},V.value)):A.options?.map(V=>e.jsx(U,{value:V.value.toString(),children:V.label},V.value))})]});case"boolean":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{checked:B.value,onCheckedChange:V=>M(ae,"value",V)}),e.jsx(Mt,{children:B.value?r("filter.boolean.true"):r("filter.boolean.false")})]});default:return null}},qe=()=>{const B=u.filter(ae=>ae.field&&ae.operator&&ae.value!=="").map(ae=>{const A=R.find(Y=>Y.value===ae.field);let V=ae.value;return ae.operator==="contains"?{id:ae.field,value:V}:(A?.type==="date"&&V instanceof Date&&(V=Math.floor(V.getTime()/1e3)),A?.type==="boolean"&&(V=V?1:0),{id:ae.field,value:`${ae.operator}:${V}`})});s.setColumnFilters(B),d(!1)};return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-2",children:[e.jsx(gh,{refetch:n}),e.jsx(D,{placeholder:r("filter.email_search"),value:s.getColumn("email")?.getFilterValue()??"",onChange:B=>s.getColumn("email")?.setFilterValue(B.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs(ll,{open:i,onOpenChange:d,children:[e.jsx(il,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Wo,{className:"mr-2 h-4 w-4"}),r("filter.advanced"),u.length>0&&e.jsx(K,{variant:"secondary",className:"ml-2 rounded-sm px-1",children:u.length})]})}),e.jsxs($a,{className:"w-[400px] sm:w-[540px]",children:[e.jsxs(qa,{children:[e.jsx(Ua,{children:r("filter.sheet.title")}),e.jsx(Ha,{children:r("filter.sheet.description")})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:r("filter.sheet.conditions")}),e.jsx(T,{variant:"outline",size:"sm",onClick:q,children:r("filter.sheet.add")})]}),e.jsx(zs,{className:"h-[calc(100vh-280px)] pr-4",children:e.jsx("div",{className:"space-y-4",children:u.map((B,ae)=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Mt,{children:r("filter.sheet.condition",{number:ae+1})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>te(ae),children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsxs(X,{value:B.field,onValueChange:A=>M(ae,"field",A),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:r("filter.sheet.field")})}),e.jsx(J,{children:R.map(A=>e.jsx(U,{value:A.value,children:A.label},A.value))})]}),B.field&&e.jsxs(X,{value:B.operator,onValueChange:A=>M(ae,"operator",A),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:r("filter.sheet.operator")})}),e.jsx(J,{children:R.find(A=>A.value===B.field)?.operators.map(A=>e.jsx(U,{value:A.value,children:A.label},A.value))})]}),B.field&&B.operator&&se(B,ae)]},ae))})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(T,{variant:"outline",onClick:()=>{x([]),d(!1)},children:r("filter.sheet.reset")}),e.jsx(T,{onClick:qe,children:r("filter.sheet.apply")})]})]})]})]}),o&&e.jsxs(T,{variant:"ghost",onClick:()=>{s.resetColumnFilters(),x([])},className:"h-8 px-2 lg:px-3",children:[r("reset"),e.jsx(Ze,{className:"ml-2 h-4 w-4"})]}),e.jsxs(ws,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(T,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:r("actions.title")})}),e.jsxs(xs,{children:[e.jsx(ge,{onClick:()=>w(!0),children:r("actions.send_email")}),e.jsx(ge,{onClick:g,children:r("actions.export_csv")}),e.jsx(et,{}),e.jsx(ge,{onClick:()=>f(!0),className:"text-red-600 focus:text-red-600",children:r("actions.batch_ban")})]})]})]}),e.jsx(hh,{open:p,onOpenChange:w,table:s}),e.jsx(za,{open:P,onOpenChange:f,children:e.jsxs(Qt,{children:[e.jsxs(Jt,{children:[e.jsx(Xt,{children:r("actions.confirm_ban.title")}),e.jsx(ea,{children:r(o?"actions.confirm_ban.filtered_description":"actions.confirm_ban.all_description")})]}),e.jsxs(Zt,{children:[e.jsx(ta,{disabled:j,children:r("actions.confirm_ban.cancel")}),e.jsx(sa,{onClick:S,disabled:j,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:r(j?"actions.confirm_ban.banning":"actions.confirm_ban.confirm")})]})]})})]})}const yh=h.object({id:h.number(),email:h.string().email(),invite_user_email:h.string().email().nullable().optional(),password:h.string().optional().nullable(),balance:h.coerce.number(),commission_balance:h.coerce.number(),u:h.number(),d:h.number(),transfer_enable:h.number(),expired_at:h.number().nullable(),plan_id:h.number().nullable(),banned:h.number(),commission_type:h.number(),commission_rate:h.number().nullable(),discount:h.number().nullable(),speed_limit:h.number().nullable(),device_limit:h.number().nullable(),is_admin:h.number(),is_staff:h.number(),remarks:h.string().nullable()}),dl=m.createContext(void 0);function Nh({children:s,defaultValues:n,open:a,onOpenChange:l}){const[r,c]=m.useState(!1),[o,u]=m.useState(!1),[x,i]=m.useState([]),d=fe({resolver:ye(yh),defaultValues:n,mode:"onChange"});m.useEffect(()=>{a!==void 0&&c(a)},[a]);const p=w=>{c(w),l?.(w)};return e.jsx(dl.Provider,{value:{form:d,formOpen:r,setFormOpen:p,datePickerOpen:o,setDatePickerOpen:u,planList:x,setPlanList:i},children:s})}function _h(){const s=m.useContext(dl);if(!s)throw new Error("useUserForm must be used within a UserFormProvider");return s}function wh({refetch:s}){const{t:n}=F("user"),{form:a,formOpen:l,setFormOpen:r,datePickerOpen:c,setDatePickerOpen:o,planList:u,setPlanList:x}=_h();return m.useEffect(()=>{l&&Us().then(({data:i})=>{x(i)})},[l,x]),e.jsxs(Ne,{...a,children:[e.jsx(b,{control:a.control,name:"email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.email")}),e.jsx(_,{children:e.jsx(D,{...i,placeholder:n("edit.form.email_placeholder")})}),e.jsx(k,{...i})]})}),e.jsx(b,{control:a.control,name:"invite_user_email",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.inviter_email")}),e.jsx(_,{children:e.jsx(D,{value:i.value||"",onChange:d=>i.onChange(d.target.value?d.target.value:null),placeholder:n("edit.form.inviter_email_placeholder")})}),e.jsx(k,{...i})]})}),e.jsx(b,{control:a.control,name:"password",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.password")}),e.jsx(_,{children:e.jsx(D,{value:i.value||"",onChange:i.onChange,placeholder:n("edit.form.password_placeholder")})}),e.jsx(k,{...i})]})}),e.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[e.jsx(b,{control:a.control,name:"balance",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.balance")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:i.onChange,placeholder:n("edit.form.balance_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]})}),e.jsx(k,{...i})]})}),e.jsx(b,{control:a.control,name:"commission_balance",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.commission_balance")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:i.onChange,placeholder:n("edit.form.commission_balance_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"¥"})]})}),e.jsx(k,{...i})]})}),e.jsx(b,{control:a.control,name:"u",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.upload")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{value:i.value/1024/1024/1024||"",onChange:d=>i.onChange(parseInt(d.target.value)*1024*1024*1024),placeholder:n("edit.form.upload_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(k,{...i})]})}),e.jsx(b,{control:a.control,name:"d",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.download")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value/1024/1024/1024||"",onChange:d=>i.onChange(parseInt(d.target.value)*1024*1024*1024),placeholder:n("edit.form.download_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(k,{...i})]})})]}),e.jsx(b,{control:a.control,name:"transfer_enable",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.total_traffic")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value/1024/1024/1024||"",onChange:d=>i.onChange(parseInt(d.target.value)*1024*1024*1024),placeholder:n("edit.form.total_traffic_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"GB"})]})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"expired_at",render:({field:i})=>e.jsxs(v,{className:"flex flex-col",children:[e.jsx(y,{children:n("edit.form.expire_time")}),e.jsxs(fs,{open:c,onOpenChange:o,children:[e.jsx(gs,{asChild:!0,children:e.jsx(_,{children:e.jsxs(T,{type:"button",variant:"outline",className:N("w-full pl-3 text-left font-normal",!i.value&&"text-muted-foreground"),onClick:()=>o(!0),children:[i.value?_e(i.value):e.jsx("span",{children:n("edit.form.expire_time_placeholder")}),e.jsx(jt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(ds,{className:"w-auto p-0",align:"start",side:"top",sideOffset:4,onInteractOutside:d=>{d.preventDefault()},onEscapeKeyDown:d=>{d.preventDefault()},children:e.jsxs("div",{className:"flex flex-col space-y-3 p-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{i.onChange(null),o(!1)},children:n("edit.form.expire_time_permanent")}),e.jsx(T,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const d=new Date;d.setMonth(d.getMonth()+1),d.setHours(23,59,59,999),i.onChange(Math.floor(d.getTime()/1e3)),o(!1)},children:n("edit.form.expire_time_1month")}),e.jsx(T,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{const d=new Date;d.setMonth(d.getMonth()+3),d.setHours(23,59,59,999),i.onChange(Math.floor(d.getTime()/1e3)),o(!1)},children:n("edit.form.expire_time_3months")})]}),e.jsx("div",{className:"rounded-md border",children:e.jsx(Bs,{mode:"single",selected:i.value?new Date(i.value*1e3):void 0,onSelect:d=>{if(d){const p=new Date(i.value?i.value*1e3:Date.now());d.setHours(p.getHours(),p.getMinutes(),p.getSeconds()),i.onChange(Math.floor(d.getTime()/1e3))}},disabled:d=>d<new Date,initialFocus:!0,className:"rounded-md border-none"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:n("edit.form.expire_time_specific")}),e.jsx(T,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const d=new Date;d.setHours(23,59,59,999),i.onChange(Math.floor(d.getTime()/1e3))},className:"h-6 px-2 text-xs",children:n("edit.form.expire_time_today")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"datetime-local",step:"1",value:_e(i.value,"YYYY-MM-DDTHH:mm:ss"),onChange:d=>{const p=new Date(d.target.value);isNaN(p.getTime())||i.onChange(Math.floor(p.getTime()/1e3))},className:"flex-1"}),e.jsx(T,{type:"button",variant:"outline",onClick:()=>o(!1),children:n("edit.form.expire_time_confirm")})]})]})]})})]}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"plan_id",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.subscription")}),e.jsx(_,{children:e.jsxs(X,{value:i.value?i.value.toString():"null",onValueChange:d=>i.onChange(d==="null"?null:parseInt(d)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:n("edit.form.subscription_none")})}),e.jsxs(J,{children:[e.jsx(U,{value:"null",children:n("edit.form.subscription_none")}),u.map(d=>e.jsx(U,{value:d.id.toString(),children:d.name},d.id))]})]})})]})}),e.jsx(b,{control:a.control,name:"banned",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.account_status")}),e.jsx(_,{children:e.jsxs(X,{value:i.value.toString(),onValueChange:d=>i.onChange(parseInt(d)),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(J,{children:[e.jsx(U,{value:"1",children:n("columns.status_text.banned")}),e.jsx(U,{value:"0",children:n("columns.status_text.normal")})]})]})})]})}),e.jsx(b,{control:a.control,name:"commission_type",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.commission_type")}),e.jsx(_,{children:e.jsxs(X,{value:i.value.toString(),onValueChange:d=>i.onChange(parseInt(d)),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:n("edit.form.subscription_none")})}),e.jsxs(J,{children:[e.jsx(U,{value:"0",children:n("edit.form.commission_type_system")}),e.jsx(U,{value:"1",children:n("edit.form.commission_type_cycle")}),e.jsx(U,{value:"2",children:n("edit.form.commission_type_onetime")})]})]})})]})}),e.jsx(b,{control:a.control,name:"commission_rate",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.commission_rate")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:d=>i.onChange(parseInt(d.currentTarget.value)||null),placeholder:n("edit.form.commission_rate_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]})})]})}),e.jsx(b,{control:a.control,name:"discount",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.discount")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:d=>i.onChange(parseInt(d.currentTarget.value)||null),placeholder:n("edit.form.discount_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"%"})]})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"speed_limit",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.speed_limit")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:d=>i.onChange(parseInt(d.currentTarget.value)||null),placeholder:n("edit.form.speed_limit_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"Mbps"})]})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"device_limit",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.device_limit")}),e.jsx(_,{children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{type:"number",value:i.value||"",onChange:d=>i.onChange(parseInt(d.currentTarget.value)||null),placeholder:n("edit.form.device_limit_placeholder"),className:"rounded-r-none"}),e.jsx("div",{className:"z-[-1] rounded-md rounded-l-none border border-l-0 border-input px-3 py-1 shadow-sm",children:"台"})]})}),e.jsx(k,{})]})}),e.jsx(b,{control:a.control,name:"is_admin",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.is_admin")}),e.jsx("div",{className:"py-2",children:e.jsx(_,{children:e.jsx(W,{checked:i.value===1,onCheckedChange:d=>i.onChange(d?1:0)})})})]})}),e.jsx(b,{control:a.control,name:"is_staff",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.is_staff")}),e.jsx("div",{className:"py-2",children:e.jsx(_,{children:e.jsx(W,{checked:i.value===1,onCheckedChange:d=>i.onChange(d?1:0)})})})]})}),e.jsx(b,{control:a.control,name:"remarks",render:({field:i})=>e.jsxs(v,{children:[e.jsx(y,{children:n("edit.form.remarks")}),e.jsx(_,{children:e.jsx(js,{className:"h-24",value:i.value||"",onChange:d=>i.onChange(d.currentTarget.value??null),placeholder:n("edit.form.remarks_placeholder")})}),e.jsx(k,{})]})}),e.jsxs(cl,{children:[e.jsx(T,{variant:"outline",onClick:()=>r(!1),children:n("edit.form.cancel")}),e.jsx(T,{type:"submit",onClick:()=>{a.handleSubmit(i=>{ud(i).then(({data:d})=>{d&&($.success(n("edit.form.success")),r(!1),s())})})()},children:n("edit.form.submit")})]})]})}function ul({refetch:s,defaultValues:n,dialogTrigger:a=e.jsxs(T,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),t("edit.button")]})}){const{t:l}=F("user"),[r,c]=m.useState(!1);return e.jsx(Nh,{defaultValues:n,open:r,onOpenChange:c,children:e.jsxs(ll,{open:r,onOpenChange:c,children:[e.jsx(il,{asChild:!0,children:a}),e.jsxs($a,{className:"max-w-[90%] space-y-4",children:[e.jsxs(qa,{children:[e.jsx(Ua,{children:l("edit.title")}),e.jsx(Ha,{})]}),e.jsx(wh,{refetch:s})]})]})})}const ml=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m17.71 11.29l-5-5a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21l-5 5a1 1 0 0 0 1.42 1.42L11 9.41V17a1 1 0 0 0 2 0V9.41l3.29 3.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42"})}),xl=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.71 11.29a1 1 0 0 0-1.42 0L13 14.59V7a1 1 0 0 0-2 0v7.59l-3.29-3.3a1 1 0 0 0-1.42 1.42l5 5a1 1 0 0 0 .33.21a.94.94 0 0 0 .76 0a1 1 0 0 0 .33-.21l5-5a1 1 0 0 0 0-1.42"})}),Ch=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17 11H9.41l3.3-3.29a1 1 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33a1 1 0 0 0 0 .76a1 1 0 0 0 .21.33l5 5a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42L9.41 13H17a1 1 0 0 0 0-2"})}),Sh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M17.92 11.62a1 1 0 0 0-.21-.33l-5-5a1 1 0 0 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l5-5a1 1 0 0 0 .21-.33a1 1 0 0 0 0-.76"})}),ha=[{accessorKey:"record_at",header:"时间",cell:({row:s})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("time",{className:"text-sm text-muted-foreground",children:mc(s.original.record_at)})})},{accessorKey:"u",header:"上行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ml,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"font-mono text-sm",children:ms(s.original.u)})]})},{accessorKey:"d",header:"下行流量",cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xl,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-mono text-sm",children:ms(s.original.d)})]})},{accessorKey:"server_rate",header:"倍率",cell:({row:s})=>{const n=s.original.server_rate;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(K,{variant:"outline",className:"font-mono",children:[n,"x"]})})}},{id:"total",header:"总计",cell:({row:s})=>{const n=s.original.u+s.original.d;return e.jsx("div",{className:"flex items-center justify-end font-mono text-sm",children:ms(n)})}}];function hl({user_id:s,dialogTrigger:n}){const{t:a}=F(["traffic"]),[l,r]=m.useState(!1),[c,o]=m.useState({pageIndex:0,pageSize:20}),{data:u,isLoading:x}=ie({queryKey:["userStats",s,c,l],queryFn:()=>l?hd({user_id:s,pageSize:c.pageSize,page:c.pageIndex+1}):null}),i=ss({data:u?.data??[],columns:ha,pageCount:Math.ceil((u?.total??0)/c.pageSize),state:{pagination:c},manualPagination:!0,getCoreRowModel:ts(),onPaginationChange:o});return e.jsxs(ve,{open:l,onOpenChange:r,children:[e.jsx(We,{asChild:!0,children:n}),e.jsxs(pe,{className:"sm:max-w-[700px]",children:[e.jsx(we,{children:e.jsx(be,{children:a("trafficRecord.title")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Va,{children:[e.jsx(Fa,{children:i.getHeaderGroups().map(d=>e.jsx(Rs,{children:d.headers.map(p=>e.jsx(Ma,{className:N("h-10 px-2 text-xs",p.id==="total"&&"text-right"),children:p.isPlaceholder?null:Vt(p.column.columnDef.header,p.getContext())},p.id))},d.id))}),e.jsx(Oa,{children:x?Array.from({length:c.pageSize}).map((d,p)=>e.jsx(Rs,{children:Array.from({length:ha.length}).map((w,P)=>e.jsx(Js,{className:"p-2",children:e.jsx(oe,{className:"h-6 w-full"})},P))},p)):i.getRowModel().rows?.length?i.getRowModel().rows.map(d=>e.jsx(Rs,{"data-state":d.getIsSelected()&&"selected",className:"h-10",children:d.getVisibleCells().map(p=>e.jsx(Js,{className:"px-2",children:Vt(p.column.columnDef.cell,p.getContext())},p.id))},d.id)):e.jsx(Rs,{children:e.jsx(Js,{colSpan:ha.length,className:"h-24 text-center",children:a("trafficRecord.noRecords")})})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:a("trafficRecord.perPage")}),e.jsxs(X,{value:`${i.getState().pagination.pageSize}`,onValueChange:d=>{i.setPageSize(Number(d))},children:[e.jsx(Q,{className:"h-8 w-[70px]",children:e.jsx(ee,{placeholder:i.getState().pagination.pageSize})}),e.jsx(J,{side:"top",children:[10,20,30,40,50].map(d=>e.jsx(U,{value:`${d}`,children:d},d))})]}),e.jsx("p",{className:"text-sm font-medium",children:a("trafficRecord.records")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex w-[100px] items-center justify-center text-sm",children:a("trafficRecord.page",{current:i.getState().pagination.pageIndex+1,total:i.getPageCount()})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage()||x,children:e.jsx(Ch,{className:"h-4 w-4"})}),e.jsx(G,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage()||x,children:e.jsx(Sh,{className:"h-4 w-4"})})]})]})]})]})]})]})}function kh({onConfirm:s,children:n,title:a="确认操作",description:l="确定要执行此操作吗？",cancelText:r="取消",confirmText:c="确认",variant:o="default",className:u}){return e.jsxs(za,{children:[e.jsx(Kr,{asChild:!0,children:n}),e.jsxs(Qt,{className:N("sm:max-w-[425px]",u),children:[e.jsxs(Jt,{children:[e.jsx(Xt,{children:a}),e.jsx(ea,{children:l})]}),e.jsxs(Zt,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(T,{variant:"outline",children:r})}),e.jsx(sa,{asChild:!0,children:e.jsx(T,{variant:o,onClick:s,children:c})})]})]})]})}const Th=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M5 18h4.24a1 1 0 0 0 .71-.29l6.92-6.93L19.71 8a1 1 0 0 0 0-1.42l-4.24-4.29a1 1 0 0 0-1.42 0l-2.82 2.83l-6.94 6.93a1 1 0 0 0-.29.71V17a1 1 0 0 0 1 1m9.76-13.59l2.83 2.83l-1.42 1.42l-2.83-2.83ZM6 13.17l5.93-5.93l2.83 2.83L8.83 16H6ZM21 20H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"})}),Dh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11h-6V5a1 1 0 0 0-2 0v6H5a1 1 0 0 0 0 2h6v6a1 1 0 0 0 2 0v-6h6a1 1 0 0 0 0-2"})}),Ph=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 8.94a1.3 1.3 0 0 0-.06-.27v-.09a1 1 0 0 0-.19-.28l-6-6a1 1 0 0 0-.28-.19a.3.3 0 0 0-.09 0a.9.9 0 0 0-.33-.11H10a3 3 0 0 0-3 3v1H6a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-1h1a3 3 0 0 0 3-3zm-6-3.53L17.59 8H16a1 1 0 0 1-1-1ZM15 19a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h1v7a3 3 0 0 0 3 3h5Zm4-4a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3v3a3 3 0 0 0 3 3h3Z"})}),Eh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21 11a1 1 0 0 0-1 1a8.05 8.05 0 1 1-2.22-5.5h-2.4a1 1 0 0 0 0 2h4.53a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1.77A10 10 0 1 0 22 12a1 1 0 0 0-1-1"})}),Rh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9.5 10.5H12a1 1 0 0 0 0-2h-1V8a1 1 0 0 0-2 0v.55a2.5 2.5 0 0 0 .5 4.95h1a.5.5 0 0 1 0 1H8a1 1 0 0 0 0 2h1v.5a1 1 0 0 0 2 0v-.55a2.5 2.5 0 0 0-.5-4.95h-1a.5.5 0 0 1 0-1M21 12h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Z"})}),Ih=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12.3 12.22A4.92 4.92 0 0 0 14 8.5a5 5 0 0 0-10 0a4.92 4.92 0 0 0 1.7 3.72A8 8 0 0 0 1 19.5a1 1 0 0 0 2 0a6 6 0 0 1 12 0a1 1 0 0 0 2 0a8 8 0 0 0-4.7-7.28M9 11.5a3 3 0 1 1 3-3a3 3 0 0 1-3 3m9.74.32A5 5 0 0 0 15 3.5a1 1 0 0 0 0 2a3 3 0 0 1 3 3a3 3 0 0 1-1.5 2.59a1 1 0 0 0-.5.84a1 1 0 0 0 .45.86l.39.26l.13.07a7 7 0 0 1 4 6.38a1 1 0 0 0 2 0a9 9 0 0 0-4.23-7.68"})}),Vh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M12 2a10 10 0 0 0-6.88 2.77V3a1 1 0 0 0-2 0v4.5a1 1 0 0 0 1 1h4.5a1 1 0 0 0 0-2h-2.4A8 8 0 1 1 4 12a1 1 0 0 0-2 0A10 10 0 1 0 12 2m0 6a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h2a1 1 0 0 0 0-2h-1V9a1 1 0 0 0-1-1"})}),Fh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M20 6h-4V5a3 3 0 0 0-3-3h-2a3 3 0 0 0-3 3v1H4a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3V8h1a1 1 0 0 0 0-2M10 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1h-4Zm7 14a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8h10Z"})}),Oh=(s,n)=>{const{t:a}=F("user");return[{accessorKey:"is_admin",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.is_admin")}),enableSorting:!1,enableHiding:!0,filterFn:(l,r,c)=>c.includes(l.getValue(r)),size:0},{accessorKey:"is_staff",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.is_staff")}),enableSorting:!1,enableHiding:!0,filterFn:(l,r,c)=>c.includes(l.getValue(r)),size:0},{accessorKey:"id",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.id")}),cell:({row:l})=>e.jsx(K,{variant:"outline",children:l.original.id}),enableSorting:!0,enableHiding:!1},{accessorKey:"email",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.email")}),cell:({row:l})=>{const r=l.original.t||0,c=Date.now()/1e3-r<120,o=Math.floor(Date.now()/1e3-r);let u=c?a("columns.online_status.online"):r===0?a("columns.online_status.never"):a("columns.online_status.last_online",{time:_e(r)});if(!c&&r!==0){const x=Math.floor(o/60),i=Math.floor(x/60),d=Math.floor(i/24);d>0?u+=`
`+a("columns.online_status.offline_duration.days",{count:d}):i>0?u+=`
`+a("columns.online_status.offline_duration.hours",{count:i}):x>0?u+=`
`+a("columns.online_status.offline_duration.minutes",{count:x}):u+=`
`+a("columns.online_status.offline_duration.seconds",{count:o})}return e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:N("size-2.5 rounded-full ring-2 ring-offset-2",c?"bg-green-500 ring-green-500/20":"bg-gray-300 ring-gray-300/20","transition-all duration-300")}),e.jsx("span",{className:"font-medium text-foreground/90",children:l.original.email})]})}),e.jsx(ce,{side:"bottom",className:"max-w-[280px]",children:e.jsx("p",{className:"whitespace-pre-line text-sm",children:u})})]})})},enableSorting:!1,enableHiding:!1},{accessorKey:"online_count",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.online_count")}),cell:({row:l})=>{const r=l.original.device_limit,c=l.original.online_count||0;return e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsxs(K,{variant:"outline",className:N("min-w-[4rem] justify-center",r!==null&&c>=r?"border-destructive/50 bg-destructive/10 text-destructive":"border-primary/40 bg-primary/5 text-primary/90"),children:[c," / ",r===null?"∞":r]})})}),e.jsx(ce,{side:"bottom",children:e.jsx("p",{className:"text-sm",children:r===null?a("columns.device_limit.unlimited"):a("columns.device_limit.limited",{count:r})})})]})})},enableSorting:!0,enableHiding:!1},{accessorKey:"banned",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.status")}),cell:({row:l})=>{const r=l.original.banned;return e.jsx("div",{className:"flex justify-center",children:e.jsx(K,{className:N("min-w-20 justify-center transition-colors",r?"bg-destructive/15 text-destructive hover:bg-destructive/25":"bg-success/15 text-success hover:bg-success/25"),children:a(r?"columns.status_text.banned":"columns.status_text.normal")})})},enableSorting:!0,filterFn:(l,r,c)=>c.includes(l.getValue(r))},{accessorKey:"plan_id",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.subscription")}),cell:({row:l})=>e.jsx("div",{className:"min-w-[10em] break-all",children:l.original?.plan?.name||"-"}),enableSorting:!1,enableHiding:!1},{accessorKey:"group_id",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.group")}),cell:({row:l})=>e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx(K,{variant:"outline",className:N("px-2 py-0.5 font-medium","bg-secondary/50 hover:bg-secondary/70","border border-border/50","transition-all duration-200","cursor-default select-none","flex items-center gap-1.5 whitespace-nowrap"),children:l.original?.group?.name||"-"})}),enableSorting:!1},{accessorKey:"total_used",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.used_traffic")}),cell:({row:l})=>{const r=ms(l.original?.total_used),c=ms(l.original?.transfer_enable),o=l.original?.total_used/l.original?.transfer_enable*100||0;return e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{className:"w-full",children:e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:r}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[o.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full rounded-full bg-secondary",children:e.jsx("div",{className:N("h-full rounded-full transition-all",o>90?"bg-destructive":"bg-primary"),style:{width:`${Math.min(o,100)}%`}})})]})}),e.jsx(ce,{side:"bottom",children:e.jsxs("p",{className:"text-sm",children:[a("columns.total_traffic"),": ",c]})})]})})}},{accessorKey:"transfer_enable",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.total_traffic")}),cell:({row:l})=>e.jsx("div",{className:"font-medium text-muted-foreground",children:ms(l.original?.transfer_enable)})},{accessorKey:"expired_at",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.expire_time")}),cell:({row:l})=>{const r=l.original.expired_at,c=Date.now()/1e3,o=r!=null&&r<c,u=r!=null?new Date(r*1e3):null,x=u!=null?Math.ceil((u.getTime()-Date.now())/(1e3*60*60*24)):null;return e.jsx(je,{delayDuration:100,children:e.jsxs(xe,{children:[e.jsx(he,{className:"block w-full",children:e.jsx(K,{variant:"outline",className:N("w-full justify-center transition-colors",o?"border-destructive/50 bg-destructive/10 text-destructive":r?"border-success/50 bg-success/10 text-success":"border-primary/40 bg-primary/5 text-primary/90"),children:r==null?a("columns.expire_status.permanent"):_e(r,"YYYY-MM-DD")})}),e.jsx(ce,{side:"bottom",className:"space-y-1 p-3",children:r!=null?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a("columns.expire_time"),": ",_e(r)]}),e.jsx("p",{className:N("text-sm font-medium",o?"text-destructive":"text-success"),children:o?a("columns.expire_status.expired",{days:Math.abs(x??0)}):a("columns.expire_status.remaining",{days:x??0})})]}):e.jsx("p",{className:"text-sm font-medium",children:a("columns.expire_status.permanent")})})]})})}},{accessorKey:"balance",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.balance")}),cell:({row:l})=>{const r=Qs(l.original?.balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:r})]})}},{accessorKey:"commission_balance",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.commission")}),cell:({row:l})=>{const r=Qs(l.original?.commission_balance);return e.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"¥"}),e.jsx("span",{className:"tabular-nums text-foreground",children:r})]})}},{accessorKey:"created_at",header:({column:l})=>e.jsx(L,{column:l,title:a("columns.register_time")}),cell:({row:l})=>e.jsx("div",{className:"truncate",children:_e(l.original?.created_at)}),size:1e3},{id:"actions",header:({column:l})=>e.jsx(L,{column:l,className:"justify-end",title:a("columns.actions")}),cell:({row:l,table:r})=>e.jsxs(ws,{modal:!0,children:[e.jsx(Cs,{asChild:!0,children:e.jsx("div",{className:"text-center",children:e.jsx(G,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-muted","aria-label":a("columns.actions"),children:e.jsx(Ot,{className:"size-4"})})})}),e.jsxs(xs,{align:"end",className:"min-w-[40px]",children:[e.jsx(ge,{onSelect:c=>{c.preventDefault()},className:"p-0",children:e.jsx(ul,{defaultValues:{...l.original,invite_user_email:l.original.invite_user?.email},refetch:s,dialogTrigger:e.jsxs(G,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Th,{className:"mr-2"}),a("columns.actions_menu.edit")]})})}),e.jsx(ge,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(tl,{defaultValues:{email:l.original.email},trigger:e.jsxs(G,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Dh,{className:"mr-2 "}),a("columns.actions_menu.assign_order")]})})}),e.jsx(ge,{onSelect:()=>{zt(l.original.subscribe_url).then(()=>{$.success(a("common:copy.success"))})},className:"p-0",children:e.jsxs(G,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Ph,{className:"mr-2"}),a("columns.actions_menu.copy_url")]})}),e.jsx(ge,{onSelect:()=>{md({id:l.original.id}).then(({data:c})=>{c&&$.success("重置成功")})},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Eh,{className:"mr-2 "}),a("columns.actions_menu.reset_secret")]})}),e.jsx(ge,{onSelect:()=>{},className:"p-0",children:e.jsxs($s,{className:"flex items-center px-2 py-1.5",to:`/finance/order?user_id=${l.original?.id}`,children:[e.jsx(Rh,{className:"mr-2"}),a("columns.actions_menu.orders")]})}),e.jsx(ge,{onSelect:()=>{r.setColumnFilters([{id:"invite_user_id",value:l.original?.id}])},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ih,{className:"mr-2 "}),a("columns.actions_menu.invites")]})}),e.jsx(ge,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(hl,{user_id:l.original?.id,dialogTrigger:e.jsxs(G,{variant:"ghost",className:"w-full justify-start px-2 py-1.5",children:[e.jsx(Vh,{className:"mr-2 "}),a("columns.actions_menu.traffic_records")]})})}),e.jsx(ge,{onSelect:c=>c.preventDefault(),className:"p-0",children:e.jsx(kh,{title:a("columns.actions_menu.delete_confirm_title"),description:a("columns.actions_menu.delete_confirm_description",{email:l.original.email}),cancelText:a("common:cancel"),confirmText:a("common:confirm"),variant:"destructive",onConfirm:async()=>{try{const{data:c}=await Lt.destroy(l.original.id);c&&($.success(a("common:delete.success")),s())}catch{$.error(a("common:delete.failed"))}},children:e.jsxs(G,{variant:"ghost",className:"w-full justify-start px-2 py-1.5 text-destructive hover:text-destructive",children:[e.jsx(Fh,{className:"mr-2"}),a("columns.actions_menu.delete")]})})})]})]})}]};function Mh(){const[s]=fr(),[n,a]=m.useState({}),[l,r]=m.useState({is_admin:!1,is_staff:!1}),[c,o]=m.useState([]),[u,x]=m.useState([]),[i,d]=m.useState({pageIndex:0,pageSize:20});m.useEffect(()=>{const O=s.get("email");O&&o(q=>q.some(M=>M.id==="email")?q:[...q,{id:"email",value:O}])},[s]);const{refetch:p,data:w,isLoading:P}=ie({queryKey:["userList",i,c,u],queryFn:()=>dd({pageSize:i.pageSize,current:i.pageIndex+1,filter:c,sort:u})}),[f,j]=m.useState([]),[C,g]=m.useState([]);m.useEffect(()=>{yt().then(({data:O})=>{j(O)}),Us().then(({data:O})=>{g(O)})},[]);const S=f.map(O=>({label:O.name,value:O.id})),R=C.map(O=>({label:O.name,value:O.id})),E=ss({data:w?.data??[],columns:Oh(p),state:{sorting:u,columnVisibility:l,rowSelection:n,columnFilters:c,pagination:i},rowCount:w?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:a,onSortingChange:x,onColumnFiltersChange:o,onColumnVisibilityChange:r,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),onPaginationChange:d,getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnVisibility:{commission_balance:!1,created_at:!1,is_admin:!1,is_staff:!1,permission_group:!1,plan_id:!1},columnPinning:{right:["actions"]}}});return e.jsx(us,{table:E,toolbar:e.jsx(bh,{table:E,refetch:p,serverGroupList:f,permissionGroups:S,subscriptionPlans:R})})}function zh(){const{t:s}=F("user");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("manage.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("manage.description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Mh,{})})})]})]})}const Lh=Object.freeze(Object.defineProperty({__proto__:null,default:zh},Symbol.toStringTag,{value:"Module"}));function Ah({column:s,title:n,options:a}){const l=new Set(s?.getFilterValue());return e.jsxs(fs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(G,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Yo,{className:"mr-2 h-4 w-4"}),n,l?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):a.filter(r=>l.has(r.value)).map(r=>e.jsx(K,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},`selected-${r.value}`))})]})]})}),e.jsx(ds,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Vs,{children:[e.jsx(Hs,{placeholder:n}),e.jsxs(Fs,{children:[e.jsx(Ks,{children:"No results found."}),e.jsx(Be,{children:a.map(r=>{const c=l.has(r.value);return e.jsxs(Ie,{onSelect:()=>{c?l.delete(r.value):l.add(r.value);const o=Array.from(l);s?.setFilterValue(o.length?o:void 0)},children:[e.jsx("div",{className:N("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Qo,{className:N("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label})]},`option-${r.value}`)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{}),e.jsx(Be,{children:e.jsx(Ie,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const $h=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 11H5a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})});function qh({table:s}){const{t:n}=F("ticket");return e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-4",children:[e.jsx(Wt,{defaultValue:s.getColumn("status")?.getFilterValue(),onValueChange:a=>s.getColumn("status")?.setFilterValue(a),children:e.jsxs(bt,{className:"grid w-full grid-cols-2",children:[e.jsx(He,{value:"0",children:n("status.pending")}),e.jsx(He,{value:"1",children:n("status.closed")})]})}),s.getColumn("level")&&e.jsx(Ah,{column:s.getColumn("level"),title:n("columns.level"),options:[{label:n("level.low"),value:Fe.LOW,icon:$h,color:"gray"},{label:n("level.medium"),value:Fe.MIDDLE,icon:ml,color:"yellow"},{label:n("level.high"),value:Fe.HIGH,icon:xl,color:"red"}]})]})})}function Uh(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[e.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:e.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const Hh=Ls("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),pl=m.forwardRef(({className:s,variant:n,layout:a,children:l,...r},c)=>e.jsx("div",{className:N(Hh({variant:n,layout:a,className:s}),"relative group"),ref:c,...r,children:m.Children.map(l,o=>m.isValidElement(o)&&typeof o.type!="string"?m.cloneElement(o,{variant:n,layout:a}):o)}));pl.displayName="ChatBubble";const Kh=Ls("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"bg-primary text-primary-foreground rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),fl=m.forwardRef(({className:s,variant:n,layout:a,isLoading:l=!1,children:r,...c},o)=>e.jsx("div",{className:N(Kh({variant:n,layout:a,className:s}),"break-words max-w-full whitespace-pre-wrap"),ref:o,...c,children:l?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Uh,{})}):r}));fl.displayName="ChatBubbleMessage";const Bh=m.forwardRef(({variant:s,className:n,children:a,...l},r)=>e.jsx("div",{ref:r,className:N("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",s==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",n),...l,children:a}));Bh.displayName="ChatBubbleActionWrapper";const gl=m.forwardRef(({className:s,...n},a)=>e.jsx(js,{autoComplete:"off",ref:a,name:"message",className:N("max-h-12 px-4 py-3 bg-background text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 w-full rounded-md flex items-center h-16 resize-none",s),...n}));gl.displayName="ChatInput";const jl=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29l-4.3 4.29a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0l4.29-4.3l4.29 4.3a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.42Z"})}),vl=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M15.098 12.634L13 11.423V7a1 1 0 0 0-2 0v5a1 1 0 0 0 .5.866l2.598 1.5a1 1 0 1 0 1-1.732M12 2a10 10 0 1 0 10 10A10.01 10.01 0 0 0 12 2m0 18a8 8 0 1 1 8-8a8.01 8.01 0 0 1-8 8"})}),pn=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"m11.29 12l3.54-3.54a1 1 0 0 0 0-1.41a1 1 0 0 0-1.42 0l-4.24 4.24a1 1 0 0 0 0 1.42L13.41 17a1 1 0 0 0 .71.29a1 1 0 0 0 .71-.29a1 1 0 0 0 0-1.41Z"})}),Gh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39M11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7"})}),Wh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M3.71 16.29a1 1 0 0 0-.33-.21a1 1 0 0 0-.76 0a1 1 0 0 0-.33.21a1 1 0 0 0-.21.33a1 1 0 0 0 .21 1.09a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1 1 0 0 0 .21-1.09a1 1 0 0 0-.21-.33M7 8h14a1 1 0 0 0 0-2H7a1 1 0 0 0 0 2m-3.29 3.29a1 1 0 0 0-1.09-.21a1.2 1.2 0 0 0-.33.21a1 1 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1 1 0 0 0-.21-.33M21 11H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2M3.71 6.29a1 1 0 0 0-.33-.21a1 1 0 0 0-1.09.21a1.2 1.2 0 0 0-.21.33a.94.94 0 0 0 0 .76a1.2 1.2 0 0 0 .21.33a1.2 1.2 0 0 0 .33.21a1 1 0 0 0 1.09-.21a1.2 1.2 0 0 0 .21-.33a.94.94 0 0 0 0-.76a1.2 1.2 0 0 0-.21-.33M21 16H7a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2"})}),Yh=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M9 12H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-1-2h4a1 1 0 0 0 0-2H8a1 1 0 0 0 0 2m1 6H7a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m12-4h-3V3a1 1 0 0 0-.5-.87a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0l-3 1.72l-3-1.72a1 1 0 0 0-1 0A1 1 0 0 0 2 3v16a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1M5 20a1 1 0 0 1-1-1V4.73l2 1.14a1.08 1.08 0 0 0 1 0l3-1.72l3 1.72a1.08 1.08 0 0 0 1 0l2-1.14V19a3 3 0 0 0 .18 1Zm15-1a1 1 0 0 1-2 0v-5h2Zm-6.44-2.83a.8.8 0 0 0-.18-.09a.6.6 0 0 0-.19-.06a1 1 0 0 0-.9.27A1.05 1.05 0 0 0 12 17a1 1 0 0 0 .07.38a1.2 1.2 0 0 0 .22.33a1.2 1.2 0 0 0 .33.21a.94.94 0 0 0 .76 0a1.2 1.2 0 0 0 .33-.21A1 1 0 0 0 14 17a1.05 1.05 0 0 0-.29-.71a2 2 0 0 0-.15-.12m.14-3.88a1 1 0 0 0-1.62.33A1 1 0 0 0 13 14a1 1 0 0 0 1-1a1 1 0 0 0-.08-.38a.9.9 0 0 0-.22-.33"})});function Qh(){return e.jsxs("div",{className:"flex h-full flex-col space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{className:"h-8 w-3/4"}),e.jsx(oe,{className:"h-4 w-1/2"})]}),e.jsx("div",{className:"flex-1 space-y-4",children:[1,2,3].map(s=>e.jsx(oe,{className:"h-20 w-2/3"},s))})]})}function Jh(){return e.jsx("div",{className:"space-y-4 p-4",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{className:"h-5 w-4/5"}),e.jsx(oe,{className:"h-4 w-2/3"}),e.jsx(oe,{className:"h-3 w-1/2"})]},s))})}function Zh({ticket:s,isActive:n,onClick:a}){const{t:l}=F("ticket"),r=c=>{switch(c){case Fe.HIGH:return"bg-red-50 text-red-600 border-red-200";case Fe.MIDDLE:return"bg-yellow-50 text-yellow-600 border-yellow-200";case Fe.LOW:return"bg-green-50 text-green-600 border-green-200";default:return"bg-gray-50 text-gray-600 border-gray-200"}};return e.jsxs("div",{className:N("flex cursor-pointer flex-col border-b p-4 hover:bg-accent/50",n&&"bg-accent"),onClick:a,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 max-w-[280px]",children:[e.jsx("h4",{className:"truncate font-medium flex-1",children:s.subject}),e.jsx(K,{variant:s.status===Is.CLOSED?"secondary":"default",className:"shrink-0",children:s.status===Is.CLOSED?l("status.closed"):l("status.processing")})]}),e.jsx("div",{className:"mt-1 text-sm text-muted-foreground truncate max-w-[280px]",children:s.user?.email}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs",children:[e.jsx("time",{className:"text-muted-foreground",children:_e(s.updated_at)}),e.jsx("div",{className:N("px-2 py-0.5 rounded-full border text-xs font-medium",r(s.level)),children:l(`level.${s.level===Fe.LOW?"low":s.level===Fe.MIDDLE?"medium":"high"}`)})]})]})}function Xh({ticketId:s,dialogTrigger:n}){const{t:a}=F("ticket"),l=Ss(),r=m.useRef(null),c=m.useRef(null),[o,u]=m.useState(!1),[x,i]=m.useState(""),[d,p]=m.useState(!1),[w,P]=m.useState(s),[f,j]=m.useState(""),[C,g]=m.useState(!1),{data:S,isLoading:R,refetch:E}=ie({queryKey:["tickets",o],queryFn:()=>o?ia.getList({filter:[{id:"status",value:[Is.OPENING]}]}):Promise.resolve(null),enabled:o}),{data:O,refetch:q,isLoading:te}=ie({queryKey:["ticket",w,o],queryFn:()=>o?fd(w):Promise.resolve(null),refetchInterval:o?5e3:!1,retry:3}),M=O?.data,qe=(S?.data||[]).filter(ne=>ne.subject.toLowerCase().includes(f.toLowerCase())||ne.user?.email.toLowerCase().includes(f.toLowerCase())),B=(ne="smooth")=>{if(r.current){const{scrollHeight:Ye,clientHeight:at}=r.current;r.current.scrollTo({top:Ye-at,behavior:ne})}};m.useEffect(()=>{if(!o)return;const ne=requestAnimationFrame(()=>{B("instant"),setTimeout(()=>B(),1e3)});return()=>{cancelAnimationFrame(ne)}},[o,M?.messages]);const ae=async()=>{const ne=x.trim();!ne||d||(p(!0),ia.reply({id:w,message:ne}).then(()=>{i(""),q(),B(),setTimeout(()=>{c.current?.focus()},0)}).finally(()=>{p(!1)}))},A=async()=>{ia.close(w).then(()=>{$.success(a("actions.close_success")),q(),E()})},V=()=>{M?.user&&l("/finance/order?user_id="+M.user.id)},Y=M?.status===Is.CLOSED;return e.jsxs(ve,{open:o,onOpenChange:u,children:[e.jsx(We,{asChild:!0,children:n??e.jsx(G,{variant:"outline",children:a("actions.view_ticket")})}),e.jsxs(pe,{className:"flex h-[90vh] max-w-6xl flex-col gap-0 p-0",children:[e.jsx(be,{}),e.jsxs("div",{className:"flex h-full",children:[e.jsx(G,{variant:"ghost",size:"icon",className:"absolute left-2 top-2 md:hidden z-50",onClick:()=>g(!C),children:e.jsx(pn,{className:N("h-4 w-4 transition-transform",!C&&"rotate-180")})}),e.jsxs("div",{className:N("absolute md:relative inset-y-0 left-0 z-40 flex flex-col border-r bg-background transition-transform duration-200 ease-in-out",C?"-translate-x-full":"translate-x-0","w-80 md:w-80 md:translate-x-0"),children:[e.jsxs("div",{className:"space-y-4 border-b p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:a("list.title")}),e.jsx(G,{variant:"ghost",size:"icon",className:"hidden md:flex h-8 w-8",onClick:()=>g(!C),children:e.jsx(pn,{className:N("h-4 w-4 transition-transform",!C&&"rotate-180")})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Gh,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"}),e.jsx(D,{placeholder:a("list.search_placeholder"),value:f,onChange:ne=>j(ne.target.value),className:"pl-8"})]})]}),e.jsx(zs,{className:"flex-1",children:e.jsx("div",{className:"w-full",children:R?e.jsx(Jh,{}):qe.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground p-4",children:a(f?"list.no_search_results":"list.no_tickets")}):qe.map(ne=>e.jsx(Zh,{ticket:ne,isActive:ne.id===w,onClick:()=>{P(ne.id),window.innerWidth<768&&g(!0)}},ne.id))})})]}),e.jsxs("div",{className:"flex-1 flex flex-col relative",children:[!C&&e.jsx("div",{className:"absolute inset-0 bg-black/20 z-30 md:hidden",onClick:()=>g(!0)}),te?e.jsx(Qh,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col space-y-4 border-b p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:M?.subject}),e.jsx(K,{variant:Y?"secondary":"default",children:a(Y?"status.closed":"status.processing")}),!Y&&e.jsx(Ge,{title:a("actions.close_confirm_title"),description:a("actions.close_confirm_description"),confirmText:a("actions.close_confirm_button"),variant:"destructive",onConfirm:A,children:e.jsxs(G,{variant:"ghost",size:"sm",className:"gap-1 text-muted-foreground hover:text-destructive",children:[e.jsx(jl,{className:"h-4 w-4"}),a("actions.close_ticket")]})})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{children:M?.user?.email})]}),e.jsx(Se,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(vl,{className:"h-4 w-4"}),e.jsxs("span",{children:[a("detail.created_at")," ",_e(M?.created_at)]})]}),e.jsx(Se,{orientation:"vertical",className:"h-4"}),e.jsx(K,{variant:"outline",children:M?.level!=null&&a(`level.${M.level===Fe.LOW?"low":M.level===Fe.MIDDLE?"medium":"high"}`)})]})]}),M?.user&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ul,{defaultValues:M.user,refetch:q,dialogTrigger:e.jsx(G,{variant:"outline",size:"icon",className:"h-8 w-8",title:a("detail.user_info"),children:e.jsx(gt,{className:"h-4 w-4"})})}),e.jsx(hl,{user_id:M.user.id,dialogTrigger:e.jsx(G,{variant:"outline",size:"icon",className:"h-8 w-8",title:a("detail.traffic_records"),children:e.jsx(Wh,{className:"h-4 w-4"})})}),e.jsx(G,{variant:"outline",size:"icon",className:"h-8 w-8",title:a("detail.order_records"),onClick:V,children:e.jsx(Yh,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{ref:r,className:"h-full space-y-4 overflow-y-auto p-6",children:M?.messages?.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:a("detail.no_messages")}):M?.messages?.map(ne=>e.jsx(pl,{variant:ne.is_me?"sent":"received",className:ne.is_me?"ml-auto":"mr-auto",children:e.jsx(fl,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"whitespace-pre-wrap break-words",children:ne.message}),e.jsx("div",{className:"text-right",children:e.jsx("time",{className:"text-[10px] text-muted-foreground",children:_e(ne.created_at)})})]})})},ne.id))})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"relative flex items-center space-x-2",children:[e.jsx(gl,{ref:c,disabled:Y||d,placeholder:a(Y?"detail.input.closed_placeholder":"detail.input.reply_placeholder"),className:"flex-1 resize-none rounded-lg border bg-background p-3 focus-visible:ring-1",value:x,onChange:ne=>i(ne.target.value),onKeyDown:ne=>{ne.key==="Enter"&&!ne.shiftKey&&(ne.preventDefault(),ae())}}),e.jsx(G,{disabled:Y||d||!x.trim(),onClick:ae,children:a(d?"detail.input.sending":"detail.input.send")})]})})]})]})]})]})]})}const ep=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3m-.41 2l-5.88 5.88a1 1 0 0 1-1.42 0L5.41 6ZM20 17a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V7.41l5.88 5.88a3 3 0 0 0 4.24 0L20 7.41Z"})}),sp=s=>e.jsx("svg",{className:"inline-block",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s,children:e.jsx("path",{fill:"currentColor",d:"M21.92 11.6C19.9 6.91 16.1 4 12 4s-7.9 2.91-9.92 7.6a1 1 0 0 0 0 .8C4.1 17.09 7.9 20 12 20s7.9-2.91 9.92-7.6a1 1 0 0 0 0-.8M12 18c-3.17 0-6.17-2.29-7.9-6C5.83 8.29 8.83 6 12 6s6.17 2.29 7.9 6c-1.73 3.71-4.73 6-7.9 6m0-10a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"})}),tp=s=>{const{t:n}=F("ticket");return[{accessorKey:"id",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.id")}),cell:({row:a})=>e.jsx(K,{variant:"outline",children:a.getValue("id")}),enableSorting:!1,enableHiding:!1},{accessorKey:"subject",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.subject")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ep,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[500px] truncate font-medium",children:a.getValue("subject")})]}),enableSorting:!1,enableHiding:!1,size:4e3},{accessorKey:"level",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.level")}),cell:({row:a})=>{const l=a.getValue("level"),r=l===Fe.LOW?"default":l===Fe.MIDDLE?"secondary":"destructive";return e.jsx(K,{variant:r,className:"whitespace-nowrap",children:n(`level.${l===Fe.LOW?"low":l===Fe.MIDDLE?"medium":"high"}`)})},filterFn:(a,l,r)=>r.includes(a.getValue(l))},{accessorKey:"status",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.status")}),cell:({row:a})=>{const l=a.getValue("status"),r=a.original.reply_status,c=l===Is.CLOSED?n("status.closed"):n(r===0?"status.replied":"status.pending"),o=l===Is.CLOSED?"default":r===0?"secondary":"destructive";return e.jsx(K,{variant:o,className:"whitespace-nowrap",children:c})}},{accessorKey:"updated_at",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.updated_at")}),cell:({row:a})=>e.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[e.jsx(vl,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:_e(a.getValue("updated_at"))})]}),enableSorting:!0},{accessorKey:"created_at",header:({column:a})=>e.jsx(L,{column:a,title:n("columns.created_at")}),cell:({row:a})=>e.jsx("div",{className:"text-sm text-muted-foreground",children:_e(a.getValue("created_at"))}),enableSorting:!0,meta:{isFlexGrow:!0}},{id:"actions",header:({column:a})=>e.jsx(L,{className:"justify-end",column:a,title:n("columns.actions")}),cell:({row:a})=>{const l=a.original.status!==Is.CLOSED;return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Xh,{ticketId:a.original.id,dialogTrigger:e.jsx(G,{variant:"ghost",size:"icon",className:"h-8 w-8",title:n("actions.view_details"),children:e.jsx(sp,{className:"h-4 w-4"})})}),l&&e.jsx(Ge,{title:n("actions.close_confirm_title"),description:n("actions.close_confirm_description"),confirmText:n("actions.close_confirm_button"),variant:"destructive",onConfirm:async()=>{gd(a.original.id).then(()=>{$.success(n("actions.close_success")),s()})},children:e.jsx(G,{variant:"ghost",size:"icon",className:"h-8 w-8",title:n("actions.close_ticket"),children:e.jsx(jl,{className:"h-4 w-4"})})})]})}}]};function ap(){const[s,n]=m.useState({}),[a,l]=m.useState({}),[r,c]=m.useState([{id:"status",value:"0"}]),[o,u]=m.useState([]),[x,i]=m.useState({pageIndex:0,pageSize:20}),{refetch:d,data:p,isLoading:w}=ie({queryKey:["orderList",x,r,o],queryFn:()=>pd({pageSize:x.pageSize,current:x.pageIndex+1,filter:r,sort:o})}),P=ss({data:p?.data??[],columns:tp(d),state:{sorting:o,columnVisibility:a,rowSelection:s,columnFilters:r,pagination:x},rowCount:p?.total??0,manualPagination:!0,manualFiltering:!0,manualSorting:!0,enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:u,onColumnFiltersChange:c,onColumnVisibilityChange:l,getCoreRowModel:ts(),getFilteredRowModel:is(),getPaginationRowModel:os(),onPaginationChange:i,getSortedRowModel:cs(),getFacetedRowModel:ks(),getFacetedUniqueValues:Ts(),initialState:{columnPinning:{right:["actions"]}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(qh,{table:P,refetch:d}),e.jsx(us,{table:P,showPagination:!0})]})}function np(){const{t:s}=F("ticket");return e.jsxs(Pe,{children:[e.jsxs(Ee,{children:[e.jsx($e,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ze,{}),e.jsx(Le,{})]})]}),e.jsxs(Ve,{className:"flex flex-col",fixedHeight:!0,children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:s("title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:s("description")})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(ap,{})})]})]})}const rp=Object.freeze(Object.defineProperty({__proto__:null,default:np},Symbol.toStringTag,{value:"Module"}));export{dp as a,op as c,cp as g,up as r};
